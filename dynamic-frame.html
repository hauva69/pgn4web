<html>

<!--
  pgn4web javascript chessboard
  copyright (C) 2009, 2011 Paolo Casaschi
  see README file and http://pgn4web.casaschi.net
  for credits, license and more details
-->

<head>

<title>chess games</title>

<link rel="shortcut icon" href="pawn.ico" />

<style type="text/css">

</style>

<style id="dynamicStyle" type="text/css"></style>

<script src="pgn4web.js" type="text/javascript"></script>
<script type="text/javascript">
SetHighlightOption(true);
SetGameSelectorOptions(" ", false, 0, 0, 0, 15, 15, 3, 0); // (head, num, chEvent, chSite, chRound, chWhite, chBlack, chResult, chDate);
SetAutoplayDelay(2000); // milliseconds
SetAutostartAutoplay(false);
SetAutoplayNextGame(false);
SetShortcutKeysEnabled(true);

pgnData_default = "";
refreshMinutes_default = 0;
initialGame_default = "first";
pieceFont_default = "uscf";
theme = new Array();
theme[0] = new Array("black",  "FFFFFF", "000000", "999999", "777777", "000000");
theme[1] = new Array("blue",   "000000", "80B0E0", "E6EDF3", "A0BED8", "596978");
theme[2] = new Array("braun",  "221100", "FFCE9E", "FFCE9E", "D18B47", "663300");
theme[3] = new Array("gray",   "666666", "F4F4F4", "F4F4F4", "E0E0E0", "AAAAAA");
theme[4] = new Array("green",  "333333", "EFF4EC", "EFF4EC", "C6CEC3", "999999");
theme[5] = new Array("pink",   "615F54", "EDE8D5", "EDE8D5", "CFCBB3", "9B9786");
theme[6] = new Array("white",  "000000", "FFFFFF", "FFFFFF", "E4E4E4", "000000");
theme[7] = new Array("wood",   "663300", "FFFFFF", "FFCC99", "CC9966", "663300");
theme[8] = new Array("yellow", "54110C", "F2D798", "F2D798", "C9AD6F", "54110C");
colorTheme_indexDefault = 2;
colorThemeOptions = "";
for (ii = 0; ii < theme.length; ii++) { colorThemeOptions += "'" + theme[ii][0] + "' | "; }
colorThemeOptions += "'random' ";

thisRegExp = /(&|\?)(help|h)(&|$)/i;
if (window.location.search.match(thisRegExp) !== null) {
  document.write("<pre style='font-size: smaller;'>pgn4web dynamic-frame.html parameters" + "\n" +
    " - pgnData = file.pgn (no default)" + "\n" +
    " - initialGame = initial game (default " + initialGame_default + ")" + "\n" +
    " - live = if set true enables live broadcast with default values (default false)" + "\n" +
    " - refreshMinutes = live broadcast delay (default " + refreshMinutes_default + ")" + "\n" +
    " - refreshDemo = if set true sets live demo mode (default false)" + "\n" +
    " - pieceFont = 'alpha' | 'merida' | 'uscf' | 'random' (default " + pieceFont_default + ")" + "\n" +
    " - colorTheme = " + colorThemeOptions + "(default '" + theme[colorTheme_indexDefault][0] + "')" + "\n" +
    " - fontColorHex = font color hex code, like FF0000 (default according to the selected color theme)" + "\n" +
    " - backgroundColorHex = page background color hex code, like FF0000 (default according to the selected color theme)" + "\n" +
    " - lightColorHex = light square color hex code, like FF0000 (default according to the selected color theme)" + "\n" +
    " - darkColorHex = dark square color hex code, like FF0000 (default according to the selected color theme)" + "\n" +
    " - highlightColorHex = highlight square color hex code, like FF0000, or 'transparent' for no highlight (default according to the selected color theme)" + "\n" +
    " - bare = if set true shows chessboard only (default false)" + "\n" +
    " - help" + "\n" +
    "</pre>");
}

liveString = "";
thisRegExp = /(&|\?)(live|l)=([^&]*)(&|$)/i;
if (window.location.search.match(thisRegExp) !== null) {
  liveString = unescape(window.location.search.match(thisRegExp)[3]);
}
if ((liveString == "true") || (liveString == "t")) {
  refreshMinutes_default = 1;
}

alertFlag = demoFlag = false;
thisRegExp = /(&|\?)(refreshDemo|rd)=([^&]*)(&|$)/i;
if (window.location.search.match(thisRegExp) !== null) {
  refreshDemo = unescape(window.location.search.match(thisRegExp)[3]);
  if ((refreshDemo == "true") || (refreshDemo == "t")) { alertFlag = demoFlag = true; }
}

refreshMinutes = refreshMinutes_default;
stepFlag = true;
thisRegExp = /(&|\?)(refreshMinutes|rm)=([^&]*)(&|$)/i;
if (window.location.search.match(thisRegExp) !== null) {
  refreshMinutes = parseFloat(unescape(window.location.search.match(thisRegExp)[3]));
  if (isNaN(refreshMinutes)) { refreshMinutes = refreshMinutes_default; }
  if (refreshMinutes <= 0) { refreshMinutes = refreshMinutes_default; }
}
if (refreshMinutes) {  pgnData_default = "live/live.pgn"; }

SetInitialHalfmove(refreshMinutes ? "end" : "start", true);
 
SetLiveBroadcast(refreshMinutes, alertFlag, demoFlag, stepFlag); // set live broadcast; parameters are delay (refresh delay in minutes, 0 means no broadcast, default 0) alertFlag (if true, displays debug error messages, default false) demoFlag (if true starts broadcast demo mode, default false) stepFlag (if true, autoplays updates in steps, default false)

pgnData = pgnData_default;
thisRegExp = /(&|\?)(pgnData|pd)=([^&]*)(&|$)/i;
if (window.location.search.match(thisRegExp) !== null) {
  pgnData = unescape(window.location.search.match(thisRegExp)[3]);
}
SetPgnUrl(pgnData); // if set, this has precedence over the inline PGN in the HTML file

iniGame = initialGame_default;
thisRegExp = /(&|\?)(initialGame|ig)=([^&]*)(&|$)/i;
if (window.location.search.match(thisRegExp) !== null) {
  iniGame = unescape(window.location.search.match(thisRegExp)[3]);
}
SetInitialGame(iniGame);

pieceFont = pieceFont_default;
thisRegExp = /(&|\?)(pieceFont|pf)=([^&]*)(&|$)/i;
if (window.location.search.match(thisRegExp) !== null) {
  pieceFont = unescape(window.location.search.match(thisRegExp)[3]);
}
if (pieceFont == "a") { pieceFont = "alpha"; }
if (pieceFont == "m") { pieceFont = "merida"; }
if (pieceFont == "u") { pieceFont = "uscf"; }
if (pieceFont == "s") { pieceFont = "svgchess"; }
if ((pieceFont == "random") || (pieceFont == "r")) {
  randomPiece = Math.floor(Math.random() * 3);
  switch (randomPiece) {
    case 1: pieceFont = "merida"; break;
    case 2: pieceFont = "uscf"; break;
    default: pieceFont = "alpha"; break;
  }
}
if ((pieceFont != "alpha") && (pieceFont != "merida") && (pieceFont != "uscf") && (pieceFont != "svgchess")) { pieceFont = pieceFont_default; }
if (pieceFont == "svgchess") {
  SetImagePath(pieceFont);
  SetImageType("svg");
} else {
  SetImagePath(pieceFont + "/96");
  SetImageType("png");
}

colorTheme = theme[colorTheme_indexDefault][0];
thisRegExp = /(&|\?)(colorTheme|ct)=([\w]*)(&|$)/i;
if (window.location.search.match(thisRegExp) !== null) {
  colorTheme = unescape(window.location.search.match(thisRegExp)[3]);
}
colorTheme_index = colorTheme_indexDefault;
if (colorTheme == "random") { colorTheme_index = Math.floor(theme.length * Math.random()); }
else { for (ii = 0; ii < theme.length; ii++) { if (theme[ii][0] === colorTheme) { colorTheme_index = ii; break; } } }

fontColorHex_default = theme[colorTheme_index][1];
backgroundColorHex_default = theme[colorTheme_index][2];
lightColorHex_default = theme[colorTheme_index][3];
darkColorHex_default = theme[colorTheme_index][4];
highlightColorHex_default = theme[colorTheme_index][5];

fontColorHex = fontColorHex_default;
thisRegExp = /(&|\?)(fontColorHex|fch)=([A-F0-9]*)(&|$)/i;
if (window.location.search.match(thisRegExp) !== null) {
  fontColorHex = unescape(window.location.search.match(thisRegExp)[3]);
}

backgroundColorHex = backgroundColorHex_default;
thisRegExp = /(&|\?)(backgroundColorHex|bch)=([A-F0-9]*)(&|$)/i;
if (window.location.search.match(thisRegExp) !== null) {
  backgroundColorHex = unescape(window.location.search.match(thisRegExp)[3]);
}

lightColorHex = lightColorHex_default;
thisRegExp = /(&|\?)(lightColorHex|lch)=([A-F0-9]*)(&|$)/i;
if (window.location.search.match(thisRegExp) !== null) {
  lightColorHex = unescape(window.location.search.match(thisRegExp)[3]);
}

darkColorHex = darkColorHex_default;
thisRegExp = /(&|\?)(darkColorHex|dch)=([A-F0-9]*)(&|$)/i;
if (window.location.search.match(thisRegExp) !== null) {
  darkColorHex = unescape(window.location.search.match(thisRegExp)[3]);
}

highlightColorHex = highlightColorHex_default;
thisRegExp = /(&|\?)(highlightColorHex|hch)=(t|transparent)(&|$)/i;
if (window.location.search.match(thisRegExp) !== null) {
  highlightColorHex = "";
} else {
  thisRegExp = /(&|\?)(highlightColorHex|hch)=([A-F0-9]*)(&|$)/i;
  if (window.location.search.match(thisRegExp) !== null) {
    highlightColorHex = unescape(window.location.search.match(thisRegExp)[3]);
  }
}

bareString = "";
thisRegExp = /(&|\?)(bare|b)=([^&]*)(&|$)/i;
if (window.location.search.match(thisRegExp) !== null) {
  bareString = unescape(window.location.search.match(thisRegExp)[3]);
}
bare = ((bareString == "true") || (bareString == "t"));


function myRulesLength(sheet) {
  if (sheet.cssRules) { return sheet.cssRules.length; }
  if (sheet.rules) { return sheet.rules.length; }
  return null;
}

function myInsertRule(sheet, selector, declaration) {
  if (sheet.insertRule) { sheet.insertRule(selector + "{ " + declaration + " }", myRulesLength(sheet)); }
  else if (sheet.addRule) { sheet.addRule(selector, declaration); }
}

function myDeleteRule(sheet, index) {
  if (sheet.deleteRule) { sheet.deleteRule(index); }
  else if (sheet.removeRule) { sheet.removeRule(index); }
}

function myOnResize() {
  if (window.innerWidth && window.innerHeight) { ww = window.innerWidth; wh = window.innerHeight; IEfix = false; }
  else if (document.documentElement && document.documentElement.clientWidth) { ww = document.documentElement.clientWidth; wh = document.documentElement.clientHeight; IEfix = true; }
  else if (document.body && document.body.clientWidth) { ww = document.body.clientWidth; wh = document.body.clientHeight; IEfix = true; }
  else { throw("failed to get window size"); }

  if (bare) {
    horizontalLayout = true;
    squareSize = Math.min(ww / 8, wh / 8);
  } else {
    squareSize_H = Math.min(ww / (16 * 8 / 9), wh / 8);
    squareSize_V = Math.min(ww / 8, wh / 16.1);
    horizontalLayout = (squareSize_H >= squareSize_V);
    squareSize = horizontalLayout ? squareSize_H : squareSize_V;
  }
  lineHeight = Math.floor(squareSize/ 2);
  fontSize = Math.floor(lineHeight * 0.8);
  squareBorderWidth = Math.min(Math.ceil(squareSize / 50), 3);  
  pieceSize = Math.floor(squareSize * 0.8);
  if (horizontalLayout) {
    headerContainerWidth = ww - (IEfix ? 10 : 9) * squareSize;
    selectWidth = ww - 9 * squareSize;
  } else {
    headerContainerWidth = selectWidth = ww;
  }
  sheet = document.styleSheets[0];
  oldRules = myRulesLength(sheet);

  if ((IEfix) && (theObject = document.getElementById("GameSelector"))) { theObject.innerHTML = theObject.innerHTML; }

  myInsertRule(sheet, "body", "padding: 0; margin: 0; white-space: nowrap; overflow: hidden; color: #" + fontColorHex + "; background-color: #" + backgroundColorHex + "; font-family: sans-serif; line-height: " + lineHeight + "px; font-size: " + fontSize + "px;");
  myInsertRule(sheet, "a", "text-decoration: none; color: #" + fontColorHex + ";"); 
  myInsertRule(sheet, ".boardTable", (horizontalLayout ? "float: left; margin-right: " + squareSize + "px;" : "margin-bottom: " + (squareSize / 2) + "px; margin-left: " + ((ww - 8 * squareSize) / 2) + "px;"));
  myInsertRule(sheet, ".pieceImage", "width:" + pieceSize + "px; height:" + pieceSize + "px;");
  myInsertRule(sheet, ".whiteSquare", "width:" + squareSize + "px; height:" + squareSize + "px; border-style: solid; border-width: " + squareBorderWidth + "px;" + "background-color: #" + lightColorHex + "; border-color: #" + lightColorHex + ";");
  myInsertRule(sheet, ".blackSquare", "width:" + squareSize + "px; height:" + squareSize + "px; border-style: solid; border-width: " + squareBorderWidth + "px;" + "background-color: #" + darkColorHex + "; border-color:  #" + darkColorHex + ";");
  myInsertRule(sheet, ".highlightWhiteSquare", "width:" + squareSize + "px; height:" + squareSize + "px; border-style: solid; border-width: " + squareBorderWidth + "px;" + "background-color: #" + lightColorHex + "; border-color: #" + (highlightColorHex ? highlightColorHex : lightColorHex) + ";");
  myInsertRule(sheet, ".highlightBlackSquare", "width:" + squareSize + "px; height:" + squareSize + "px; border-style: solid; border-width: " + squareBorderWidth + "px;" + "background-color: #" + darkColorHex + "; border-color:  #" + (highlightColorHex ? highlightColorHex : darkColorHex) + ";");
  myInsertRule(sheet, ".headerContainer", "width: " + headerContainerWidth + "px; white-space: nowrap; overflow: hidden;" + (horizontalLayout ? " clear: right; " : " text-align: center;"));
  myInsertRule(sheet, ".selectControl", "margin: 0; padding: 0; width: " + selectWidth + "px !important; height: " + lineHeight + "px; font-size: " + fontSize + "px; color: #" + fontColorHex + "; background-color: #" + backgroundColorHex + "; border-width: 0;");
  myInsertRule(sheet, ".gameSelector", (horizontalLayout ? "float: right;" : "margin-bottom: " + (squareSize / 2) + "px;"));
  myInsertRule(sheet, ".lowerSpacer", (horizontalLayout ? "" : "line-height: " + (lineHeight / 2) + "px; font-size: " + (fontSize / 2) + "px;"));
  for (ii = 0; ii < oldRules; ii++) { myDeleteRule(sheet, 0); }

  if (theObject = document.getElementById("boardTable")) {
    theObject.style.height = (squareSize * 8) + "px";
    theObject.style.width = (squareSize * 8) + "px";
  }
  
  if (bare) {
    if (theObject = document.getElementById("GameSelector")) { theObject.style.display = "none"; }
    if (theObject = document.getElementById("HeaderContainer")) { theObject.style.display = "none"; }
  }

}


function customFunctionOnPgnTextLoad() {
  if (LiveBroadcastDelay) {
    if (LiveBroadcastStarted && !LiveBroadcastEnded) {
      document.title = "chess live broadcast" + (demoFlag ? " demo" : "");
    } else { document.title = LiveBroadcastStatusString; }
  }
}

function customFunctionOnPgnGameLoad() { myOnResize(); }

function customFunctionOnMove() {
  if (theObject = document.getElementById("GameMoreMoves")) {
    theObject.innerHTML = (CurrentPly == StartPly + PlyNumber) ? "" : ">";
  }
}

function searchPlayer(name, FideId) {
  if (FideId) { window.open("http://ratings.fide.com/seek.phtml?idcode=" + escape(FideId) + "&name=&offset=0"); }
  else if (name) { window.open("http://ratings.fide.com/seek.phtml?idcode=&name=" + escape(name) + "&offset=0"); }
}

</script>

</head>

<body onLoad="myOnResize(); start_pgn4web();" onResize="myOnResize();">

<!-- paste your PGN below and make sure you dont specify an external source with SetPgnUrl() -->
<form style="display: none;"><textarea style="display: none;" id="pgnText">

</textarea></form>
<!-- paste your PGN above and make sure you dont specify an external source with SetPgnUrl() -->

<div class="gameSelector" id="GameSelector"></div>

<div id="GameBoard"></div>

<div class="headerContainer" id="HeaderContainer">
<div>&nbsp;</div>
<div><span id="GameSite" title="site"></span>&nbsp;</div>
<div><span id="GameEvent" title="event"></span>&nbsp;</div>
<div class="lowerSpacer">&nbsp;</div>
<div><span id="GameWhiteClock" title="White clock"></span>&nbsp;</div>
<div><a style="font-weight: bold;" id="GameWhite" href="javascript:void(0);" onclick="searchPlayer(this.innerHTML, customPgnHeaderTag('WhiteFideId'));" title="White player"></a>&nbsp;</div>
<div><a style="font-weight: bold;" id="GameBlack" href="javascript:void(0);" onclick="searchPlayer(this.innerHTML, customPgnHeaderTag('BlackFideId'));" title="Black player"></a>&nbsp;</div>
<div><span id="GameBlackClock" title="Black clock"></span>&nbsp;</div>
<div class="lowerSpacer">&nbsp;</div>
<div><span style="font-weight: bold;" id="GameResult" title="result"></span>&nbsp;</div>
<div class="lowerSpacer">&nbsp;</div>
<div><span id="GameLastMove" title="last move"></span>&nbsp;</div>
<div class="lowerSpacer">&nbsp;</div>
<div><a id="GameMoreMoves" href="javascript:void(0);" onclick="MoveForward(1);" title="more moves available: click > to move forward"></a>&nbsp;</div>
<div><a id="GameLiveStatus" href="javascript:void(0);" onclick="refreshPgnSource();" title="live broadcast status"></a>&nbsp;<span id="GameLiveStatusDemo" title="this is a broadcast simulation"></span></div>
</div>

<script type="text/javascript">

if (LiveBroadcastDelay) {
  if (theObject = document.getElementById("GameLiveStatusDemo")) {
    theObject.innerHTML = LiveBroadcastDemo ? "&nbsp;&nbsp;demo" : "";
  }
} else {
  if (theObject = document.getElementById("GameLiveStatus")) {
    theObject.style.visibility = "hidden";
  }
}

</script>

</body>

</html>
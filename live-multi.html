<html>

<!--
  pgn4web javascript chessboard
  copyright (C) 2009, 2010 Paolo Casaschi
  see README file and http://pgn4web.casaschi.net
  for credits, license and more details
-->

<head>

<title>pgn4web multiple live chessboards</title>

<script type="text/javascript">

  pgnFile_default = location.protocol + "//" + location.hostname + location.pathname.replace(/\/[^\/]*$/, "/live/live.pgn");
  
  // accepts pgnData as alias for pgnFile for consistency with board.html
  if ((pgnFile = gup("pgnData")) === "") { 
    if ((pgnFile = gup("pgnFile")) === "") {
      pgnFile = pgnFile_default; 
    }
  }

  if ((refreshMinutes = gup("refreshMinutes")) === "") { 
    refreshMinutes = 1;
  } else {
    testMinutes = refreshMinutes + "";
    if (testMinutes.match(/[^0-9\.]/)) {
      alert("ERROR: refreshMinutes parameter must be a positive number.\n" +
            "Supplied " + testMinutes + "; defaulting to 1."); 
      refreshMinutes = 1;
    }
  }

  if ((boards = gup("boards")) === "") {
    boards = 2;
  } else {
    testBoards = boards + "";
    if ((testBoards.match(/[^0-9]/)) || (boards == 0) || (boards > 32)) {
      alert("ERROR: boards parameter must be a positive integer, max 32.\n" +
            "Supplied " + testBoards + "; defaulting to 2."); 
      boards = 2;
    }
  }

  if ((columns = gup("columns")) === "") {
    columns = 2;
  } else {
    testColumns = columns + "";
    if ((testColumns.match(/[^0-9]/)) || (columns == 0) || (columns > 8)) {
      alert("ERROR: columns parameter must be a positive integer, max 8.\n" +
            "Supplied " + testColumns + "; defaulting to 2."); 
      columns = 2;
    }
  }

  if ((gup("help") == "true") || (gup("help") == "t")) { developer_help(); }

function gup( name ){

  name = name.replace(/[\[]/,"\\\[").replace(/[\]]/,"\\\]");
  var regexS = "[\\?&]"+name+"=([^&#]*)";
  // commented below to match first occurrence (to avoid users overruling setting)
  // regexS = regexS+"(?!.*"+regexS+")"; // matches the LAST occurrence
  var regex = new RegExp( regexS, "i" );
  var results = regex.exec( window.location.href );
  if( results !== null ) { return decodeURIComponent(results[1]); }

  // allows for short version of the URL parameters, for instance sC matches squareColor
  compact_name = name.charAt(0);
    for(i=1; i<name.length; i++){
      if (name.charAt(i).match(/[A-Z]/)) { compact_name = compact_name + name.charAt(i).toLowerCase(); }
    }
  name = compact_name;

  name = name.replace(/[\[]/,"\\\[").replace(/[\]]/,"\\\]");
  regexS = "[\\?&]"+name+"=([^&#]*)";
  // commented below to match first occurrence (to avoid users overruling setting)
  // regexS = regexS+"(?!.*"+regexS+")"; // matches the LAST occurrence
  regex = new RegExp( regexS, "i" );

  results = regex.exec( window.location.href );
  if( results !== null ) { return decodeURIComponent(results[1]); }

  return "";
}

function developer_help() {
  alert("pgn4web live.html parameters" + "\n" + 
        " - pgnData = " + pgnFile + "; PGN file to load (default " + pgnFile_default + ")" + "\n" +
        " - refreshMinutes = " + refreshMinutes + "; refresh interval in minutes, decimals allowed (default 1)" + "\n" +
        " - boards = " + boards + "; number of boards to display (default 2)" + "\n" +
        " - columns = " + columns + "; number of columns to arrange the display (default 2)" + "\n" +
        " - help = true; prints this help (default false)");
}

</script>

<style type="text/css">

body
{ color: #DDDDDD; background: white; font-family: sans-serif; padding: 20px 20px 10px 20px; }

a:link, a:visited, a:hover, a:active
{ color: #DDDDDD; text-decoration: none; }

</style>

</head>

<body>

<h1><a target='_blank' href='http://pgn4web.casaschi.net'>pgn4web</a> multiple live <a href='#boards'>chessboards</a></h1>
<a name='boards' style='line-height:10px;'>&nbsp;</a>

<script type="text/javascript">

rows = Math.ceil(boards / columns);

document.write("<center><table cellspacing='0' cellpadding='10'>");
for (r = 0; r < rows; r++) {
  document.write("<tr>");
  for (c = 0; c < columns; c++) {
    document.write("<td width='260'>");
      if ((r * columns + c) < boards) {
        document.write("<iframe width='240' height='300' frameborder='0' scrolling='no' marginheight='0' marginwidth='0' src='board.html?am=n&d=5000&ih=e&ss=26&ps=d&pf=d&lcs=VdyD&dcs=LHCg&bbcs=LHCg&hm=b&hcs=x7y_&bd=h&cbcs=VdyD&ctcs=yU1n&hd=j&md=h&tm=0&fhcs=7jdn&fhs=67p&bcs=____&fp=13&hl=f&fh=300&fw=b&pd=" + pgnFile + "&ig=" + (r * columns + c + 1) + "&rm=" + (refreshMinutes * (1 + Math.floor(Math.random() * 100) / 1000)) + "'>your web browser and/or your host do not support iframes as required to display the chessboard</iframe>");
      }
    document.write("</td>");
  }
  document.write("</tr>");
}
document.write("</table></center>");

document.write("<p style='text-align: right; font-size:small; color:white;'>refreshMinutes: " + refreshMinutes + " &nbsp; pgnData: <a style='color:white;' href='" + pgnFile + "'>" + pgnFile + "</a></p><p style='text-align: right; font-size:small; font-weight:bold;'>control the <a href='#boards'>chessboards</a> by clicking their squares<br>hover the mouse on each square for help</p>");

</script>

</body>

</html>


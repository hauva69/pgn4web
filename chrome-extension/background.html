<!--
  pgn4web javascript chessboard
  copyright (C) 2009, 2010 Paolo Casaschi
  see README file and http://pgn4web.casaschi.net
  for credits, license and more details
-->

<script type="text/javascript">

function openRemoteUrl(remoteUrl, live) {
  if (!remoteUrl) { return; }
  var liveParam = live ? '&refreshMinutes=1&search=\\[\\s*Result\\s*"\\*"\\s*\\]' : "";
  url = "chess-games-viewer.html?pgnData=" + remoteUrl + liveParam;
  chrome.tabs.create({url: url});
}

function pgnLinkOnClick(info, tab, live) {
  var remoteUrl = info.linkUrl;
  if (!remoteUrl) { return; }
  if (!remoteUrl.match(/\.pgn$/i)) { return; }
  openRemoteUrl(remoteUrl, live);
}

function pgnPageOnClick(info, tab, live) {
  var promptLabel = "Enter PGN games URL for viewing" + (live ? " with live refresh:" : ":");
  var defaultRemoteUrl = info.selectionText ? info.selectionText.replace(/[\n\r]+/g," ") : "";
  var remoteUrl = prompt(promptLabel, defaultRemoteUrl);
  if (!remoteUrl) { return; }
  if (!remoteUrl.match(/\.pgn$/i)) {
    alert("You entered:\n" + remoteUrl + "\n\nError: only PGN games URL allowed.");
    retrun;
  }
  openRemoteUrl(remoteUrl, live);
}

function pgnviewLinkOnClick(info, tab) {
  pgnLinkOnClick(info, tab, false);
}

function pgnliveLinkOnClick(info, tab) {
  pgnLinkOnClick(info, tab, true);
}

function pgnviewPageOnClick(info, tab) {
  pgnPageOnClick(info, tab, false);
}

function pgnlivePageOnClick(info, tab) {
  pgnPageOnClick(info, tab, true);
}

function aboutChessGamesViewer(info, tab) {
  var aboutText = "Chess games viewer extension for Google Chrome\n\nContext menu for *.pgn chess games URLs to open a chess games viewer (*.pgn files are commonly used to store and share chess games information).\nThe live refresh option reloads the games periodically until all games are ended, use for links to chess games live broadcasts.\nClick on the viewer's chessboard top right square for help on the user interface.\nMore info at the pgn4web project wiki:\nhttp://pgn4web.casaschi.net";
  if (confirm(aboutText + "\n\nClick OK to visit the pgn4web homepage or\nCancel to close this about window.")) {
    chrome.tabs.create({url: "http://pgn4web.casaschi.net"});
  }
}

chrome.contextMenus.create({"title": "View chess games link", "contexts": ["link"], targetUrlPatterns:["*://*/*.pgn", "*://*/*.PGN", "*://*/*.Pgn"], "onclick": pgnviewLinkOnClick});
chrome.contextMenus.create({"title": "View chess games link with live refresh", "contexts": ["link"], targetUrlPatterns:["*://*/*.pgn", "*://*/*.PGN", "*://*/*.Pgn"], "onclick": pgnliveLinkOnClick});

chrome.contextMenus.create({"title": "Enter PGN games URL for viewing", "contexts": ["page", "selection"], "onclick": pgnviewPageOnClick});
chrome.contextMenus.create({"title": "Enter PGN games URL for viewing with live refresh", "contexts": ["page", "selection"], "onclick": pgnlivePageOnClick});

chrome.contextMenus.create({"type": "separator", "contexts": ["link"], targetUrlPatterns:["*://*/*.pgn", "*://*/*.PGN", "*://*/*.Pgn"]});
chrome.contextMenus.create({"title": "About the chess games viewer", "contexts": ["link"], targetUrlPatterns:["*://*/*.pgn", "*://*/*.PGN", "*://*/*.Pgn"], "onclick": aboutChessGamesViewer});

// can NOT add separator/about items to the selection context
// otherwise they would appear twice when selecting a text and
// pointing to a link at the same time
chrome.contextMenus.create({"type": "separator", "contexts": ["page"]});
chrome.contextMenus.create({"title": "About the chess games viewer", "contexts": ["page"], "onclick": aboutChessGamesViewer});

</script>


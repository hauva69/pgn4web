<html>

<!--
  pgn4web javascript chessboard
  copyright (C) 2009, 2010 Paolo Casaschi
  see README file and http://pgn4web.casaschi.net
  for credits, license and more details
-->

<!--

HTML, CSS and Javascript code optimized for use as extension
of Google Chrome v6 or later. Don't use with any other browser.

-->

<head>

<style type="text/css">

body {
  margin: 0; 
  padding: 25px; 
  background: -webkit-gradient(linear, left top, left bottom, from(#FFFFFF), to(#F0F0F0));
  color: black; 
  font-family: sans-serif; 
  font-size: 16px;
  white-space: nowrap;
}

.pgnHeader {
  font-weight: bold;
  padding-bottom: 0.6em;
}

.pgnItem {
  padding-top: 0.4em;
}

.pgnLink {
  color: black;
  text-decoration: none;
}

</style>

</head>

<body>

<div class="pgnHeader"><a class="pgnLink" title="chess games viewer from the pgn4web project" target="_blank" href="http://pgn4web.casaschi.net">Chess games viewer</a>:<span id="numPgnLinks"> </span>PGN link<span id="numPgnPlural">s</span> on this page</div>

<div id="pgnLinkList"></div>

<script type="text/javascript">

chrome.tabs.getSelected(null, function(tab){
  // uncomment this line and the following setTimeout for a page action icon animation effect
  // chrome.pageAction.setIcon({"tabId": tab.id, "path": "alpha-16-clicked.png"});
  printLinks(chrome.extension.getBackgroundPage().pgnLinks[tab.id]);
  // setTimeout('chrome.pageAction.setIcon({"tabId": ' + tab.id + ', "path": "alpha-16.png"})', 300);
});

var cursorDef = "url(cursor-small.png) 1 6, auto";
// var cursorDef = "url(cursor-large.png) 1 6, auto";
function printLinks(pgnLinks) {
  document.getElementById("numPgnLinks").innerHTML = " " + pgnLinks.length + " ";
  document.getElementById("numPgnPlural").innerHTML = pgnLinks.length == 1 ? "" : "s";
  for(i=0; i<pgnLinks.length; i++) {
    var pgnFileName = pgnLinks[i].replace(/(^|^[^?#]*\/)([^?#\/]+\.pgn)($|\?.*$|#.*$)/i,'$2');
    document.getElementById("pgnLinkList").innerHTML += '<div class="pgnItem">' +
      '<a title="view ' + pgnFileName + ' games" class="pgnLink" href=. onmouseover=\'this.style.cursor="' + cursorDef + '";\' onclick=\'chrome.tabs.create({url: "chess-games-viewer.html?pgnData=' + escape(pgnLinks[i]) + '"});\'><img src="alpha-16.png"></a>&nbsp;&nbsp;' +
      '<a title="view ' + pgnFileName + ' games with live refresh" class="pgnLink" href=. onmouseover=\'this.style.cursor="' + cursorDef + '";\' onclick=\'chrome.tabs.create({url: "chess-games-viewer.html?pgnData=' + escape(pgnLinks[i]) + '&refreshMinutes=1.0' + Math.floor(Math.random()*10) + '&search=\\\\[\\\\s*Result\\\\s*\\"\\\\*\\"\\\\s*\\\\]"});\'><img src="refresh.png"></a>&nbsp;&nbsp;' +
      '<a title="download ' + pgnFileName + ' games" class="pgnLink" target="_blank" href="' + pgnLinks[i] + '" onmouseover=\'this.style.cursor="' + cursorDef + '";\'><img src="download.png"></a>&nbsp;&nbsp;&nbsp;&nbsp;' +
      '<span title="' + pgnFileName + '">' + pgnLinks[i] + '</span>' +
      '</div>';
  }
}

</script>

</body>

</html>

<html> 
 
<!--
  pgn4web javascript chessboard
  copyright (C) 2009, 2010 Paolo Casaschi
  see README file and http://pgn4web.casaschi.net
  for credits, license and more details
--> 
 
<head> 
 
<title>pgn4web live chessboard</title> 
 
<link rel="shortcut icon" href="pawn.ico" /> 

<script src="pgn4web.js" type="text/javascript"></script>
 
<script type="text/javascript"> 

  var useTextarea = false;
  thisRegExp = /(&|\?)(useTextarea|ut)=([^&]*)(&|$)/i;
  if (window.location.search.match(thisRegExp) !== null) {
    useTextareaValue = unescape(window.location.search.match(thisRegExp)[3]);
    if ((useTextareaValue == "true") || (useTextareaValue == "t")) { useTextarea = true; }
  }

  var pgnFile_default = location.protocol + "//" + location.hostname + 
    location.pathname.replace(/\/[^\/]*$/, "/live/live.pgn");
  var pgnFile = pgnFile_default;
  // accepts pgnData as alias for pgnFile for consistency with board.html
  thisRegExp = /(&|\?)(pgnData|pd)=([^&]*)(&|$)/i;
  if (! thisRegExp) { thisRegExp = /(&|\?)(pgnFile|pf)=([^&]*)(&|$)/i; }
  if (window.location.search.match(thisRegExp) !== null) {
     pgnFile = unescape(window.location.search.match(thisRegExp)[3]);
  }

  var alertFlag = demoFlag = false;
  thisRegExp = /(&|\?)(refreshDemo|rd|demo|d)=([^&]*)(&|$)/i;
  if (window.location.search.match(thisRegExp) !== null) {
    refreshDemo = unescape(window.location.search.match(thisRegExp)[3]);
    if ((refreshDemo == "true") || (refreshDemo == "t")) { alertFlag = demoFlag = true; }
  }
 
  var refreshMinutes_default = 1;
  var refreshMinutes = refreshMinutes_default;
  var stepFlag = true;
  thisRegExp = /(&|\?)(refreshMinutes|rm)=([\d.]*)(&|$)/i;
  if (window.location.search.match(thisRegExp) !== null) {
    refreshMinutes = unescape(window.location.search.match(thisRegExp)[3]);
  }

  var iniGame_default = 1;
  var iniGame = iniGame_default;
  thisRegExp = /(&|\?)(initialGame|ig)=([^&]*)(&|$)/i;
  if (window.location.search.match(thisRegExp) !== null) {
    iniGame = unescape(window.location.search.match(thisRegExp)[3]);
  }

  var thisRegExp = /(&|\?)(help|h)([^&]*)(&|$)/i;
  if (window.location.search.match(thisRegExp) !== null) {
    alert("pgn4web live-all-frame.html parameters" + "\n" +
      " - useTextarea = " + useTextarea + "; if set true uses textarea as PGN input (default false = use pgnData)" + "\n" +
      " - pgnData = " + pgnFile + "; PGN file to load (default " + pgnFile_default + ")" + "\n" +
      " - refreshMinutes = " + refreshMinutes + "; refresh interval in minutes, decimals allowed (default 1)" + "\n" +
      " - refreshDemo = " + demoFlag + "; sets live demo mode (default false)" + "\n" +
      " - initialGame = " + iniGame + "; initial game number or search string" + "\n" +
      " - help = true; prints this help (default false)");
  }
 
  if (! useTextarea) { SetPgnUrl(pgnFile); }
  SetImagePath("uscf/20");
  SetImageType("png");
  SetHighlightOption(true); // true or false
  SetCommentsIntoMoveText(false);
  SetCommentsOnSeparateLines(false);
  SetAutoplayDelay(1000); // milliseconds
  SetAutostartAutoplay(false);
  SetAutoplayNextGame(false); 
  SetInitialGame(iniGame);
  SetInitialHalfmove("end", true);
  SetShortcutKeysEnabled(false);
  SetLiveBroadcast(refreshMinutes, demoFlag, alertFlag, stepFlag);

  clearShortcutSquares("CDEFGH", "2");
  clearShortcutSquares("ABCDEFGH", "345");
  clearShortcutSquares("CDEF", "6");
  clearShortcutSquares("CG", "7");

  function addTagToTitle(tagLabel, tagValue, object) {
    if (!tagValue || tagValue[1] == "?" || !object) { return; }
    object.title += "  \n " + tagLabel + tagValue;
  }

  function customFunctionOnPgnTextLoad() {

    thisCurrentGame = currentGame;

    // force reloading iniGame each time
    SetInitialGame(iniGame);
    setCurrentGameFromInitialGame();
    if (currentGame != thisCurrentGame) {
      SetInitialHalfmove("end",true);
      Init();
      GoToInitialHalfmove();
    }
  }

  function customFunctionOnPgnGameLoad() {
    wObject = document.getElementById("GameWhite");
    bObject = document.getElementById("GameBlack");
    if (wObject && bObject) {
      if ((!wObject.innerHTML.match(/\S/)) && (bObject.innerHTML.match(/\S/))) { wObject.innerHTML = "-"; }
      if ((!bObject.innerHTML.match(/\S/)) && (wObject.innerHTML.match(/\S/))) { bObject.innerHTML = "-"; }
    }
    if (theObject = document.getElementById("bottomContainer")) {
      theObject.title = " game " + (currentGame+1) + " of " + numberOfGames;
      addTagToTitle("event:", gameEvent[currentGame], theObject);
      addTagToTitle("site:", gameSite[currentGame], theObject);
      addTagToTitle("date:", gameDate[currentGame], theObject);
      addTagToTitle("round:", gameRound[currentGame], theObject);
      addTagToTitle("white:", gameWhite[currentGame], theObject);
      addTagToTitle("black:", gameBlack[currentGame], theObject);
      addTagToTitle("result:", gameResult[currentGame], theObject);
      addTagToTitle("termination:", customPgnHeaderTag("Termination"), theObject);
      addTagToTitle("timecontrol:", customPgnHeaderTag("TimeControl"), theObject);
    }
  }

  function customFunctionOnMove() {
    wObject = document.getElementById("GameWhiteClock");
    bObject = document.getElementById("GameBlackClock");
    if (wObject && bObject) {
      if ((!wObject.innerHTML.match(/\S/)) && (bObject.innerHTML.match(/\S/))) { wObject.innerHTML = "-"; }
      if ((!bObject.innerHTML.match(/\S/)) && (wObject.innerHTML.match(/\S/))) { bObject.innerHTML = "-"; }
    }
    if (theObject = document.getElementById("GameMoreMoves")) {
      theObject.innerHTML = CurrentPly == StartPly + PlyNumber ? "" : ">&nbsp;&nbsp;";
    }
  }

  function customShortcutKey_Shift_1() {
    if (gameWhite[currentGame]) {
      window.open("http://ratings.fide.com/seek.phtml?idcode=&name=" + gameWhite[currentGame] + "&offset=0");
    }
  }

  function customShortcutKey_Shift_2() {
    if (gameBlack[currentGame]) {
      window.open("http://ratings.fide.com/seek.phtml?idcode=&name=" + gameBlack[currentGame] + "&offset=0");
    }
  }

</script>

<style type="text/css"> 

@import url("fonts/pgn4web-font-LiberationSans.css");
 
body {
  background: white; 
  color: #4F4D44; 
  font-family: 'pgn4web Liberation Sans', sans-serif; 
  font-size: 11px;
  font-weight: bold;
  padding: 13px;
}

a {
  color: #4F4D44; 
  text-decoration: none;
}

.boardTable {
  border-style: double; 
  border-color: #CFCBB3;
  border-width: 3px;
  background: #EDE8D5;
  box-shadow: 0px 0px 13px #CFCBB3;
  -webkit-box-shadow: 0px 0px 13px #CFCBB3;
  -moz-box-shadow: 0px 0px 13px #CFCBB3;
  width: 214px;
  height: 214px;
}

.pieceImage {
  width: 20;
  height: 20;
}

.whiteSquare,
.blackSquare,
.highlightWhiteSquare,
.highlightBlackSquare {
  width: 26;
  height: 26;
  border-style: solid;
  border-width: 1;
}

.whiteSquare,
.highlightWhiteSquare {
  border-color: #EDE8D5;
  background: #EDE8D5;
}

.blackSquare,
.highlightBlackSquare {
  border-color: #CFCBB3;
  background: #CFCBB3;
}

.highlightWhiteSquare,
.highlightBlackSquare {
  border-color: #C99997;
}

.move {
}

.bottomContainer { 
  width: 214px;
  margin-top: 10px;
}

.leftHeaderItem,
.rightHeaderItem {
  white-space: nowrap;
  overflow: hidden;
  width: 102px;
}

.leftHeaderItem {
  float: left;
  text-align: left;
}

.rightHeaderItem {
  float: right;
  text-align: right;
}

</style>

</head>

<body>

<!-- paste your PGN below and make sure you dont specify an external source with SetPgnUrl() -->
<form style="display: none;"><textarea style="display: none;" id="pgnText">

</textarea></form>
<!-- paste your PGN above and make sure you dont specify an external source with SetPgnUrl() -->

<center>

<div id="GameBoard"></div>

<div id="bottomContainer" class="bottomContainer">

<div class="leftHeaderItem"><span id="GameLastMove"></span>&nbsp;</div>
<div class="rightHeaderItem"><a href="javascript:void(0);" onclick="MoveForward(1);" title="more moves available: click > to move forward" style="float:left;" id="GameMoreMoves"></a>&nbsp;<span id="GameResult"></span></div>

<div class="leftHeaderItem"><span id="GameWhite"></span>&nbsp;</div>
<div class="rightHeaderItem">&nbsp;<span id="GameBlack"></span></div>

<div class="leftHeaderItem"><span id="GameWhiteClock"></span>&nbsp;</div>
<div class="rightHeaderItem">&nbsp;<span id="GameBlackClock"></span></div>

</div>

</center>

</body>

</html>

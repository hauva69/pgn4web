<html>

<!--
  pgn4web javascript chessboard
  copyright (C) 2009, 2010 Paolo Casaschi
  see README file and http://pgn4web.casaschi.net
  for credits, license and more details
-->

<head>

<title>Basic PGN viewer form</title>

<link href="inputform.css" type="text/css" rel="stylesheet" />

<link rel="shortcut icon" href="pawn.ico" />

<script src="pgn4web.js" type="text/javascript"></script>
<script type="text/javascript">
// SetPgnUrl(""); // if set, this has precedence over the inline PGN below
   SetImagePath("merida/24"); // use "" path if images are in the same folder as this javascript file
   SetImageType("png");
   SetHighlightOption(false); // true or false
// SetGameSelectorOptions(" ...", false, 0, 0, 0, 15, 15, 0, 10); // (head, num, chEvent, chSite, chRound, chWhite, chBlack, chResult, chDate);
// SetCommentsIntoMoveText(true);
// SetCommentsOnSeparateLinesa(true);
   SetAutoplayDelay(2000); // milliseconds
// SetAutostartAutoplay(false);
// SetAutoplayNextGame(false); // if set, move to the next game at the end of the current game during autoplay
// SetInitialGame(1); // number of game to be shown at load, from 1 (default); values (keep the quotes) of "first", "last", "random" are accepted; other string values assumed as PGN search string
// SetInitialHalfmove(0,false); // halfmove number to be shown at load, 0 (default) for start position; values (keep the quotes) of "start", "end", "random" and "comment" (go to first comment) are also accepted. Second parameter if true applies the setting to every selected game instead of startup only (default)
   SetShortcutKeysEnabled(true);
</script>

</head>

<body>

<!-- paste your PGN below and make sure you dont specify an external source with SetPgnUrl() -->
<form style="display: none;"><textarea style="display: none;" id="pgnText">

</textarea></form>
<!-- paste your PGN above and make sure you dont specify an external source with SetPgnUrl() -->

<table id=chessboardTable cellspacing=0 cellpadding=0 border=0>

<tr>

<td width=230 valign=top align=left>
<div id="GameBoard"></div>
</td>

<td width=20>
</td>

<td valign=top align=left>
<span style="font-size: 14;"> 
Event: <span style="font-weight: bold; white-space: nowrap;" id="GameEvent"></span><br>
Site: <span style="font-weight: bold; white-space: nowrap;" id="GameSite"></span><br>
Round: <span style="font-weight: bold;" id="GameRound"></span><br>
Date: <span style="font-weight: bold;" id="GameDate"></span><br>
<br>
White: <span style="font-weight: bold; white-space: nowrap;" id="GameWhite"></span><br>
Black: <span style="font-weight: bold; white-space: nowrap;" id="GameBlack"></span><br>
Result: <span style="font-weight: bold;" id="GameResult"></span><br>
<br>
Last move: <span style="font-weight: bold" id="GameLastMove"></span><br>
Next move: <span style="font-weight: bold" id="GameNextMove"></span><br>
</span>
</td>

</tr>

<tr>

<td align=center valign=bottom>
<div style="height: 1.5em;">&nbsp;</div>
<div id="GameButtons"></div>
</td>

<td width=20>
</td>

<td align=center valign=bottom>	
<div id="GameSelector"></div>
<div id="GameSearch"></div>
</td>

</tr>

</table>

<br>

<form style="display:inline;" action="javascript:loadPgnFromForm()">
<input id="pgnButton" class="actionButton" type="submit" value="show games from PGN text box" title="submit PGN data; a flashing chessboard signals errors in the PGN data, click on the top left chessboard square for debug messages"> 
<br>
<textarea id="pgnForm" rows=11 cols=80 onFocus="disableShortcutKeysAndStoreStatus();" onBlur="restoreShortcutKeysStatus();" title="enter PGN data; a flashing chessboard signals errors in the PGN data, click on the top left chessboard square for debug messages"></textarea>
</form>

<script type="text/javascript">

function customFunctionOnPgnTextLoad() { 
  theObject = document.getElementById('GameSelSelect');
  if (theObject !== null) {
    theObject.style.width = document.getElementById('pgnForm').offsetWidth - 20 - 230;
  }
}

function customFunctionOnPgnGameLoad() { 
  theObject = document.getElementById('searchPgnButton');
  if (theObject !== null) { 
     theObject.style.width = (document.getElementById('pgnForm').offsetWidth - 20 - 230) / 4; 
  }
  theObject = document.getElementById('searchPgnExpression');
  if (theObject !== null) { 
    theObject.style.width = (document.getElementById('pgnForm').offsetWidth - 20 - 230) / 4 * 3;
  }
}

function customFunctionOnAlert(message_string) {
  stopAlertPrompt(); 
  alert(message_string);
}

function loadPgnFromForm() {
  firstStart = true;
  document.getElementById('pgnText').value = document.getElementById('pgnForm').value;
  document.getElementById('pgnText').value = document.getElementById('pgnText').value.replace(/\[/g,'\n\n[');
  document.getElementById('pgnText').value = document.getElementById('pgnText').value.replace(/\]/g,']\n\n');
  document.getElementById('pgnText').value = document.getElementById('pgnText').value.replace(/([012\*])(\s*)(\[)/g,'$1\n\n$3');
  document.getElementById('pgnText').value = document.getElementById('pgnText').value.replace(/\]\s*\[/g,']\n[');
  document.getElementById('pgnText').value = document.getElementById('pgnText').value.replace(/^\s*\[/g,'[');
  document.getElementById('pgnText').value = document.getElementById('pgnText').value.replace(/\n[\s*\n]+/g,'\n\n');

  start_pgn4web(); 
}


function gup( name ){
  name = name.replace(/[\[]/,"\\\[").replace(/[\]]/,"\\\]");
  var regexS = "[\\?&]"+name+"=([^&#]*)";  
  regexS = regexS+"(?!.*"+regexS+")"; // matches the LAST occurrence
  var regex = new RegExp( regexS );
  var results = regex.exec( window.location.href );
  if( results === null ) { return ""; }
  else { return results[1]; }
} 

newPgnText = gup("pgnText");
if (newPgnText === "") { newPgnText = gup("pt"); }
if (newPgnText !== "") {
  // remove URL escape chars such as %20 replaced by space
  newPgnText = decodeURIComponent(newPgnText);

  // cleans the PGN text
  newPgnText = newPgnText.replace(/\[/g,"\n\n[");
  newPgnText = newPgnText.replace(/\]/g,"]\n\n");
  newPgnText = newPgnText.replace(/([012\*])(\s*)(\[)/g,"$1\n\n$3");
  newPgnText = newPgnText.replace(/\]\s*\[/g,"]\n[");
  newPgnText = newPgnText.replace(/^\s*\[/g,"[");
  newPgnText = newPgnText.replace(/\n[\s*\n]+/g,'\n\n');

  document.getElementById('pgnText').value = newPgnText;
  document.getElementById('pgnForm').value = newPgnText;
}
document.getElementById('pgnButton').style.width = document.getElementById('pgnForm').offsetWidth;
document.getElementById('chessboardTable').style.width = document.getElementById('pgnForm').offsetWidth;

</script>

</body>

</html>




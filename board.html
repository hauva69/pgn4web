<html>

<!--
  pgn4web javascript chessboard
  copyright (C) 2009 Paolo Casaschi
  see README file and http://pgn4web.casaschi.net
  for credits, license and more details
-->

<head>

<title>chess</title>

<style type="text/css"> 

html,
body {
  margin: 0;
  padding: 0;
  font-family: sans-serif;
  color: black;
}

.boardTable {
  border-style: double;
  border-color: black;
  border-width: 3px;
}

.pieceImage {
}

.whiteSquare {
}

.blackSquare {
}

.highlightWhiteSquare {
}

.highlightBlackSquare {
}

.selectControl {}
.buttonControlPlay {}
.buttonControlStop {}
.buttonControl {}
.buttonControlSpace {}
/* a "width" attribute here must use the !important flag to override default settings */

.header {
  color: black;
  font-weight: bold;
}

.move {
  color: black;
  text-decoration: none;   
}

.moveOn {
  color: black;
  text-decoration: none;   
  background: #DAF4D7;
}

.comment
{
  color: gray;
}

.nag {
  color: gray;
}

</style>

<script src="pgn4web.js" type="text/javascript"></script>

</head>

<body>

<!-- paste your PGN below and make sure you dont specify an external source with SetPgnUrl() -->
<span style="display:none" id="pgnText">

</span>
<!-- paste your PGN above and make sure you dont specify an external source with SetPgnUrl() -->

<script>

function new_start_pgn4web() {

  document.body.style.background = backgroundColor;
  document.body.style.padding = framePadding;
  
  rule = getCSSRule('.pieceImage');
  rule.style.width = pieceSize;
  rule.style.height = pieceSize;

  rule = getCSSRule('.whiteSquare');
  rule.style.width = squareSize + 'px';	
  rule.style.height = squareSize + 'px';
  rule.style.background = lightColor;
  rule = getCSSRule('.blackSquare');
  rule.style.width = squareSize + 'px';	
  rule.style.height = squareSize + 'px';
  rule.style.background = darkColor;
  rule = getCSSRule('.highlightWhiteSquare');
  rule.style.width = squareSize + 'px';	
  rule.style.height = squareSize + 'px';
  rule.style.background = highlightLightColor;
  rule = getCSSRule('.highlightBlackSquare');
  rule.style.width = squareSize + 'px';	
  rule.style.height = squareSize + 'px';
  rule.style.background = highlightDarkColor;
  rule = getCSSRule('.boardTable');
  rule.style.borderColor = boardBorderColor;

  rule = getCSSRule('.move');
  rule.style.color = fontMovesColor;
  if (!fontMovesSize.match(/[^0-9]/)) { fontMovesSize += 'px'; }
  rule.style.fontSize = fontMovesSize;

  rule = getCSSRule('.moveOn');
  if (highlightMoveColor == 'none') { rule.style.background = backgroundColor; }
  else { rule.style.background = highlightMoveColor; }
  rule.style.color = fontMovesColor;
  if (!fontMovesSize.match(/[^0-9]/)) { fontMovesSize += 'px'; }
  rule.style.fontSize = fontMovesSize;

  rule = getCSSRule('.header');
  rule.style.color = fontHeaderColor;
  if (!fontHeaderSize.match(/[^0-9]/)) { fontHeaderSize += 'px'; }
  rule.style.fontSize = fontHeaderSize;

  rule = getCSSRule('.comment');
  rule.style.color = fontCommentsColor;
  rule.style.fontSize = fontCommentsSize;
  if (!fontCommentsSize.match(/[^0-9]/)) { fontCommentsSize += 'px'; }
  rule.style.fontSize = fontCommentsSize;

  rule = getCSSRule('.nag');
  rule.style.color = fontCommentsColor;
//  rule.style.fontSize = fontCommentsSize; // the nag is always embedded in the comment

  paddingControlHeight = Math.floor(squareSize / 2.5);
  theObject = document.getElementById("GameButtons");
  if (theObject) { theObject.style.paddingTop = paddingControlHeight; }
  if ((controlBackgroundColor != 'default') && (controlBackgroundColor != '#default')) { 
    rule1 = getCSSRule('.buttonControl');
    rule2 = getCSSRule('.buttonControlPlay');
    rule3 = getCSSRule('.buttonControlStop');
    rule1.style.borderStyle = rule2.style.borderStyle = rule3.style.borderStyle = 'solid';
    rule1.style.borderWidth = rule2.style.borderWidth = rule3.style.borderWidth = '0px';
    rule1.style.borderColor = rule2.style.borderColor = rule3.style.borderColor = backgroundColor;
    rule1.style.backgroundColor = rule2.style.backgroundColor = rule3.style.backgroundColor = controlBackgroundColor;
    rule1.style.color = rule2.style.color = rule3.style.color = controlTextColor;
    controlFontSize = Math.floor(squareSize / 2.5);
    rule1.style.fontSize = rule2.style.fontSize = rule3.style.fontSize = controlFontSize + 'px';
  }

  if ((controlBackgroundColor != 'default') && (controlBackgroundColor != '#default')) {
    rule = getCSSRule('.selectControl');
    rule.style.borderStyle = 'solid';
    rule.style.padding = '3px';
    rule.style.borderWidth = '1px';
    rule.style.borderColor = backgroundColor;
    rule.style.backgroundColor = controlBackgroundColor;
    rule.style.color = controlTextColor;
    rule.style.fontSize = controlFontSize + 'px';
  }

  theObject = document.getElementById("headerMovesPadding");
  if (theObject) { theObject.style.minHeight = paddingControlHeight; }

  start_pgn4web();

  theObject = document.getElementById("GameSelector");
  if (theObject) { if (theObject.innerHTML != "") { theObject.style.paddingBottom = paddingControlHeight; } }

  boardHeight = document.getElementById("boardTable").offsetHeight;
  document.getElementById("boardTable").style.width = boardHeight;
  boardWidth = document.getElementById("boardTable").offsetWidth;
  if (showButtons) { boardHeight += document.getElementById("GameButtons").offsetHeight }
  if (showButtons && (numberOfGames > 1)) { boardHeight += document.getElementById("GameSelector").offsetHeight }

  theObject = document.getElementById("headerMoves");
  if (theObject != null) { 
    if (frameWidth == "") { document.getElementById("headerMoves").style.width = textWidth; }
    else { document.getElementById("headerMoves").style.width = frameWidth; }

    if (frameHeight == "") { document.getElementById("headerMoves").style.height = textHeight; }
    else { 
      headerMovesPaddingHeight = document.getElementById("headerMovesPadding").offsetHeight;
      document.getElementById("headerMoves").style.height = frameHeight - boardHeight - 2 * framePadding - headerMovesPaddingHeight; 
    }
  }

  if (gup("showHeightWidth") != "") { 
    alert("board dimensions\n\nwidth: " + boardWidth + "\nheight: " + boardHeight);
  }
}

window.onload = new_start_pgn4web;

function getCSSRule(ruleName, deleteFlag) {               // Return requested style obejct
   ruleName=ruleName.toLowerCase();                       // Convert test string to lower case.
   if (document.styleSheets) {                            // If browser can play with stylesheets
      for (var i=0; i<document.styleSheets.length; i++) { // For each stylesheet
         var styleSheet=document.styleSheets[i];          // Get the current Stylesheet
         var ii=0;                                        // Initialize subCounter.
         var cssRule=false;                               // Initialize cssRule. 
         do {                                             // For each rule in stylesheet
            if (styleSheet.cssRules) {                    // Browser uses cssRules?
               cssRule = styleSheet.cssRules[ii];         // Yes --Mozilla Style
            } else {                                      // Browser usses rules?
               cssRule = styleSheet.rules[ii];            // Yes IE style. 
            }                                             // End IE check.
	    if (cssRule)  {                               // If we found a rule...
     	      if (cssRule.selectorText.toLowerCase()==ruleName) { //  match ruleName?
  	        if (deleteFlag=='delete') {             // Yes.  Are we deleteing?
                     if (styleSheet.cssRules) {           // Yes, deleting...
                        styleSheet.deleteRule(ii);        // Delete rule, Moz Style
                     } else {                             // Still deleting.
                        styleSheet.removeRule(ii);        // Delete rule IE style.
                     }                                    // End IE check.
                     return true;                         // return true, class deleted.
                  } else {                                // found and not deleting.
                     return cssRule;                      // return the style object.
                  }                                       // End delete Check
               }                                          // End found rule name
            }                                             // end found cssRule
            ii++;                                         // Increment sub-counter
         } while (cssRule)                                // end While loop
      }                                                   // end For loop
   }                                                      // end styleSheet ability check
   return false;                                          // we found NOTHING!
}                                                         // end getCSSRule 

function killCSSRule(ruleName) {                          // Delete a CSS rule   
   return getCSSRule(ruleName,'delete');                  // just call getCSSRule w/delete flag.
}                                                         // end killCSSRule

function addCSSRule(ruleName) {                           // Create a new css rule
   if (document.styleSheets) {                            // Can browser do styleSheets?
      if (!getCSSRule(ruleName)) {                        // if rule doesn't exist...
         if (document.styleSheets[0].addRule) {           // Browser is IE?
            document.styleSheets[0].addRule(ruleName, null,0);      // Yes, add IE style
         } else {                                         // Browser is IE?
            document.styleSheets[0].insertRule(ruleName+' { }', 0); // Yes, add Moz style.
         }                                                // End browser check
      }                                                   // End already exist check.
   }                                                      // End browser ability check.
   return getCSSRule(ruleName);                           // return rule we just created.
} 


function percentFixFromUrl( text ) {
  text += ''; // makes sure text is a string
  return text.replace(/pct$/,'%');
}


var encodingCharSet = "$0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_";
var encodingVersion = 1;
// version 1 of PGN encoding:
//   encodedPGN = nnn*xxx0
//   nnn = number representing bytes length of the decoded message
//   * = star char
//   xxx = encoded text (using LetterCodes below)
//   0 = zero char (version marker)

function DecodePGN(bytes) {

  if (bytes.charAt(bytes.length - 1) != encodingCharSet.charAt(encodingVersion)) {
    alert("ERROR: PGN encoding version mismatch (e:" + 
           bytes.charAt(bytes.length - 1) + " d:" + encodingCharSet.charAt(encodingVersion) + ")");
  } else {
    bytes.length--;
  }

  originalLength = parseInt(bytes.match(/^[0-9]*/));
  bytes = bytes.replace(/^[0-9]*\*/,"");

  l = new Array();
  l[0] = -146;
  l[1] = -111;
  l[2] = -66;
  l[3] = -55;
  l[4] = -6;
  l[5] = 46;
  l[6] = -8;
  l[7] = 66;
  l[8] = -10;
  l[9] = 105;
  l[10] = -12;
  l[11] = 107;
  l[12] = -14;
  l[13] = 44;
  l[14] = -16;
  l[15] = 85;
  l[16] = -18;
  l[17] = 106;
  l[18] = -20;
  l[19] = 62;
  l[20] = -22;
  l[21] = 89;
  l[22] = -24;
  l[23] = 38;
  l[24] = -40;
  l[25] = -33;
  l[26] = -30;
  l[27] = -29;
  l[28] = 17;
  l[29] = 18;
  l[30] = -32;
  l[31] = 15;
  l[32] = 16;
  l[33] = -37;
  l[34] = -36;
  l[35] = 21;
  l[36] = 22;
  l[37] = -39;
  l[38] = 19;
  l[39] = 20;
  l[40] = -48;
  l[41] = -45;
  l[42] = -44;
  l[43] = 7;
  l[44] = 8;
  l[45] = -47;
  l[46] = 5;
  l[47] = 6;
  l[48] = -52;
  l[49] = -51;
  l[50] = 12;
  l[51] = 14;
  l[52] = -54;
  l[53] = 9;
  l[54] = 11;
  l[55] = -57;
  l[56] = 34;
  l[57] = -59;
  l[58] = 78;
  l[59] = -61;
  l[60] = 57;
  l[61] = -63;
  l[62] = 63;
  l[63] = -65;
  l[64] = 109;
  l[65] = 119;
  l[66] = -80;
  l[67] = -69;
  l[68] = 101;
  l[69] = -71;
  l[70] = 55;
  l[71] = -73;
  l[72] = 69;
  l[73] = -75;
  l[74] = 118;
  l[75] = -77;
  l[76] = 121;
  l[77] = -79;
  l[78] = 73;
  l[79] = 123;
  l[80] = -82;
  l[81] = 49;
  l[82] = -86;
  l[83] = -85;
  l[84] = 13;
  l[85] = 40;
  l[86] = -88;
  l[87] = 45;
  l[88] = -90;
  l[89] = 68;
  l[90] = -92;
  l[91] = 84;
  l[92] = -94;
  l[93] = 125;
  l[94] = -96;
  l[95] = 39;
  l[96] = -98;
  l[97] = 58;
  l[98] = -100;
  l[99] = 36;
  l[100] = -102;
  l[101] = 92;
  l[102] = -104;
  l[103] = 124;
  l[104] = -108;
  l[105] = -107;
  l[106] = 3;
  l[107] = 4;
  l[108] = -110;
  l[109] = 0;
  l[110] = 2;
  l[111] = -129;
  l[112] = -118;
  l[113] = -115;
  l[114] = 50;
  l[115] = -117;
  l[116] = 102;
  l[117] = 103;
  l[118] = -122;
  l[119] = -121;
  l[120] = 48;
  l[121] = 110;
  l[122] = -126;
  l[123] = -125;
  l[124] = 10;
  l[125] = 1;
  l[126] = -128;
  l[127] = 79;
  l[128] = 117;
  l[129] = -137;
  l[130] = -132;
  l[131] = 51;
  l[132] = -134;
  l[133] = 98;
  l[134] = -136;
  l[135] = 47;
  l[136] = 112;
  l[137] = -141;
  l[138] = -140;
  l[139] = 56;
  l[140] = 81;
  l[141] = -143;
  l[142] = 104;
  l[143] = -145;
  l[144] = 114;
  l[145] = 115;
  l[146] = -192;
  l[147] = -153;
  l[148] = -150;
  l[149] = 32;
  l[150] = -152;
  l[151] = 91;
  l[152] = 93;
  l[153] = -157;
  l[154] = -156;
  l[155] = 99;
  l[156] = 120;
  l[157] = -159;
  l[158] = 116;
  l[159] = -161;
  l[160] = 75;
  l[161] = -163;
  l[162] = 80;
  l[163] = -165;
  l[164] = 67;
  l[165] = -167;
  l[166] = 77;
  l[167] = -169;
  l[168] = 90;
  l[169] = -171;
  l[170] = 60;
  l[171] = -173;
  l[172] = 33;
  l[173] = -175;
  l[174] = 37;
  l[175] = -177;
  l[176] = 96;
  l[177] = -185;
  l[178] = -182;
  l[179] = -181;
  l[180] = 248;
  l[181] = 249;
  l[182] = -184;
  l[183] = 246;
  l[184] = 247;
  l[185] = -189;
  l[186] = -188;
  l[187] = 252;
  l[188] = 253;
  l[189] = -191;
  l[190] = 250;
  l[191] = 251;
  l[192] = -228;
  l[193] = -225;
  l[194] = -196;
  l[195] = 52;
  l[196] = -198;
  l[197] = 108;
  l[198] = -208;
  l[199] = -201;
  l[200] = 83;
  l[201] = -205;
  l[202] = -204;
  l[203] = 61;
  l[204] = 72;
  l[205] = -207;
  l[206] = 113;
  l[207] = 122;
  l[208] = -212;
  l[209] = -211;
  l[210] = 65;
  l[211] = 70;
  l[212] = -214;
  l[213] = 71;
  l[214] = -216;
  l[215] = 76;
  l[216] = -218;
  l[217] = 74;
  l[218] = -220;
  l[219] = 88;
  l[220] = -222;
  l[221] = 64;
  l[222] = -224;
  l[223] = 42;
  l[224] = 94;
  l[225] = -227;
  l[226] = 53;
  l[227] = 100;
  l[228] = -232;
  l[229] = -231;
  l[230] = 54;
  l[231] = 82;
  l[232] = -234;
  l[233] = 97;
  l[234] = -236;
  l[235] = 111;
  l[236] = -238;
  l[237] = 43;
  l[238] = -240;
  l[239] = 87;
  l[240] = -242;
  l[241] = 41;
  l[242] = -244;
  l[243] = 86;
  l[244] = -246;
  l[245] = 35;
  l[246] = -256;
  l[247] = -249;
  l[248] = 59;
  l[249] = -251;
  l[250] = 95;
  l[251] = -253;
  l[252] = 126;
  l[253] = -255;
  l[254] = 254;
  l[255] = 255;
  l[256] = -384;
  l[257] = -321;
  l[258] = -290;
  l[259] = -275;
  l[260] = -268;
  l[261] = -265;
  l[262] = -264;
  l[263] = 160;
  l[264] = 161;
  l[265] = -267;
  l[266] = 158;
  l[267] = 159;
  l[268] = -272;
  l[269] = -271;
  l[270] = 164;
  l[271] = 165;
  l[272] = -274;
  l[273] = 162;
  l[274] = 163;
  l[275] = -283;
  l[276] = -280;
  l[277] = -279;
  l[278] = 152;
  l[279] = 153;
  l[280] = -282;
  l[281] = 150;
  l[282] = 151;
  l[283] = -287;
  l[284] = -286;
  l[285] = 156;
  l[286] = 157;
  l[287] = -289;
  l[288] = 154;
  l[289] = 155;
  l[290] = -306;
  l[291] = -299;
  l[292] = -296;
  l[293] = -295;
  l[294] = 176;
  l[295] = 177;
  l[296] = -298;
  l[297] = 174;
  l[298] = 175;
  l[299] = -303;
  l[300] = -302;
  l[301] = 180;
  l[302] = 181;
  l[303] = -305;
  l[304] = 178;
  l[305] = 179;
  l[306] = -314;
  l[307] = -311;
  l[308] = -310;
  l[309] = 168;
  l[310] = 169;
  l[311] = -313;
  l[312] = 166;
  l[313] = 167;
  l[314] = -318;
  l[315] = -317;
  l[316] = 172;
  l[317] = 173;
  l[318] = -320;
  l[319] = 170;
  l[320] = 171;
  l[321] = -353;
  l[322] = -338;
  l[323] = -331;
  l[324] = -328;
  l[325] = -327;
  l[326] = 128;
  l[327] = 129;
  l[328] = -330;
  l[329] = 31;
  l[330] = 127;
  l[331] = -335;
  l[332] = -334;
  l[333] = 132;
  l[334] = 133;
  l[335] = -337;
  l[336] = 130;
  l[337] = 131;
  l[338] = -346;
  l[339] = -343;
  l[340] = -342;
  l[341] = 25;
  l[342] = 26;
  l[343] = -345;
  l[344] = 23;
  l[345] = 24;
  l[346] = -350;
  l[347] = -349;
  l[348] = 29;
  l[349] = 30;
  l[350] = -352;
  l[351] = 27;
  l[352] = 28;
  l[353] = -369;
  l[354] = -362;
  l[355] = -359;
  l[356] = -358;
  l[357] = 144;
  l[358] = 145;
  l[359] = -361;
  l[360] = 142;
  l[361] = 143;
  l[362] = -366;
  l[363] = -365;
  l[364] = 148;
  l[365] = 149;
  l[366] = -368;
  l[367] = 146;
  l[368] = 147;
  l[369] = -377;
  l[370] = -374;
  l[371] = -373;
  l[372] = 136;
  l[373] = 137;
  l[374] = -376;
  l[375] = 134;
  l[376] = 135;
  l[377] = -381;
  l[378] = -380;
  l[379] = 140;
  l[380] = 141;
  l[381] = -383;
  l[382] = 138;
  l[383] = 139;
  l[384] = -448;
  l[385] = -417;
  l[386] = -402;
  l[387] = -395;
  l[388] = -392;
  l[389] = -391;
  l[390] = 224;
  l[391] = 225;
  l[392] = -394;
  l[393] = 222;
  l[394] = 223;
  l[395] = -399;
  l[396] = -398;
  l[397] = 228;
  l[398] = 229;
  l[399] = -401;
  l[400] = 226;
  l[401] = 227;
  l[402] = -410;
  l[403] = -407;
  l[404] = -406;
  l[405] = 216;
  l[406] = 217;
  l[407] = -409;
  l[408] = 214;
  l[409] = 215;
  l[410] = -414;
  l[411] = -413;
  l[412] = 220;
  l[413] = 221;
  l[414] = -416;
  l[415] = 218;
  l[416] = 219;
  l[417] = -433;
  l[418] = -426;
  l[419] = -423;
  l[420] = -422;
  l[421] = 240;
  l[422] = 241;
  l[423] = -425;
  l[424] = 238;
  l[425] = 239;
  l[426] = -430;
  l[427] = -429;
  l[428] = 244;
  l[429] = 245;
  l[430] = -432;
  l[431] = 242;
  l[432] = 243;
  l[433] = -441;
  l[434] = -438;
  l[435] = -437;
  l[436] = 232;
  l[437] = 233;
  l[438] = -440;
  l[439] = 230;
  l[440] = 231;
  l[441] = -445;
  l[442] = -444;
  l[443] = 236;
  l[444] = 237;
  l[445] = -447;
  l[446] = 234;
  l[447] = 235;
  l[448] = -480;
  l[449] = -465;
  l[450] = -458;
  l[451] = -455;
  l[452] = -454;
  l[453] = 192;
  l[454] = 193;
  l[455] = -457;
  l[456] = 190;
  l[457] = 191;
  l[458] = -462;
  l[459] = -461;
  l[460] = 196;
  l[461] = 197;
  l[462] = -464;
  l[463] = 194;
  l[464] = 195;
  l[465] = -473;
  l[466] = -470;
  l[467] = -469;
  l[468] = 184;
  l[469] = 185;
  l[470] = -472;
  l[471] = 182;
  l[472] = 183;
  l[473] = -477;
  l[474] = -476;
  l[475] = 188;
  l[476] = 189;
  l[477] = -479;
  l[478] = 186;
  l[479] = 187;
  l[480] = -496;
  l[481] = -489;
  l[482] = -486;
  l[483] = -485;
  l[484] = 208;
  l[485] = 209;
  l[486] = -488;
  l[487] = 206;
  l[488] = 207;
  l[489] = -493;
  l[490] = -492;
  l[491] = 212;
  l[492] = 213;
  l[493] = -495;
  l[494] = 210;
  l[495] = 211;
  l[496] = -504;
  l[497] = -501;
  l[498] = -500;
  l[499] = 200;
  l[500] = 201;
  l[501] = -503;
  l[502] = 198;
  l[503] = 199;
  l[504] = -508;
  l[505] = -507;
  l[506] = 204;
  l[507] = 205;
  l[508] = -510;
  l[509] = 202;
  l[510] = 203;

  e=b=a=0;
  o="";

  function B() { if(a==0) { b=encodingCharSet.indexOf(bytes.charAt(e++)); a=6; } return ((b>>--a)&0x01); }
  
  while(originalLength>0) { i=0; 
    while(l[i]<0) { 
      if(B()) i=-l[i];
      else i++;
    }
    o+=String.fromCharCode(l[i]);
    originalLength--;
  }

  return o;
}


function gup( name ){

  name = name.replace(/[\[]/,"\\\[").replace(/[\]]/,"\\\]");
  var regexS = "[\\?&]"+name+"=([^&#]*)";  
  regexS = regexS+"(?!.*"+regexS+")"; // matches the LAST occurrence
  var regex = new RegExp( regexS );
  var results = regex.exec( window.location.href );
  if( results != null ) { switch (results[1]) {
    case "t": case "T": return "true";  break;
    case "f": case "F": return "false"; break;
    default: return results[1]; 
  } }

  // allows for short version of the URL parameters, for instance sC matches squareColor
  compact_name = name.charAt(0);
  for(i=1; i<name.length; i++){
    if (name.charAt(i).match(/[A-Z]/)) { compact_name = compact_name + name.charAt(i).toLowerCase(); }
  }
  name = compact_name;
  
  name = name.replace(/[\[]/,"\\\[").replace(/[\]]/,"\\\]");
  var regexS = "[\\?&]"+name+"=([^&#]*)";  
  regexS = regexS+"(?!.*"+regexS+")"; // matches the LAST occurrence
  var regex = new RegExp( regexS );

  var results = regex.exec( window.location.href );
  if( results != null ) { switch (results[1]) {
    case "t": case "T": return "true";  break;
    case "f": case "F": return "false"; break;
    default: return results[1]; 
  } }
  
  return "";
}

SetHighlightOption(true);
SetShortcutKeysEnabled(false);

if ((pieceFont = gup("pieceFont")) == "")
  if ((pieceFont = gup("font")) == "") 
    { pieceFont = "alpha"; } // left for compatibility with older version

if ((pieceSize = gup("pieceSize")) == "") { pieceSize = 24; }
else { pieceSize = parseInt(pieceSize); }

SetImagePath(pieceFont + "/" + pieceSize);

if ((squareSize = gup("squareSize")) == "") { squareSize = 28; }
else { squareSize = parseInt(squareSize); }

if ((lightColor = gup("lightColorName")) == "") {if ((lightColor = "#" + gup("lightColorHex")) == "#") lightColor = "#EFF4EC"}
if ((darkColor  = gup("darkColorName"))  == "") {if ((darkColor  = "#" + gup("darkColorHex"))  == "#") darkColor  = "#C6CEC3"}
if ((highlightColor  = gup("highlightColorName"))  == "") {if ((highlightColor  = "#" + gup("highlightColorHex"))  == "#") highlightColor  = "#DAF4D7"}
if ((highlightColor == 'none') || (highlightColor == '#none')) {
  highlightLightColor = lightColor;
  highlightDarkColor = darkColor;
} else { 
  highlightLightColor = highlightColor;
  highlightDarkColor = highlightColor;
}

if ((boardBorderColor = gup("boardBorderColorName")) == "") {if ((boardBorderColor = "#" + gup("boardBorderColorHex")) == "#") boardBorderColor = "#000000"}

if ((highlightMoveColor  = gup("highlightMoveColorName"))  == "") {if ((highlightMoveColor  = "#" + gup("highlightMoveColorHex"))  == "#") highlightMoveColor  = "#DAF4D7"}

if ((backgroundColor = gup("backgroundColorName")) == "") {if ((backgroundColor = "#" + gup("backgroundColorHex")) == "#") backgroundColor = "#FFFFFF"}

if ((framePadding = percentFixFromUrl( gup("framePadding") )) == "") { framePadding = 0;}

if ((fontHeaderSize = percentFixFromUrl( gup("fontHeaderSize") )) == "") { fontHeaderSize = "100%"; }
if ((fontHeaderColor = gup("fontHeaderColorName")) == "") {if ((fontHeaderColor = "#" + gup("fontHeaderColorHex")) == "#") fontHeaderColor = "black"}

if ((fontMovesSize = percentFixFromUrl( gup("fontMovesSize") )) == "") { fontMovesSize = "100%"; }
if ((fontMovesColor = gup("fontMovesColorName")) == "") {if ((fontMovesColor = "#" + gup("fontMovesColorHex")) == "#") fontMovesColor = "black"}

if ((fontCommentsSize = percentFixFromUrl( gup("fontCommentsSize") )) == "") { fontCommentsSize = "100%"; }
if ((fontCommentsColor = gup("fontCommentsColorName")) == "") {if ((fontCommentsColor = "#" + gup("fontCommentsColorHex")) == "#") fontCommentsColor = "gray"}

if (gup("auto") == "false") { SetAutostartAutoplay(false); }
else { SetAutostartAutoplay(true); }
 
if (gup("loop") == "true") { SetAutoplayNextGame(true); }
else { SetAutoplayNextGame(false); }

if (gup("delay") == "") SetAutoplayDelay(1000);
else SetAutoplayDelay(gup("delay"));

if (gup("showButtons") == "true") { showButtons = true }
else { showButtons = false }

if ((controlBackgroundColor = gup("controlBackgroundColorName")) == "") {if ((controlBackgroundColor = "#" + gup("controlBackgroundColorHex")) == "#") controlBackgroundColor = "default"}
if ((controlTextColor = gup("controlTextColorName")) == "") {if ((controlTextColor = "#" + gup("controlTextColorHex")) == "#") controlTextColor = "black"}

if (gup("showComments") == "false") { SetCommentsIntoMoveText(false); }
if (gup("showCommentsOnSeparateLines") == "true") { SetCommentsOnSeparateLines(true); }

if ((fenString = gup("fenString")) != "") {
  // remove URL escape chars such as %20 replaced by space
  fenString = decodeURIComponent(fenString);
  document.getElementById('pgnText').innerHTML = '[FEN "' + fenString + '"]';
}

if ((newPgnText = gup("pgnText")) != "") {

  // remove URL escape chars such as %20 replaced by space
  newPgnText = decodeURIComponent(newPgnText);

  // cleans the PGN text
  newPgnText = newPgnText.replace(/\[/g,"\n\n[");
  newPgnText = newPgnText.replace(/\]/g,"]\n\n");
  newPgnText = newPgnText.replace(/([012\*])([\s]*)(\[)/g,"$1\n\n$3");
  newPgnText = newPgnText.replace(/\]([\s]*)\[/g,"]\n[");
  newPgnText = newPgnText.replace(/^([\s]*)\[/g,"[");

  document.getElementById('pgnText').innerHTML = newPgnText;
} 

if ((newPgnEncoded = gup("pgnEncoded")) != "") {

  newPgnDecoded = DecodePGN(newPgnEncoded);

  // cleans the PGN text
  newPgnDecoded = newPgnDecoded.replace(/\[/g,"\n\n[");
  newPgnDecoded = newPgnDecoded.replace(/\]/g,"]\n\n");
  newPgnDecoded = newPgnDecoded.replace(/([012\*])([\s]*)(\[)/g,"$1\n\n$3");
  newPgnDecoded = newPgnDecoded.replace(/\]([\s]*)\[/g,"]\n[");
  newPgnDecoded = newPgnDecoded.replace(/^([\s]*)\[/g,"[");

  document.getElementById('pgnText').innerHTML = newPgnDecoded;
} 

if ((newPgnEncoded != "") && ((newPgnText != "") || (fenString != ""))) {
  alert("WARNING: pgnEncoded value superseeds pgnText and/or fenString values.");
}

if ((fenString != "") && (newPgnText != "")) {
  alert("WARNING: pgnText value superseeds fenString value.");
}

if (gup("showHeader") == "true") { showHeader = true }
else { showHeader = false }

if (gup("showMoves") == "true") { showMoves = true }
else { showMoves = false }

if ((textHeight = percentFixFromUrl( gup("textHeight") )) == "") { textHeight="100%" }
if ((textWidth = percentFixFromUrl( gup("textWidth") )) == "") { textWidth="100%" }
if ((textMargin = percentFixFromUrl( gup("textMargin") )) == "") { textMargin=0 }

frameHeight = percentFixFromUrl( gup("frameHeight") );
frameWidth = percentFixFromUrl( gup("frameWidth") );

if (gup("help") != "") {
  document.write("<PRE>");
  document.write("URL parameters\n");
  document.write("\n");
  document.write(" - pgnText = PGN games to display\n");
  document.write(" - pgnEncoded = encoded PGN games to display (used only by the board generator tool)\n");
  document.write(" - fenString = FEN position to display, superceded by pgnText if set\n");
  document.write("\n");
  document.write(" - auto = if set true, autoplays game, otherwise if false (default true)\n");
  document.write(" - delay = autoplay delay in ms (default 1000)\n");
  document.write(" - loop = if set true, loop indefinitely through games (default false)\n");
  document.write("\n");
  document.write(" - pieceFont = alpha | merida | uscf (default alpha)\n");
  document.write(" - pieceSize = size of pieces (default 24)\n");
  document.write(" - squareSize = size of square (default 28)\n");
  document.write(" - lightColorName = light square color name, like red\n");
  document.write(" - darkColorName = dark square color name, like red\n");
  document.write(" - highlightColorName = highlight color name, like red, 'none' for no highligh\n");
  document.write(" - boardBorderColorName = board border color name, like red, 'none' for no highligh\n");
  document.write(" - lightColorHex = light square color hex code, like FF0000 (default EFF4EC)\n");
  document.write(" - darkColorHex = dark square color hex code, like FF0000 (default C6CEC3)\n");
  document.write(" - highlightColorHex = highlight color hex code, like FF0000, 'none' for no highligh (default DAF4D7)\n");
  document.write(" - boardBorderColorHex = board border color hex code, like FF0000, 'none' for no highligh (default 000000)\n");
  document.write("\n");
  document.write(" - showButtons = if set true, prints control buttons (default false)\n");
  document.write(" - controlBackgroundColorName = control buttons background color name, like red, or 'default' (default 'default')\n");
  document.write(" - controlBackgroundColorHex = control buttons background color hex code, like FF0000, or 'default'\n");
  document.write(" - controlTextColorName = control buttons text color name, like red (default black)\n");
  document.write(" - controlTextColorHex = control buttons text color hex code, like FF0000\n");
  document.write("\n");
  document.write(" - showHeader = if set true, displays game header text (default false)\n");
  document.write(" - showMoves = if set true, displays moves text (default false)\n");
  document.write(" - textHeight = set height of the textual section, header and/or moves text, might be ingored if frameHeight is set (default 100%)\n");
  document.write(" - textWidth = set width of the textual section, header and/or moves text, might be ignored if frameWidth is set (default 100%)\n");
  document.write(" - textMargin = set left/right margin width of the  textual section, header and/or moves text (default 0)\n");
  document.write(" - showComments = if set false, removes comments when displaying moves text (default true)\n");
  document.write(" - showCommentsOnSeparateLines = if set true, add newlines chars when displaying comments (default false)\n"); 
  document.write(" - fontHeaderColorName = header color name, like red (default black)\n");
  document.write(" - fontMovesColorName = moves color name, like red (default black)\n");
  document.write(" - fontCommentsColorName = comments color name, like red (default gray)\n");
  document.write(" - highlightMoveColorName = background color name to highlight current move, like red, 'none' for no highligh\n");
  document.write(" - fontHeaderColorHex = header color hex code, like FF0000\n");
  document.write(" - fontMovesColorHex = moves color hex code, like FF0000\n");
  document.write(" - fontCommentsColorHex = commentss color hex code, like FF0000\n");
  document.write(" - highlightMoveColorHex = background color hex code to highlight current move, like FF0000, 'none' for no highligh (default DAF4D7)\n");
  document.write(" - fontHeaderSize = header font size, like 20 or 120% (default 100pct meaning 100%)\n");
  document.write(" - fontMovesSize = header font size, like 20 or 120% (default 100pct meaning 100%)\n");
  document.write(" - fontCommentsSize = header font size, like 20 or 120% (default 100pct meaning 100%)\n");
  document.write("\n");
  document.write(" - backgroundColorName = page background color name, like red\n");
  document.write(" - backgroundColorHex = page background color hex code, like FF0000\n");
  document.write(" - frameHeight = set height of the total page, overriding textHeight (default not set)\n");
  document.write(" - frameWidth = set width of the total page, overriding textWidth (default not set)\n");
  document.write(" - framePadding = padding within the frame (default 0)\n");
  document.write("\n");
  document.write(" - showHeightWidth = if set true, calculates optimal iframe dimensions (default false)\n");
  document.write(" - help = if set true, shows help info (default false)\n");
  document.write("\n");
  document.write("URL parameters can be shortened: for example squareSize => sq, auto => a, highlightMoveColorHex => hmch\n");
  document.write("Also values true and false can be shortened: true => t, false => f\n");
  document.write("</PRE>\n<HR>\n");
}

document.write("<table cellspacing=0 cellpadding=0 width=100%><tr><td align=center>");

if (showButtons) {
  document.write("<div id='GameSelector'></div></td></tr><tr><td align=center><div id='GameBoard'></div></td></tr><tr><td align=center><div id='GameButtons'></div>") 
} else {
  document.write("<div id='GameBoard'></div>")
}

if (showHeader) {
  document.write("<div id='headerMovesPadding' class='header'>&nbsp;</div>");
} else if (showMoves) {
  document.write("<div id='headerMovesPadding' class='moves'>&nbsp;</div>");
}

if ((showHeader) || (showMoves)) {
  document.write("<div id='headerMoves' style='overflow:auto; height: " + textHeight + "; width: " + textWidth + "; scrollbar-base-color: " + backgroundColor + ";'>")
} 

if (showHeader) {

  document.write("<table width=100% cellpadding=0 cellspacing=0 border=0><tr>");
  document.write("<td width=48% align=left>");
  document.write("<div class='header' style=' margin-left:" + textMargin + "; white-space: nowrap;' id=GameWhite></div>");
  document.write("</td><td width=4%><div class='header'></div></td><td width=48% align=right>");
  document.write("<div class='header' style=' margin-right:" + textMargin + ";' id=GameDate></div>");
  document.write("</td></tr></table>");

  document.write("<table width=100% cellpadding=0 cellspacing=0 border=0><tr>");
  document.write("<td width=48% align=left>");
  document.write("<div class='header' style=' margin-left:" + textMargin + "; white-space: nowrap;' id=GameBlack></div>");
  document.write("</td><td width=4%><div class='header'></div></td><td width=48% align=right>");
  document.write("<div class='header' style=' margin-right:" + textMargin + "; white-space: nowrap;' id=GameSite></div>");
  document.write("</td></tr></table>");

  document.write("<table width=100% cellpadding=0 cellspacing=0 border=0><tr>");
  document.write("<td width=48% align=left>");
  document.write("<div class='header' style=' margin-left:" + textMargin + ";' id=GameResult></div>");
  document.write("</td><td width=4%><div class='header'></div></td><td width=48% align=right>");
  document.write("<div class='header' style=' margin-right:" + textMargin + "; white-space: nowrap;' id=GameEvent></div>");
  document.write("</td></tr></table>");

}

if ((showHeader) && (showMoves)) {
  document.write("<div class='header'>&nbsp;<br></div>");
}

if (showMoves) {
  document.write("<div style='text-align: justify; margin-right:" + textMargin + "; margin-left:" + textMargin + ";' id=GameText></div>");
}

if ((showHeader) || (showMoves)) {
  document.write("</div>")
} 

document.write("</div>");

document.write("</td></tr></table>");
		
</script>

</body>

</html>


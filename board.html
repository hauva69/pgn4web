<html>

<!--
  pgn4web javascript chessboard
  copyright (C) 2009 Paolo Casaschi
  see README file and http://pgn4web.casaschi.net
  for credits, license and more details
-->

<head>

<title>chess</title>

<style type="text/css"> 

@import url("fonts/pgn4web-fonts.css");

html,
body {
  margin: 0;
  padding: 0;
  font-family: 'pgn4web Liberation Sans', sans-serif;
  line-height: 1.3em;
  color: black;
}

.boardTable {
  border-style: double;
  border-color: black;
  border-width: 3px;
}

.pieceImage {
}

.whiteSquare {
}

.blackSquare {
}

.highlightWhiteSquare {
}

.highlightBlackSquare {
}

.selectControl {}
.buttonControlPlay {}
.buttonControlStop {}
.buttonControl {}
.buttonControlSpace {}
/* a "width" attribute here must use the !important flag to override default settings */

.header {
color: black;
font-weight: bold;
}

.move {
  color: black;
  font-family: 'pgn4web ChessSansPiratf', 'pgn4web Liberation Sans', sans-serif;
  line-height: 1.3em;
  text-decoration: none;   
}

.moveOn {
  color: black;
  font-family: 'pgn4web ChessSansPiratf', 'pgn4web Liberation Sans', sans-serif;
  line-height: 1.3em;
  text-decoration: none;   
  background: #DAF4D7;
}

.comment
{
  color: gray;
  line-height: 1.3em;
}

.nag {
  color: gray;
  line-height: 1.3em;
}

</style>

<link rel="shortcut icon" href="pawn.ico"></link>

<script src="pgn4web.js" type="text/javascript"></script>

</head>

<body>

<!-- paste your PGN below and make sure you dont specify an external source with SetPgnUrl() -->
<form style="display: none;"><textarea style="display: none;" id="pgnText">

</textarea></form>
<!-- paste your PGN above and make sure you dont specify an external source with SetPgnUrl() -->

<script type="text/javascript">

function new_start_pgn4web() {

  document.body.style.background = backgroundColor;
  document.body.style.padding = framePadding;
  
  rule = getCSSRule('.pieceImage');
  rule.style.width = pieceSize;
  rule.style.height = pieceSize;

  if (highlightMode == 'border') {
    rule = getCSSRule('.whiteSquare');
    rule.style.width = (squareSize - 2 * borderSize) + 'px';	
    rule.style.height = (squareSize - 2 * borderSize) + 'px';
    rule.style.background = lightColor;
    rule.style.borderStyle = 'solid';
    rule.style.borderWidth = borderSize + 'px';
    rule.style.borderColor = lightColor; 
    rule = getCSSRule('.blackSquare');
    rule.style.width = (squareSize - 2 * borderSize) + 'px';	
    rule.style.height = (squareSize - 2 * borderSize) + 'px';
    rule.style.background = darkColor;
    rule.style.borderStyle = 'solid';
    rule.style.borderWidth = borderSize + 'px';
    rule.style.borderColor = darkColor; 
    rule = getCSSRule('.highlightWhiteSquare');
    rule.style.width = (squareSize - 2 * borderSize) + 'px';	
    rule.style.height = (squareSize - 2 * borderSize) + 'px';
    rule.style.background = lightColor;
    rule.style.borderStyle = 'solid';
    rule.style.borderWidth = borderSize + 'px';
    rule.style.borderColor = highlightLightColor;
    rule = getCSSRule('.highlightBlackSquare');
    rule.style.width = (squareSize - 2 * borderSize) + 'px';	
    rule.style.height = (squareSize - 2 * borderSize) + 'px';
    rule.style.background = darkColor;
    rule.style.borderStyle = 'solid';
    rule.style.borderWidth = borderSize + 'px';
    rule.style.borderColor = highlightDarkColor;
  } else {
    rule = getCSSRule('.whiteSquare');
    rule.style.width = squareSize + 'px';	
    rule.style.height = squareSize + 'px';
    rule.style.background = lightColor;
    rule = getCSSRule('.blackSquare');
    rule.style.width = squareSize + 'px';	
    rule.style.height = squareSize + 'px';
    rule.style.background = darkColor;
    rule = getCSSRule('.highlightWhiteSquare');
    rule.style.width = squareSize + 'px';	
    rule.style.height = squareSize + 'px';
    rule.style.background = highlightLightColor;
    rule = getCSSRule('.highlightBlackSquare');
    rule.style.width = squareSize + 'px';	
    rule.style.height = squareSize + 'px';
    rule.style.background = highlightDarkColor;
  }

  rule = getCSSRule('.boardTable');
  rule.style.borderColor = boardBorderColor;
  
  rule = getCSSRule('.move');
  rule.style.color = fontMovesColor;
  if (!fontMovesSize.match(/[^0-9]/)) { fontMovesSize += 'px'; }
  rule.style.fontSize = fontMovesSize;

  rule = getCSSRule('.moveOn');
  if (highlightMoveColor == 'none') { rule.style.background = backgroundColor; }
  else { rule.style.background = highlightMoveColor; }
  rule.style.color = fontMovesColor;
  if (!fontMovesSize.match(/[^0-9]/)) { fontMovesSize += 'px'; }
  rule.style.fontSize = fontMovesSize;

  rule = getCSSRule('.header');
  rule.style.color = fontHeaderColor;
  if (!fontHeaderSize.match(/[^0-9]/)) { fontHeaderSize += 'px'; }
  rule.style.fontSize = fontHeaderSize;

  rule = getCSSRule('.comment');
  rule.style.color = fontCommentsColor;
  rule.style.fontSize = fontCommentsSize;
  if (!fontCommentsSize.match(/[^0-9]/)) { fontCommentsSize += 'px'; }
  rule.style.fontSize = fontCommentsSize;

  rule = getCSSRule('.nag');
  rule.style.color = fontCommentsColor;
//  rule.style.fontSize = fontCommentsSize; // the nag is always embedded in the comment

  paddingControlHeight = Math.floor(squareSize / 2.5);
  if ((paddingControlWidth = squareSize - textMargin) < 0) { paddingControlWidth = 0; }
  theObject = document.getElementById("GameButtons");
  if (theObject) { theObject.style.paddingTop = paddingControlHeight; }
  if ((controlBackgroundColor != 'default') && (controlBackgroundColor != '#default')) { 
    rule1 = getCSSRule('.buttonControl');
    rule2 = getCSSRule('.buttonControlPlay');
    rule3 = getCSSRule('.buttonControlStop');
    rule1.style.borderStyle = rule2.style.borderStyle = rule3.style.borderStyle = 'solid';
    rule1.style.borderWidth = rule2.style.borderWidth = rule3.style.borderWidth = '0px';
    rule1.style.borderColor = rule2.style.borderColor = rule3.style.borderColor = backgroundColor;
    rule1.style.backgroundColor = rule2.style.backgroundColor = rule3.style.backgroundColor = controlBackgroundColor;
    rule1.style.color = rule2.style.color = rule3.style.color = controlTextColor;
    controlFontSize = Math.floor(squareSize / 2.5);
    rule1.style.fontSize = rule2.style.fontSize = rule3.style.fontSize = controlFontSize + 'px';
  }

  if ((controlBackgroundColor != 'default') && (controlBackgroundColor != '#default')) {
    rule = getCSSRule('.selectControl');
    rule.style.borderStyle = 'solid';
    rule.style.padding = '3px';
    rule.style.borderWidth = '1px';
    rule.style.borderColor = backgroundColor;
    rule.style.backgroundColor = controlBackgroundColor;
    rule.style.color = controlTextColor;
    rule.style.fontSize = controlFontSize + 'px';
  }

  theObject = document.getElementById("headerMovesPadding");
  if (theObject) { 
    if (horizontalLayout === true) { theObject.width = paddingControlWidth + 'px'; }
    else { theObject.style.minHeight = paddingControlHeight; }
  }

  start_pgn4web();

  theObject = document.getElementById("GameSelector");
  if (theObject) { if (theObject.innerHTML !== "") { theObject.style.paddingBottom = paddingControlHeight; } }

  boardHeight = document.getElementById("boardTable").offsetHeight;
  document.getElementById("boardTable").style.width = boardHeight;
  boardWidth = document.getElementById("boardTable").offsetWidth;
  if (buttonsDisplay != "hidden") { boardHeight += document.getElementById("GameButtons").offsetHeight; }
  if ((buttonsDisplay != "hidden") && (numberOfGames > 1)) { boardHeight += document.getElementById("GameSelector").offsetHeight; }

  if (horizontalLayout === true) {
    document.getElementById("extendedBoard").width = boardWidth;
  }

  if (fixFrameWidthToBoard) { frameWidth = boardWidth + 2 * framePadding; }
  if (fixFrameHeightToBoard) { frameHeight = boardHeight + 2 * framePadding; }

  theObject = document.getElementById("headerMoves");
  if (theObject !== null) {
    if (horizontalLayout === true) {
      if (frameWidth === "") { document.getElementById("headerMoves").style.width = textWidth; }
      else { document.getElementById("outerFrame").style.width = frameWidth - 2 * framePadding; }
      if (frameHeight === "") { document.getElementById("headerMoves").style.height = textHeight; }
      else { document.getElementById("headerMoves").style.height = frameHeight - 2 * framePadding; }
    } else {
      if (frameWidth === "") { document.getElementById("headerMoves").style.width = textWidth; }
      else { document.getElementById("headerMoves").style.width = frameWidth - 2 * framePadding; }
      if (frameHeight === "") { document.getElementById("headerMoves").style.height = textHeight; }
      else { 
	theObject = document.getElementById("headerMovesPadding");
	if (theObject) { headerMovesPaddingHeight = theObject.offsetHeight; }
	else { headerMovesPaddingHeight = 0; }
	document.getElementById("headerMoves").style.height = frameHeight - boardHeight - 2 * framePadding - headerMovesPaddingHeight; 
      }
    }
  }

  if (gup("showHeightWidth") !== "") { 
    alert("board dimensions\n\nwidth: " + boardWidth + "\nheight: " + boardHeight);
  }
}

window.onload = new_start_pgn4web;

function getCSSRule(ruleName, deleteFlag) {               // Return requested style obejct
   ruleName=ruleName.toLowerCase();                       // Convert test string to lower case.
   if (document.styleSheets) {                            // If browser can play with stylesheets
      for (var i=0; i<document.styleSheets.length; i++) { // For each stylesheet
         var styleSheet=document.styleSheets[i];          // Get the current Stylesheet
         var ii=0;                                        // Initialize subCounter.
         var cssRule=false;                               // Initialize cssRule. 
         do {                                             // For each rule in stylesheet
            if (styleSheet.cssRules) {                    // Browser uses cssRules?
               cssRule = styleSheet.cssRules[ii];         // Yes --Mozilla Style
            } else {                                      // Browser usses rules?
               cssRule = styleSheet.rules[ii];            // Yes IE style. 
            }                                             // End IE check.
	    if (cssRule && (cssRule.selectorText != undefined))  { // If we found a rule...
     	      if (cssRule.selectorText.toLowerCase()==ruleName) { //  match ruleName?
  	        if (deleteFlag=='delete') {               // Yes.  Are we deleteing?
                     if (styleSheet.cssRules) {           // Yes, deleting...
                        styleSheet.deleteRule(ii);        // Delete rule, Moz Style
                     } else {                             // Still deleting.
                        styleSheet.removeRule(ii);        // Delete rule IE style.
                     }                                    // End IE check.
                     return true;                         // return true, class deleted.
                  } else {                                // found and not deleting.
                     return cssRule;                      // return the style object.
                  }                                       // End delete Check
               }                                          // End found rule name
            }                                             // end found cssRule
            ii++;                                         // Increment sub-counter
         } while (cssRule)                                // end While loop
      }                                                   // end For loop
   }                                                      // end styleSheet ability check
   return false;                                          // we found NOTHING!
}                                                         // end getCSSRule 

function killCSSRule(ruleName) {                          // Delete a CSS rule   
   return getCSSRule(ruleName,'delete');                  // just call getCSSRule w/delete flag.
}                                                         // end killCSSRule

function addCSSRule(ruleName) {                           // Create a new css rule
   if (document.styleSheets) {                            // Can browser do styleSheets?
      if (!getCSSRule(ruleName)) {                        // if rule doesn't exist...
         if (document.styleSheets[0].addRule) {           // Browser is IE?
            document.styleSheets[0].addRule(ruleName, null,0);      // Yes, add IE style
         } else {                                         // Browser is IE?
            document.styleSheets[0].insertRule(ruleName+' { }', 0); // Yes, add Moz style.
         }                                                // End browser check
      }                                                   // End already exist check.
   }                                                      // End browser ability check.
   return getCSSRule(ruleName);                           // return rule we just created.
} 


function percentFixFromUrl( text ) {
  text += ''; // makes sure text is a string
  return text.replace(/pct$/,'%').replace(/p$/,'%'); // 100pct and 100p both mean 100%
}


var encodingCharSet = "$0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_";
var encodingVersion = 1;
// version 1 of PGN encoding:
//   encodedPGN = nnn$xxx0
//   nnn = number representing bytes length of the decoded message
//   $ = dollar char (delimiter for length info)
//   xxx = encoded text (using LetterCodes below)
//   0 = zero char (version marker)

function DecodePGN(bytes) {

  if (bytes.charAt(bytes.length - 1) != encodingCharSet.charAt(encodingVersion)) {
    alert("ERROR: PGN encoding version mismatch (e:" + 
           bytes.charAt(bytes.length - 1) + " d:" + encodingCharSet.charAt(encodingVersion) + ")");
  } else {
    bytes.length--;
  }

  originalLength = parseInt(bytes.match(/^[0-9]*/), 10);
  bytes = bytes.replace(/^[0-9]*\$/,"");

  l = new Array();
  l[0] = -146;
  l[1] = -111;
  l[2] = -66;
  l[3] = -55;
  l[4] = -6;
  l[5] = 46;
  l[6] = -8;
  l[7] = 66;
  l[8] = -10;
  l[9] = 105;
  l[10] = -12;
  l[11] = 107;
  l[12] = -14;
  l[13] = 44;
  l[14] = -16;
  l[15] = 85;
  l[16] = -18;
  l[17] = 106;
  l[18] = -20;
  l[19] = 62;
  l[20] = -22;
  l[21] = 89;
  l[22] = -24;
  l[23] = 38;
  l[24] = -40;
  l[25] = -33;
  l[26] = -30;
  l[27] = -29;
  l[28] = 17;
  l[29] = 18;
  l[30] = -32;
  l[31] = 15;
  l[32] = 16;
  l[33] = -37;
  l[34] = -36;
  l[35] = 21;
  l[36] = 22;
  l[37] = -39;
  l[38] = 19;
  l[39] = 20;
  l[40] = -48;
  l[41] = -45;
  l[42] = -44;
  l[43] = 7;
  l[44] = 8;
  l[45] = -47;
  l[46] = 5;
  l[47] = 6;
  l[48] = -52;
  l[49] = -51;
  l[50] = 12;
  l[51] = 14;
  l[52] = -54;
  l[53] = 9;
  l[54] = 11;
  l[55] = -57;
  l[56] = 34;
  l[57] = -59;
  l[58] = 78;
  l[59] = -61;
  l[60] = 57;
  l[61] = -63;
  l[62] = 63;
  l[63] = -65;
  l[64] = 109;
  l[65] = 119;
  l[66] = -80;
  l[67] = -69;
  l[68] = 101;
  l[69] = -71;
  l[70] = 55;
  l[71] = -73;
  l[72] = 69;
  l[73] = -75;
  l[74] = 118;
  l[75] = -77;
  l[76] = 121;
  l[77] = -79;
  l[78] = 73;
  l[79] = 123;
  l[80] = -82;
  l[81] = 49;
  l[82] = -86;
  l[83] = -85;
  l[84] = 13;
  l[85] = 40;
  l[86] = -88;
  l[87] = 45;
  l[88] = -90;
  l[89] = 68;
  l[90] = -92;
  l[91] = 84;
  l[92] = -94;
  l[93] = 125;
  l[94] = -96;
  l[95] = 39;
  l[96] = -98;
  l[97] = 58;
  l[98] = -100;
  l[99] = 36;
  l[100] = -102;
  l[101] = 92;
  l[102] = -104;
  l[103] = 124;
  l[104] = -108;
  l[105] = -107;
  l[106] = 3;
  l[107] = 4;
  l[108] = -110;
  l[109] = 0;
  l[110] = 2;
  l[111] = -129;
  l[112] = -118;
  l[113] = -115;
  l[114] = 50;
  l[115] = -117;
  l[116] = 102;
  l[117] = 103;
  l[118] = -122;
  l[119] = -121;
  l[120] = 48;
  l[121] = 110;
  l[122] = -126;
  l[123] = -125;
  l[124] = 10;
  l[125] = 1;
  l[126] = -128;
  l[127] = 79;
  l[128] = 117;
  l[129] = -137;
  l[130] = -132;
  l[131] = 51;
  l[132] = -134;
  l[133] = 98;
  l[134] = -136;
  l[135] = 47;
  l[136] = 112;
  l[137] = -141;
  l[138] = -140;
  l[139] = 56;
  l[140] = 81;
  l[141] = -143;
  l[142] = 104;
  l[143] = -145;
  l[144] = 114;
  l[145] = 115;
  l[146] = -192;
  l[147] = -153;
  l[148] = -150;
  l[149] = 32;
  l[150] = -152;
  l[151] = 91;
  l[152] = 93;
  l[153] = -157;
  l[154] = -156;
  l[155] = 99;
  l[156] = 120;
  l[157] = -159;
  l[158] = 116;
  l[159] = -161;
  l[160] = 75;
  l[161] = -163;
  l[162] = 80;
  l[163] = -165;
  l[164] = 67;
  l[165] = -167;
  l[166] = 77;
  l[167] = -169;
  l[168] = 90;
  l[169] = -171;
  l[170] = 60;
  l[171] = -173;
  l[172] = 33;
  l[173] = -175;
  l[174] = 37;
  l[175] = -177;
  l[176] = 96;
  l[177] = -185;
  l[178] = -182;
  l[179] = -181;
  l[180] = 248;
  l[181] = 249;
  l[182] = -184;
  l[183] = 246;
  l[184] = 247;
  l[185] = -189;
  l[186] = -188;
  l[187] = 252;
  l[188] = 253;
  l[189] = -191;
  l[190] = 250;
  l[191] = 251;
  l[192] = -228;
  l[193] = -225;
  l[194] = -196;
  l[195] = 52;
  l[196] = -198;
  l[197] = 108;
  l[198] = -208;
  l[199] = -201;
  l[200] = 83;
  l[201] = -205;
  l[202] = -204;
  l[203] = 61;
  l[204] = 72;
  l[205] = -207;
  l[206] = 113;
  l[207] = 122;
  l[208] = -212;
  l[209] = -211;
  l[210] = 65;
  l[211] = 70;
  l[212] = -214;
  l[213] = 71;
  l[214] = -216;
  l[215] = 76;
  l[216] = -218;
  l[217] = 74;
  l[218] = -220;
  l[219] = 88;
  l[220] = -222;
  l[221] = 64;
  l[222] = -224;
  l[223] = 42;
  l[224] = 94;
  l[225] = -227;
  l[226] = 53;
  l[227] = 100;
  l[228] = -232;
  l[229] = -231;
  l[230] = 54;
  l[231] = 82;
  l[232] = -234;
  l[233] = 97;
  l[234] = -236;
  l[235] = 111;
  l[236] = -238;
  l[237] = 43;
  l[238] = -240;
  l[239] = 87;
  l[240] = -242;
  l[241] = 41;
  l[242] = -244;
  l[243] = 86;
  l[244] = -246;
  l[245] = 35;
  l[246] = -256;
  l[247] = -249;
  l[248] = 59;
  l[249] = -251;
  l[250] = 95;
  l[251] = -253;
  l[252] = 126;
  l[253] = -255;
  l[254] = 254;
  l[255] = 255;
  l[256] = -384;
  l[257] = -321;
  l[258] = -290;
  l[259] = -275;
  l[260] = -268;
  l[261] = -265;
  l[262] = -264;
  l[263] = 160;
  l[264] = 161;
  l[265] = -267;
  l[266] = 158;
  l[267] = 159;
  l[268] = -272;
  l[269] = -271;
  l[270] = 164;
  l[271] = 165;
  l[272] = -274;
  l[273] = 162;
  l[274] = 163;
  l[275] = -283;
  l[276] = -280;
  l[277] = -279;
  l[278] = 152;
  l[279] = 153;
  l[280] = -282;
  l[281] = 150;
  l[282] = 151;
  l[283] = -287;
  l[284] = -286;
  l[285] = 156;
  l[286] = 157;
  l[287] = -289;
  l[288] = 154;
  l[289] = 155;
  l[290] = -306;
  l[291] = -299;
  l[292] = -296;
  l[293] = -295;
  l[294] = 176;
  l[295] = 177;
  l[296] = -298;
  l[297] = 174;
  l[298] = 175;
  l[299] = -303;
  l[300] = -302;
  l[301] = 180;
  l[302] = 181;
  l[303] = -305;
  l[304] = 178;
  l[305] = 179;
  l[306] = -314;
  l[307] = -311;
  l[308] = -310;
  l[309] = 168;
  l[310] = 169;
  l[311] = -313;
  l[312] = 166;
  l[313] = 167;
  l[314] = -318;
  l[315] = -317;
  l[316] = 172;
  l[317] = 173;
  l[318] = -320;
  l[319] = 170;
  l[320] = 171;
  l[321] = -353;
  l[322] = -338;
  l[323] = -331;
  l[324] = -328;
  l[325] = -327;
  l[326] = 128;
  l[327] = 129;
  l[328] = -330;
  l[329] = 31;
  l[330] = 127;
  l[331] = -335;
  l[332] = -334;
  l[333] = 132;
  l[334] = 133;
  l[335] = -337;
  l[336] = 130;
  l[337] = 131;
  l[338] = -346;
  l[339] = -343;
  l[340] = -342;
  l[341] = 25;
  l[342] = 26;
  l[343] = -345;
  l[344] = 23;
  l[345] = 24;
  l[346] = -350;
  l[347] = -349;
  l[348] = 29;
  l[349] = 30;
  l[350] = -352;
  l[351] = 27;
  l[352] = 28;
  l[353] = -369;
  l[354] = -362;
  l[355] = -359;
  l[356] = -358;
  l[357] = 144;
  l[358] = 145;
  l[359] = -361;
  l[360] = 142;
  l[361] = 143;
  l[362] = -366;
  l[363] = -365;
  l[364] = 148;
  l[365] = 149;
  l[366] = -368;
  l[367] = 146;
  l[368] = 147;
  l[369] = -377;
  l[370] = -374;
  l[371] = -373;
  l[372] = 136;
  l[373] = 137;
  l[374] = -376;
  l[375] = 134;
  l[376] = 135;
  l[377] = -381;
  l[378] = -380;
  l[379] = 140;
  l[380] = 141;
  l[381] = -383;
  l[382] = 138;
  l[383] = 139;
  l[384] = -448;
  l[385] = -417;
  l[386] = -402;
  l[387] = -395;
  l[388] = -392;
  l[389] = -391;
  l[390] = 224;
  l[391] = 225;
  l[392] = -394;
  l[393] = 222;
  l[394] = 223;
  l[395] = -399;
  l[396] = -398;
  l[397] = 228;
  l[398] = 229;
  l[399] = -401;
  l[400] = 226;
  l[401] = 227;
  l[402] = -410;
  l[403] = -407;
  l[404] = -406;
  l[405] = 216;
  l[406] = 217;
  l[407] = -409;
  l[408] = 214;
  l[409] = 215;
  l[410] = -414;
  l[411] = -413;
  l[412] = 220;
  l[413] = 221;
  l[414] = -416;
  l[415] = 218;
  l[416] = 219;
  l[417] = -433;
  l[418] = -426;
  l[419] = -423;
  l[420] = -422;
  l[421] = 240;
  l[422] = 241;
  l[423] = -425;
  l[424] = 238;
  l[425] = 239;
  l[426] = -430;
  l[427] = -429;
  l[428] = 244;
  l[429] = 245;
  l[430] = -432;
  l[431] = 242;
  l[432] = 243;
  l[433] = -441;
  l[434] = -438;
  l[435] = -437;
  l[436] = 232;
  l[437] = 233;
  l[438] = -440;
  l[439] = 230;
  l[440] = 231;
  l[441] = -445;
  l[442] = -444;
  l[443] = 236;
  l[444] = 237;
  l[445] = -447;
  l[446] = 234;
  l[447] = 235;
  l[448] = -480;
  l[449] = -465;
  l[450] = -458;
  l[451] = -455;
  l[452] = -454;
  l[453] = 192;
  l[454] = 193;
  l[455] = -457;
  l[456] = 190;
  l[457] = 191;
  l[458] = -462;
  l[459] = -461;
  l[460] = 196;
  l[461] = 197;
  l[462] = -464;
  l[463] = 194;
  l[464] = 195;
  l[465] = -473;
  l[466] = -470;
  l[467] = -469;
  l[468] = 184;
  l[469] = 185;
  l[470] = -472;
  l[471] = 182;
  l[472] = 183;
  l[473] = -477;
  l[474] = -476;
  l[475] = 188;
  l[476] = 189;
  l[477] = -479;
  l[478] = 186;
  l[479] = 187;
  l[480] = -496;
  l[481] = -489;
  l[482] = -486;
  l[483] = -485;
  l[484] = 208;
  l[485] = 209;
  l[486] = -488;
  l[487] = 206;
  l[488] = 207;
  l[489] = -493;
  l[490] = -492;
  l[491] = 212;
  l[492] = 213;
  l[493] = -495;
  l[494] = 210;
  l[495] = 211;
  l[496] = -504;
  l[497] = -501;
  l[498] = -500;
  l[499] = 200;
  l[500] = 201;
  l[501] = -503;
  l[502] = 198;
  l[503] = 199;
  l[504] = -508;
  l[505] = -507;
  l[506] = 204;
  l[507] = 205;
  l[508] = -510;
  l[509] = 202;
  l[510] = 203;

  e=b=a=0;
  o="";

  function B() { if(a===0) { b=encodingCharSet.indexOf(bytes.charAt(e++)); a=6; } return ((b>>--a)&0x01); }
  
  while(originalLength>0) { i=0; 
    while(l[i]<0) { 
      if(B()) { i=-l[i]; }
      else { i++; }
    }
    o+=String.fromCharCode(l[i]);
    originalLength--;
  }

  return o;
}


function sex2hex(sex) {
  if (sex === "") { return ""; }
  sex += "";
  var dec = 0;
  var cnt;
  for (cnt=0; cnt<sex.length; cnt++) {
    dec <<= 6;
    dec += encodingCharSet.indexOf(sex.charAt(cnt));
  }
  var hex = dec.toString(16).toUpperCase() + "";
  while (hex.length < 6) { hex = "0" + hex; }
  return hex;
}


function gup( name ){

  name = name.replace(/[\[]/,"\\\[").replace(/[\]]/,"\\\]");
  var regexS = "[\\?&]"+name+"=([^&#]*)";  
  regexS = regexS+"(?!.*"+regexS+")"; // matches the LAST occurrence
  var regex = new RegExp( regexS );
  var results = regex.exec( window.location.href );
  if( results !== null ) { switch (results[1]) {
    case "t": case "T": return "true";  break;
    case "f": case "F": return "false"; break;
    default: return results[1]; 
  } }

  // allows for short version of the URL parameters, for instance sC matches squareColor
  compact_name = name.charAt(0);
  for(i=1; i<name.length; i++){
    if (name.charAt(i).match(/[A-Z]/)) { compact_name = compact_name + name.charAt(i).toLowerCase(); }
  }
  name = compact_name;
  
  name = name.replace(/[\[]/,"\\\[").replace(/[\]]/,"\\\]");
  regexS = "[\\?&]"+name+"=([^&#]*)";  
  regexS = regexS+"(?!.*"+regexS+")"; // matches the LAST occurrence
  regex = new RegExp( regexS );

  results = regex.exec( window.location.href );
  if( results !== null ) { switch (results[1]) {
    case "t": case "T": return "true";  break;
    case "f": case "F": return "false"; break;
    default: return results[1]; 
  } }
  
  return "";
}

var pieceSizeOptions = new Array(20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 52, 56, 60, 64, 72, 80, 88, 96, 112, 128, 144, 300);
function defaultPieceSize(squareSize) {
  targetPieceSize = Math.floor(0.8 * squareSize);
  for (ii=(pieceSizeOptions.length-1); ii>=0; ii--) {
	  if (pieceSizeOptions[ii] <= targetPieceSize) { return pieceSizeOptions[ii]; }
  }
  return pieceSizeOptions[0];
}

SetHighlightOption(true);
SetShortcutKeysEnabled(true);

if ((squareSize = gup("squareSize")) === "") { squareSize = 28; }
else { squareSize = parseInt(squareSize, 10); }
if (squareSize < 20) { squareSize = 20; }

if ((highlightMode = gup("highlightMode")) === "") { highlightMode = "square"; }
if (highlightMode == "b") { highlightMode = "border"; }
if (highlightMode == "n") { highlightMode = "none"; }
if (highlightMode == "s") { highlightMode = "square"; }
if (highlightMode == "border") {
  borderSize = Math.floor(0.05 * squareSize);
} else { borderSize = 0; }

if ((lightColor = gup("lightColorName")) === "") { 
  if ((lightColor = "#" + gup("lightColorHex")) == "#") {
    if ((lightColor = "#" + sex2hex(gup("lightColorSex"))) == "#") { lightColor = "#EFF4EC"; }
  }
}
if ((darkColor  = gup("darkColorName"))  === "") {
  if ((darkColor  = "#" + gup("darkColorHex"))  == "#") {
    if ((darkColor  = "#" + sex2hex(gup("darkColorSex")))  == "#") { darkColor  = "#C6CEC3"; }
  }
}
if ((highlightColor  = gup("highlightColorName")) === "") {
  if ((highlightColor  = "#" + gup("highlightColorHex"))  == "#") {
    if ((highlightColor  = "#" + sex2hex(gup("highlightColorSex")))  == "#") { highlightColor  = "#C0FFAD"; }
  }
}
if ((highlightMode == 'none') || (highlightColor == 'none') || (highlightColor == '#none')) {
  highlightMode = 'none';    
  borderSize = 0;
  highlightLightColor = lightColor;
  highlightDarkColor = darkColor;
} else { 
  highlightLightColor = highlightColor;
  highlightDarkColor = highlightColor;
}

pieceSize = gup("pieceSize");
if ((pieceSize === "") || (pieceSize == "default") || (pieceSize == "d")) { pieceSize = defaultPieceSize(squareSize); }
else { pieceSize = parseInt(pieceSize, 10); }
if (pieceSize > (squareSize - 2 * borderSize)) { pieceSize = defaultPieceSize(squareSize - 2 * borderSize); }

if ((pieceFont = gup("pieceFont")) === "") {
  if ((pieceFont = gup("font")) === "") // left for compatibility with older version
    { pieceFont = "default"; }
}
if (pieceFont == "a") { pieceFont = "alpha"; }
if (pieceFont == "m") { pieceFont = "merida"; }
if (pieceFont == "u") { pieceFont = "uscf"; }
if ((pieceFont == "random") || (pieceFont == "r")) {
  randomPiece = Math.floor(Math.random() * 3);
  switch (randomPiece) {
    case 1: pieceFont = "merida"; break;
    case 2: pieceFont = "uscf"; break;
    default: pieceFont = "alpha"; break;
  }
}
if ((pieceFont == "default") || (pieceFont == "d")) {
  if (pieceSize < 28) { pieceFont = "uscf"; }
  else { 
    if (pieceSize > 39) { pieceFont = "merida"; }
    else { pieceFont = "alpha"; }
  }
}

SetImagePath(pieceFont + "/" + pieceSize);

if ((boardBorderColor = gup("boardBorderColorName")) === "") {
  if ((boardBorderColor = "#" + gup("boardBorderColorHex")) == "#") {
    if ((boardBorderColor = "#" + sex2hex(gup("boardBorderColorSex"))) == "#") { boardBorderColor = "#000000"; }
  }
}

if ((highlightMoveColor  = gup("highlightMoveColorName")) === "") {
  if ((highlightMoveColor  = "#" + gup("highlightMoveColorHex"))  == "#") {
    if ((highlightMoveColor  = "#" + sex2hex(gup("highlightMoveColorSex")))  == "#") { highlightMoveColor  = "#DAF4D7"; }
  }
}

if ((backgroundColor = gup("backgroundColorName")) === "") {
 if ((backgroundColor = "#" + gup("backgroundColorHex")) == "#") {
   if ((backgroundColor = "#" + sex2hex(gup("backgroundColorSex"))) == "#") { backgroundColor = "#FFFFFF"; }
 }
}

if ((framePadding = gup("framePadding")) === "") { framePadding = 0;}
else { framePadding = parseInt(framePadding, 10); }

if ((fontHeaderSize = percentFixFromUrl( gup("fontHeaderSize") )) === "") { fontHeaderSize = "100%"; }
if ((fontHeaderColor = gup("fontHeaderColorName")) === "") {
  if ((fontHeaderColor = "#" + gup("fontHeaderColorHex")) == "#") {
    if ((fontHeaderColor = "#" + sex2hex(gup("fontHeaderColorSex"))) == "#") { fontHeaderColor = "#000000"; }
  }
}

if ((fontMovesSize = percentFixFromUrl( gup("fontMovesSize") )) === "") { fontMovesSize = "100%"; }
if ((fontMovesColor = gup("fontMovesColorName")) === "") {
  if ((fontMovesColor = "#" + gup("fontMovesColorHex")) == "#") { 
    if ((fontMovesColor = "#" + sex2hex(gup("fontMovesColorSex"))) == "#") { fontMovesColor = "#000000";} 
  }
}

if ((fontCommentsSize = percentFixFromUrl( gup("fontCommentsSize") )) === "") { fontCommentsSize = "100%"; }
if ((fontCommentsColor = gup("fontCommentsColorName")) === "") {
  if ((fontCommentsColor = "#" + gup("fontCommentsColorHex")) == "#") {
    if ((fontCommentsColor = "#" + sex2hex(gup("fontCommentsColorSex"))) == "#") { fontCommentsColor = "#808080"; }
  }
}

oldAutoplayMode = "";
if (gup("auto") == "false") { oldAutoplayMode = "game"; }
if (gup("loop") == "true") { oldAutoplayMode = "loop"; }
if ((autoplayMode = gup("autoplayMode")) === "") {
  if (oldAutoplayMode === "") { autoplayMode = "game"; }
  else { autoplayMode = oldAutoplayMode; }
}
if (autoplayMode == "g") { autoplayMode = "game"; }
if (autoplayMode == "l") { autoplayMode = "loop"; }
if (autoplayMode == "n") { autoplayMode = "none"; }

switch (autoplayMode) {
  case "loop":
    SetAutostartAutoplay(true);
    SetAutoplayNextGame(true);
    break;
  case "none":
    SetAutostartAutoplay(false);
    SetAutoplayNextGame(false);
    break;
  case "game":
  default:
    SetAutostartAutoplay(true);
    SetAutoplayNextGame(false);
    break;
}

if (gup("delay") === "") { SetAutoplayDelay(1000); }
else { SetAutoplayDelay(gup("delay")); }

oldButtonsDisplay = "";
if (gup("showButtons") == "true") { oldButtonsDisplay = "custom"; }
if (gup("showButtons") == "false") { oldButtonsDisplay = "hidden"; }
if ((buttonsDisplay = gup("buttonsDisplay")) === "") {
  if (oldButtonsDisplay === "") { buttonsDisplay = "hidden"; }
  else { buttonsDisplay = oldButtonsDisplay; }
}
if (buttonsDisplay == "c") { buttonsDisplay = "custom"; }
if (buttonsDisplay == "h") { buttonsDisplay = "hidden"; }
if (buttonsDisplay == "s") { buttonsDisplay = "standard"; }
if ((buttonsDisplay != "custom") && (buttonsDisplay != "standard")) { buttonsDisplay = "hidden"; }

if (buttonsDisplay == "custom") {
      
  if ((controlBackgroundColor = gup("controlBackgroundColorName")) === "") {
    if ((controlBackgroundColor = "#" + gup("controlBackgroundColorHex")) == "#") {
      controlBackgroundColorSex = gup("controlBackgroundColorSex");
      if (controlBackgroundColorSex == "default") {
        controlBackgroundColor = "#default";
      } else if (controlBackgroundColorSex == "d") {
        controlBackgroundColor = "#d";
      } else {
	if ((controlBackgroundColor = "#" + sex2hex(controlBackgroundColorSex)) == "#") { 
          controlBackgroundColor = "#default"; 
        }
      }
    }
  }
  if ((controlBackgroundColor == "d") || (controlBackgroundColor == "#d")) { controlBackgroundColor = "default"; }
  if (controlBackgroundColor == "#default") { controlBackgroundColor = "default"; }

  if (controlBackgroundColor == "default") { buttonsDisplay = "standard"; }

  if ((controlTextColor = gup("controlTextColorName")) === "") {
    if ((controlTextColor = "#" + gup("controlTextColorHex")) == "#") { 
      if ((controlTextColor = "#" + sex2hex(gup("controlTextColorSex"))) == "#") { controlTextColor = "#000000"; } 
    }
  } 

} else {
  controlBackgroundColor = "default";
  controlTextColor = "#000000";
}

oldCommentsDisplay = "";
if (gup("showCommentsOnSeparateLines") == "true") { oldCommentsDisplay = "newline"; }
if (gup("showComments") == "false") { oldCommentsDisplay = "hidden"; }
if ((commentsDisplay = gup("commentsDisplay")) === "") { 
  if (oldCommentsDisplay === "") { commentsDisplay = "inline"; }
  else { commentsDisplay = oldCommentsDisplay; }
}
if (commentsDisplay == "h") { commentsDisplay = "hidden"; }
if (commentsDisplay == "i") { commentsDisplay = "inline"; }
if (commentsDisplay == "n") { commentsDisplay = "newline"; }

switch (commentsDisplay) {
  case "hidden":
    SetCommentsIntoMoveText(false);
    SetCommentsOnSeparateLines(false);
    break;
  case "newline":
    SetCommentsIntoMoveText(true);
    SetCommentsOnSeparateLines(true);
    break;
  case "inline":
  default:
    SetCommentsIntoMoveText(true);
    SetCommentsOnSeparateLines(false);
    break;
}

if ((fenString = gup("fenString")) !== "") {
  // remove URL escape chars such as %20 replaced by space
  fenString = decodeURIComponent(fenString);
  document.getElementById('pgnText').value = '[FEN "' + fenString + '"]';
}

if ((newPgnText = gup("pgnText")) !== "") {

  // remove URL escape chars such as %20 replaced by space
  newPgnText = decodeURIComponent(newPgnText);

  // cleans the PGN text
  newPgnText = newPgnText.replace(/\[/g,"\n\n[");
  newPgnText = newPgnText.replace(/\]/g,"]\n\n");
  newPgnText = newPgnText.replace(/([012\*])(\s*)(\[)/g,"$1\n\n$3");
  newPgnText = newPgnText.replace(/\]\s*\[/g,"]\n[");
  newPgnText = newPgnText.replace(/^\s*\[/g,"[");
  newPgnText = newPgnText.replace(/\n[\s*\n]+/g,'\n\n');

  document.getElementById('pgnText').value = newPgnText;
} 

if ((newPgnEncoded = gup("pgnEncoded")) !== "") {

  newPgnDecoded = DecodePGN(newPgnEncoded);

  // cleans the PGN text
  newPgnDecoded = newPgnDecoded.replace(/\[/g,"\n\n[");
  newPgnDecoded = newPgnDecoded.replace(/\]/g,"]\n\n");
  newPgnDecoded = newPgnDecoded.replace(/([012\*])(\s*)(\[)/g,"$1\n\n$3");
  newPgnDecoded = newPgnDecoded.replace(/\]\s*\[/g,"]\n[");
  newPgnDecoded = newPgnDecoded.replace(/^\s*\[/g,"[");
  newPgnDecoded = newPgnDecoded.replace(/\n[\s*\n]+/g,'\n\n');

  document.getElementById('pgnText').value = newPgnDecoded;
} 

if ((newPgnEncoded !== "") && ((newPgnText !== "") || (fenString !== ""))) {
  alert("WARNING: pgnEncoded value superseeds pgnText and/or fenString values.");
}

if ((fenString !== "") && (newPgnText !== "")) {
  alert("WARNING: pgnText value superseeds fenString value.");
}

oldHeaderDisplay = "";
if (gup("showHeader") == "true") { oldHeaderDisplay = "justified"; }
if (gup("showHeader") == "false") { oldHeaderDisplay = "hidden"; }
if ((headerDisplay = gup("headerDisplay")) === "") {
  if (oldHeaderDisplay === "") { headerDisplay = "justified"; }
  else { headerDisplay = oldHeaderDisplay; }
}
if (headerDisplay == "c") { headerDisplay = "centered"; }
if (headerDisplay == "h") { headerDisplay = "hidden"; }
if (headerDisplay == "j") { headerDisplay = "justified"; }
if ((headerDisplay != "centered") && (headerDisplay != "hidden")) { headerDisplay = "justified"; }

oldMovesDisplay = "";
if (gup("showMoves") == "true") { oldMovesDisplay = "justified"; }
if (gup("showMoves") == "false") { oldMovesDisplay = "hidden"; }
if ((movesDisplay = gup("movesDisplay")) === "") {
  if (oldMovesDisplay === "") { movesDisplay = "justified"; }
  else { movesDisplay = oldMovesDisplay; }
}
if (movesDisplay == "h") { movesDisplay = "hidden"; }
if (movesDisplay == "j") { movesDisplay = "justified"; }
if (movesDisplay != "hidden") { movesDisplay = "justified"; }

if ((textHeight = percentFixFromUrl(gup("textHeight"))) === "") { textHeight = "100%"; }
if ((textWidth = percentFixFromUrl(gup("textWidth"))) === "") { textWidth = "100%"; }

if ((textMargin = gup("textMargin")) === "") { textMargin = 0; }
else { textMargin = parseInt(textMargin, 10); }

frameHeight = gup("frameHeight");
// next statement is for compatibility with older version of board/board-generator
if (frameHeight.match("pct") || frameHeight.match("p")) { frameHeight = ""; textHeight = "100%"; }
switch (frameHeight) {
  case "b":
  case "board":
    frameHeight = "";
    fixFrameHeightToBoard = true;
    break;
  case "":
    fixFrameHeightToBoard = false;
    break;
  default:
    frameHeight = parseInt(frameHeight, 10);
    fixFrameHeightToBoard = false;
    break;
}

frameWidth = gup("frameWidth");
// next statement is for compatibility with older version of board/board-generator
if (frameWidth.match("pct") || frameWidth.match("p")) { frameWidth = "page"; }
switch (frameWidth) {
  case "b":
  case "board":
    frameWidth = "";
    fixFrameWidthToBoard = true;
    break;
  case "p":
  case "page":
    frameWidth = "";
    textWidth = "100%"; 
    fixFrameWidthToBoard = false;
    break;
  case "":
    fixFrameWidthToBoard = false;
    break;
  default:
    frameWidth = parseInt(frameWidth, 10);
    fixFrameWidthToBoard = false;
    break;
}

if (gup("horizontalLayout") == "true") { horizontalLayout = true; }
else { horizontalLayout = false; }	

if (gup("help") !== "") {
  document.write("<PRE>");
  document.write("URL parameters\n");
  document.write("\n");
  document.write(" - pgnText = PGN games to display\n");
  document.write(" - pgnEncoded = encoded PGN games to display (used only by the board generator tool)\n");
  document.write(" - fenString = FEN position to display, superceded by pgnText if set\n");
  document.write("\n");
  document.write(" - autoplayMode = game (autoplay first game once) | loop (loops through games continiously) | none - (default game)\n");
  document.write(" - delay = autoplay delay in ms (default 1000)\n");
  document.write("\n");
  document.write(" - squareSize = size of square (default 28)\n");
  document.write(" - pieceSize = size of pieces | default (default selects piece size based on piece size)\n");
  document.write(" - pieceFont = alpha | merida | uscf | random | default - (default selects piece font based on piece size)\n");
  document.write(" - highlightMode = border | square | none (default square)\n");
  document.write(" - lightColorHex = light square color hex code, like FF0000 (default EFF4EC)\n");
  document.write(" - darkColorHex = dark square color hex code, like FF0000 (default C6CEC3)\n");
  document.write(" - highlightColorHex = highlight color hex code, like FF0000 (default DAF4D7)\n");
  document.write(" - boardBorderColorHex = board border color hex code, like FF0000 (default 000000)\n");
  document.write("\n");
  document.write(" - buttonsDisplay = hidden | standard (use browser's standard buttons) | custom (use custom color buttons) - (default hidden)\n");
  document.write(" - controlBackgroundColorHex = control buttons background color hex code, like FF0000, or 'default' (default 'default')\n");
  document.write(" - controlTextColorHex = control buttons text color hex code, like FF0000 (default 000000)\n");
  document.write("\n");
  document.write(" - headerDisplay = justified | centered | hidden (default justified)\n");
  document.write(" - movesDisplay = justified | hidden (default justified)\n");
  document.write(" - textHeight = set height of the textual section, header and/or moves text, might be ingored if frameHeight is set (default 100%)\n");
  document.write(" - textWidth = set width of the textual section, header and/or moves text, might be ignored if frameWidth is set (default 100%)\n");
  document.write(" - textMargin = set left/right margin width of the  textual section, header and/or moves text (default 0)\n");
  document.write(" - commentsDisplay = hidden | inline (same line as moves) | newline (new lines) - (default inline)\n");
  document.write(" - fontHeaderColorHex = header color hex code, like FF0000 (default 000000)\n");
  document.write(" - fontMovesColorHex = moves color hex code, like FF0000 (default 000000)\n");
  document.write(" - fontCommentsColorHex = commentss color hex code, like FF0000 (default 808080)\n");
  document.write(" - highlightMoveColorHex = background color hex code to highlight current move, like FF0000, 'none' for no highligh (default DAF4D7)\n");
  document.write(" - fontHeaderSize = header font size, like 20 or 120% (default 100p = 100pct meaning 100%)\n");
  document.write(" - fontMovesSize = header font size, like 20 or 120% (default 100p = 100pct meaning 100%)\n");
  document.write(" - fontCommentsSize = header font size, like 20 or 120% (default 100p = 100pct meaning 100%)\n");
  document.write("\n");
  document.write(" - backgroundColorHex = page background color hex code, like FF0000\n (default FFFFFF)");
  document.write(" - horizontalLayout = if set true, shows header/moves text at the right of the board, below otherwise (default false)\n");
  document.write(" - frameHeight = set height of the overall frame, as a number or as 'board' overriding textHeight (default not set)\n");
  document.write(" - frameWidth = set width of the overall frame, as a number, as 'board' or as 'page', overriding textWidth (default not set)\n");
  document.write(" - framePadding = padding within the frame (default 0)\n");
  document.write("\n");
  document.write(" - showHeightWidth = if set true, calculates optimal iframe dimensions (default false)\n");
  document.write(" - help = if set true, shows help info (default false)\n");
  document.write("\n");
  document.write("URL parameters can be shortened: for example squareSize => sq, auto => a, highlightMoveColorHex => hmch\n");
  document.write("Also values true and false can be shortened: true => t, false => f\n");
  document.write("\n");
  document.write("Every color parameter can by assigned also by name (like 'red') or using a proprietary encoding in base 64.\n");
  document.write("For instance, the light square color, besides using the lightColorHex parameter can be also assigned using the lightColorName or the lightColorSex parameter.\n");
  document.write("The latter is proprietary and used by the board generator tool. \n");
  document.write("\n");
  document.write("</PRE>\n<HR>\n");
}

document.write("<center>");
document.write("<table id='outerFrame' style='width: 100%;' cellspacing=0 cellpadding=0 border=0>");
document.write("<tr>");
document.write("<td id='extendedBoard' align=center valign=top>");
display_board();
document.write("</td>");
if (horizontalLayout === true) { 
  document.write("<td id='headerMovesPadding' width='0px' >");
  document.write("<td id='extendedHeaderMoves' align=left valign=top>"); 
} else { 
  document.write("</tr><tr><td id='extendedHeaderMoves' align=center valign=top>");
}
display_header_moves();
document.write("</td>");
document.write("</tr>");
document.write("</table>");
document.write("</center>");

function display_board() {
  document.write("<table width=100% cellpadding=0 cellspacing=0 border=0>");
  document.write("<tr><td align=center valign=top>");
  if (buttonsDisplay != "hidden") { document.write("<div id='GameSelector'></div>"); }
  document.write("<div id='GameBoard'></div>"); 
  if (buttonsDisplay != "hidden") { document.write("<div id='GameButtons'></div>"); }
  document.write("</td></tr></table>");
}

function display_header_moves() {

  if ((headerDisplay != "hidden") && (horizontalLayout === false)) {
      document.write("<div id='headerMovesPadding' class='header' style='text-align: center;'>&nbsp;</div>");
  }

  if ((headerDisplay != "hidden") || (movesDisplay != "hidden")) {
  document.write("<div id='headerMoves' style='overflow:auto; overflow-x:hidden;" +
                 " height: " + textHeight + "; width: " + textWidth + 
                 "; scrollbar-base-color: " + backgroundColor + ";'>");
  } 

  if (headerDisplay == "justified") {

    document.write("<table width=100% cellpadding=0 cellspacing=0 border=0><tr>");
    document.write("<td align=left>");
    document.write("<div class='header' style='white-space: nowrap; margin-left: "  + textMargin + 
                   "; margin-right: 3%;' id=GameWhite></div>");
    document.write("</td><td align=right>");
    document.write("<div class='header' style='white-space: nowrap; margin-right: " + textMargin +
                   "; margin-left: 3%;'  id=GameDate></div>");
    document.write("</td></tr></table>");

    document.write("<table width=100% cellpadding=0 cellspacing=0 border=0><tr>");
    document.write("<td align=left>");
    document.write("<div class='header' style='white-space: nowrap; margin-left: "  + textMargin + 
                   "; margin-right: 3%;' id=GameBlack></div>");
    document.write("</td><td align=right>");
    
    document.write("<div class='header'header style='white-space: nowrap; margin-right: " + textMargin +
                   "; margin-left: 3%;'  id=GameSite></div>");
    document.write("</td></tr></table>");

    document.write("<table width=100% cellpadding=0 cellspacing=0 border=0><tr>");
    document.write("<td align=left>");
    document.write("<div class='header' style='white-space: nowrap; margin-left: "  + textMargin + 
                   "; margin-right: 3%;' id=GameResult></div>");
    document.write("</td><td align=right>");
    document.write("<div class='header' style='white-space: nowrap; margin-right: " + textMargin +
		    "; margin-left: 3%;'><span id=GameEvent></span><span id=roundDetails></span></div>");
    document.write("</td></tr></table>");
  }
   
  if (headerDisplay == "centered") {

    document.write("<table width=100% cellpadding=0 cellspacing=0 border=0><tr>");
    document.write("<td align=center>");
    document.write("<div class='header' style='white-space: nowrap; margin-left: "  + textMargin + 
                   "; margin-right: " + textMargin + ";'>");
    document.write("<span id=GameWhite></span><span id=whiteBlackSpacer></span><span id=GameBlack></span><span id=blackResultSpacer></span><span id=GameResult></span>");
    document.write("</div>");
    document.write("</td></tr><tr><td align=center>");
    document.write("<div class='header' style='white-space: nowrap; margin-left: "  + textMargin + 
                   "; margin-right: " + textMargin + ";'>");
    document.write("<span id=GameEvent></span><span id=roundDetails></span>");
    document.write("</div>");
    document.write("</td></tr><tr><td align=center>");
    document.write("<div class='header' style='white-space: nowrap; margin-left: "  + textMargin + 
                   "; margin-right: " + textMargin + ";'>");
    document.write("<span id=GameSite></span><span id=siteDateSpacer></span><span id=GameDate></span>");
    document.write("</div>");
    document.write("</td></tr></table>");

  }

  if (movesDisplay != "hidden") {
    if (headerDisplay != "hidden") {
      document.write("<div class='header' style='text-align: center;'>&nbsp;</div>");
    } else {
      if (horizontalLayout === false) {
        document.write("<div class='moves' style='text-align: center;'>&nbsp;</div>");
      }
    }
    document.write("<div style='margin-left:" + textMargin + "; margin-right:" + textMargin + 
                   "; text-align: justify;' id=GameText></div>");
  }  

  if ((headerDisplay != "hidden") || (movesDisplay != "hidden")) {
    document.write("</div>");
  } 

}

function customFunctionOnPgnGameLoad() {

  theObject = document.getElementById("roundDetails");
  if (theObject) {
    if ((gameRound[currentGame] !=  undefined) &&
        (gameRound[currentGame] !== "") &&
        (gameRound[currentGame] !== "*") &&
        (gameRound[currentGame] !=  "?")) {
      theObject.innerHTML = "&nbsp;(" + gameRound[currentGame] + ")";
    } else {
      theObject.innerHTML = "";
    }
  }

  theObject = document.getElementById("siteDateSpacer");
  if (theObject) {
    if ((gameSite[currentGame] != undefined) &&
        (gameSite[currentGame] != "") &&
        (gameDate[currentGame] != undefined) &&
        (gameDate[currentGame] != "")) {
      theObject.innerHTML = "&nbsp; &nbsp;"
    } else {
      theObject.innerHTML = "";
    }
  }

  theObject = document.getElementById("whiteBlackSpacer");
  if (theObject) {
    if ((gameWhite[currentGame] != undefined) &&
        (gameWhite[currentGame] != "") &&
        (gameBlack[currentGame] != undefined) &&
        (gameBlack[currentGame] != "")) {
      theObject.innerHTML = "&nbsp;-&nbsp;"
    } else {
      theObject.innerHTML = "";
    }
  }

  theObject = document.getElementById("blackResultSpacer");
  if (theObject) {
    if ((gameBlack[currentGame] != undefined) &&
        (gameBlack[currentGame] != "") &&
        (gameResult[currentGame] != undefined) &&
        (gameResult[currentGame] != "")) {
      theObject.innerHTML = "&nbsp; &nbsp;"
    } else {
      theObject.innerHTML = "";
    }
  }

}


</script>

</body>

</html>


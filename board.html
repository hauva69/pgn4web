<html>

<!--
  pgn4web javascript chessboard
  copyright (C) 2009 Paolo Casaschi
  see README file and http://pgn4web.casaschi.net
  for credits, license and more details
-->

<head>

<title>chess</title>

<style type="text/css"> 

html,
body {
  margin: 0;
  padding: 0;
  font-family: sans-serif;
  color: black;
}

.boardTable {
  border-style: double;
  border-color: black;
  border-width: 3px;
}

.pieceImage {
}

.whiteSquare {
}

.blackSquare {
}

.highlightWhiteSquare {
}

.highlightBlackSquare {
}

.selectControl {}
.buttonControlPlay {}
.buttonControlStop {}
.buttonControl {}
.buttonControlSpace {}
/* a "width" attribute here must use the !important flag to override default settings */

.header {
  color: black;
  font-weight: bold;
}

.move {
  color: black;
  text-decoration: none;   
}

.moveOn {
  color: black;
  text-decoration: none;   
  background: #DAF4D7;
}

.comment
{
  color: gray;
}

.nag {
  color: gray;
}

</style>

<script src="pgn4web.js" type="text/javascript"></script>

</head>

<body>

<!-- paste your PGN below and make sure you dont specify an external source with SetPgnUrl() -->
<span style="display:none" id="pgnText">

</span>
<!-- paste your PGN above and make sure you dont specify an external source with SetPgnUrl() -->

<script>

function new_start_pgn4web() {

  document.body.style.background = backgroundColor;
  document.body.style.padding = framePadding;
  
  rule = getCSSRule('.pieceImage');
  rule.style.width = pieceSize;
  rule.style.height = pieceSize;

  rule = getCSSRule('.whiteSquare');
  rule.style.width = squareSize + 'px';	
  rule.style.height = squareSize + 'px';
  rule.style.background = lightColor;
  rule = getCSSRule('.blackSquare');
  rule.style.width = squareSize + 'px';	
  rule.style.height = squareSize + 'px';
  rule.style.background = darkColor;
  rule = getCSSRule('.highlightWhiteSquare');
  rule.style.width = squareSize + 'px';	
  rule.style.height = squareSize + 'px';
  rule.style.background = highlightLightColor;
  rule = getCSSRule('.highlightBlackSquare');
  rule.style.width = squareSize + 'px';	
  rule.style.height = squareSize + 'px';
  rule.style.background = highlightDarkColor;
  rule = getCSSRule('.boardTable');
  rule.style.borderColor = boardBorderColor;

  rule = getCSSRule('.move');
  rule.style.color = fontMovesColor;
  if (!fontMovesSize.match(/[^0-9]/)) { fontMovesSize += 'px'; }
  rule.style.fontSize = fontMovesSize;

  rule = getCSSRule('.moveOn');
  if (highlightMoveColor == 'none') { rule.style.background = backgroundColor; }
  else { rule.style.background = highlightMoveColor; }
  rule.style.color = fontMovesColor;
  if (!fontMovesSize.match(/[^0-9]/)) { fontMovesSize += 'px'; }
  rule.style.fontSize = fontMovesSize;

  rule = getCSSRule('.header');
  rule.style.color = fontHeaderColor;
  if (!fontHeaderSize.match(/[^0-9]/)) { fontHeaderSize += 'px'; }
  rule.style.fontSize = fontHeaderSize;

  rule = getCSSRule('.comment');
  rule.style.color = fontCommentsColor;
  rule.style.fontSize = fontCommentsSize;
  if (!fontCommentsSize.match(/[^0-9]/)) { fontCommentsSize += 'px'; }
  rule.style.fontSize = fontCommentsSize;

//  rule = getCSSRule('.nag');
//  rule.style.color = fontCommentsColor;
//  rule.style.fontSize = fontCommentsSize;

  paddingControlHeight = Math.floor(squareSize / 2.5);
  theObject = document.getElementById("GameButtons");
  if (theObject) { theObject.style.paddingTop = paddingControlHeight; }
  if ((controlBackgroundColor != 'default') && (controlBackgroundColor != '#default')) { 
    rule1 = getCSSRule('.buttonControl');
    rule2 = getCSSRule('.buttonControlPlay');
    rule3 = getCSSRule('.buttonControlStop');
    rule1.style.borderStyle = rule2.style.borderStyle = rule3.style.borderStyle = 'solid';
    rule1.style.borderWidth = rule2.style.borderWidth = rule3.style.borderWidth = '0px';
    rule1.style.borderColor = rule2.style.borderColor = rule3.style.borderColor = backgroundColor;
    rule1.style.backgroundColor = rule2.style.backgroundColor = rule3.style.backgroundColor = controlBackgroundColor;
    rule1.style.color = rule2.style.color = rule3.style.color = controlTextColor;
    controlFontSize = Math.floor(squareSize / 2.5);
    rule1.style.fontSize = rule2.style.fontSize = rule3.style.fontSize = controlFontSize + 'px';
  }

  if ((controlBackgroundColor != 'default') && (controlBackgroundColor != '#default')) {
    rule = getCSSRule('.selectControl');
    rule.style.borderStyle = 'solid';
    rule.style.padding = '3px';
    rule.style.borderWidth = '1px';
    rule.style.borderColor = backgroundColor;
    rule.style.backgroundColor = controlBackgroundColor;
    rule.style.color = controlTextColor;
    rule.style.fontSize = controlFontSize + 'px';
  }

  theObject = document.getElementById("headerMovesPadding");
  if (theObject) { theObject.style.minHeight = paddingControlHeight; }

  start_pgn4web();

  theObject = document.getElementById("GameSelector");
  if (theObject) { if (theObject.innerHTML != "") { theObject.style.paddingBottom = paddingControlHeight; } }

  boardHeight = document.getElementById("boardTable").offsetHeight;
  document.getElementById("boardTable").style.width = boardHeight;
  boardWidth = document.getElementById("boardTable").offsetWidth;
  if (showButtons) { boardHeight += document.getElementById("GameButtons").offsetHeight }
  if (showButtons && (numberOfGames > 1)) { boardHeight += document.getElementById("GameSelector").offsetHeight }

  theObject = document.getElementById("headerMoves");
  if (theObject != null) { 
    if (frameWidth == "") { document.getElementById("headerMoves").style.width = textWidth; }
    else { document.getElementById("headerMoves").style.width = frameWidth; }

    if (frameHeight == "") { document.getElementById("headerMoves").style.height = textHeight; }
    else { 
      headerMovesPaddingHeight = document.getElementById("headerMovesPadding").offsetHeight;
      document.getElementById("headerMoves").style.height = frameHeight - boardHeight - 2 * framePadding - headerMovesPaddingHeight; 
    }
  }

  if (gup("showHeightWidth") != "") { 
    alert("board dimensions\n\nwidth: " + boardWidth + "\nheight: " + boardHeight);
  }
}

window.onload = new_start_pgn4web;

function getCSSRule(ruleName, deleteFlag) {               // Return requested style obejct
   ruleName=ruleName.toLowerCase();                       // Convert test string to lower case.
   if (document.styleSheets) {                            // If browser can play with stylesheets
      for (var i=0; i<document.styleSheets.length; i++) { // For each stylesheet
         var styleSheet=document.styleSheets[i];          // Get the current Stylesheet
         var ii=0;                                        // Initialize subCounter.
         var cssRule=false;                               // Initialize cssRule. 
         do {                                             // For each rule in stylesheet
            if (styleSheet.cssRules) {                    // Browser uses cssRules?
               cssRule = styleSheet.cssRules[ii];         // Yes --Mozilla Style
            } else {                                      // Browser usses rules?
               cssRule = styleSheet.rules[ii];            // Yes IE style. 
            }                                             // End IE check.
	    if (cssRule)  {                               // If we found a rule...
     	      if (cssRule.selectorText.toLowerCase()==ruleName) { //  match ruleName?
  	        if (deleteFlag=='delete') {             // Yes.  Are we deleteing?
                     if (styleSheet.cssRules) {           // Yes, deleting...
                        styleSheet.deleteRule(ii);        // Delete rule, Moz Style
                     } else {                             // Still deleting.
                        styleSheet.removeRule(ii);        // Delete rule IE style.
                     }                                    // End IE check.
                     return true;                         // return true, class deleted.
                  } else {                                // found and not deleting.
                     return cssRule;                      // return the style object.
                  }                                       // End delete Check
               }                                          // End found rule name
            }                                             // end found cssRule
            ii++;                                         // Increment sub-counter
         } while (cssRule)                                // end While loop
      }                                                   // end For loop
   }                                                      // end styleSheet ability check
   return false;                                          // we found NOTHING!
}                                                         // end getCSSRule 

function killCSSRule(ruleName) {                          // Delete a CSS rule   
   return getCSSRule(ruleName,'delete');                  // just call getCSSRule w/delete flag.
}                                                         // end killCSSRule

function addCSSRule(ruleName) {                           // Create a new css rule
   if (document.styleSheets) {                            // Can browser do styleSheets?
      if (!getCSSRule(ruleName)) {                        // if rule doesn't exist...
         if (document.styleSheets[0].addRule) {           // Browser is IE?
            document.styleSheets[0].addRule(ruleName, null,0);      // Yes, add IE style
         } else {                                         // Browser is IE?
            document.styleSheets[0].insertRule(ruleName+' { }', 0); // Yes, add Moz style.
         }                                                // End browser check
      }                                                   // End already exist check.
   }                                                      // End browser ability check.
   return getCSSRule(ruleName);                           // return rule we just created.
} 


function percentFixFromUrl( text ) {
  text += ''; // makes sure text is a string
  return text.replace(/pct$/,'%');
}

function gup( name ){

  name = name.replace(/[\[]/,"\\\[").replace(/[\]]/,"\\\]");
  var regexS = "[\\?&]"+name+"=([^&#]*)";  
  regexS = regexS+"(?!.*"+regexS+")"; // matches the LAST occurrence
  var regex = new RegExp( regexS );
  var results = regex.exec( window.location.href );
  if( results != null ) { switch (results[1]) {
    case "t": case "T": return "true";  break;
    case "f": case "F": return "false"; break;
    default: return results[1]; 
  } }

  // allows for short version of the URL parameters, for instance sC matches squareColor
  compact_name = name.charAt(0);
  for(i=1; i<name.length; i++){
    if (name.charAt(i).match(/[A-Z]/)) { compact_name = compact_name + name.charAt(i).toLowerCase(); }
  }
  name = compact_name;
  
  name = name.replace(/[\[]/,"\\\[").replace(/[\]]/,"\\\]");
  var regexS = "[\\?&]"+name+"=([^&#]*)";  
  regexS = regexS+"(?!.*"+regexS+")"; // matches the LAST occurrence
  var regex = new RegExp( regexS );

  var results = regex.exec( window.location.href );
  if( results != null ) { switch (results[1]) {
    case "t": case "T": return "true";  break;
    case "f": case "F": return "false"; break;
    default: return results[1]; 
  } }
  
  return "";
}

SetHighlightOption(true);
SetShortcutKeysEnabled(false);

if ((pieceFont = gup("pieceFont")) == "")
  if ((pieceFont = gup("font")) == "") 
    { pieceFont = "alpha"; } // left for compatibility with older version

if ((pieceSize = gup("pieceSize")) == "") { pieceSize = 24; }
else { pieceSize = parseInt(pieceSize); }

SetImagePath(pieceFont + "/" + pieceSize);

if ((squareSize = gup("squareSize")) == "") { squareSize = 28; }
else { squareSize = parseInt(squareSize); }

if ((lightColor = gup("lightColorName")) == "") {if ((lightColor = "#" + gup("lightColorHex")) == "#") lightColor = "#EFF4EC"}
if ((darkColor  = gup("darkColorName"))  == "") {if ((darkColor  = "#" + gup("darkColorHex"))  == "#") darkColor  = "#C6CEC3"}
if ((highlightColor  = gup("highlightColorName"))  == "") {if ((highlightColor  = "#" + gup("highlightColorHex"))  == "#") highlightColor  = "#DAF4D7"}
if ((highlightColor == 'none') || (highlightColor == '#none')) {
  highlightLightColor = lightColor;
  highlightDarkColor = darkColor;
} else { 
  highlightLightColor = highlightColor;
  highlightDarkColor = highlightColor;
}

if ((boardBorderColor = gup("boardBorderColorName")) == "") {if ((boardBorderColor = "#" + gup("boardBorderColorHex")) == "#") boardBorderColor = "#000000"}

if ((highlightMoveColor  = gup("highlightMoveColorName"))  == "") {if ((highlightMoveColor  = "#" + gup("highlightMoveColorHex"))  == "#") highlightMoveColor  = "#DAF4D7"}

if ((backgroundColor = gup("backgroundColorName")) == "") {if ((backgroundColor = "#" + gup("backgroundColorHex")) == "#") backgroundColor = "#FFFFFF"}

if ((framePadding = percentFixFromUrl( gup("framePadding") )) == "") { framePadding = 0;}

if ((fontHeaderSize = percentFixFromUrl( gup("fontHeaderSize") )) == "") { fontHeaderSize = "100%"; }
if ((fontHeaderColor = gup("fontHeaderColorName")) == "") {if ((fontHeaderColor = "#" + gup("fontHeaderColorHex")) == "#") fontHeaderColor = "black"}

if ((fontMovesSize = percentFixFromUrl( gup("fontMovesSize") )) == "") { fontMovesSize = "100%"; }
if ((fontMovesColor = gup("fontMovesColorName")) == "") {if ((fontMovesColor = "#" + gup("fontMovesColorHex")) == "#") fontMovesColor = "black"}

if ((fontCommentsSize = percentFixFromUrl( gup("fontCommentsSize") )) == "") { fontCommentsSize = "100%"; }
if ((fontCommentsColor = gup("fontCommentsColorName")) == "") {if ((fontCommentsColor = "#" + gup("fontCommentsColorHex")) == "#") fontCommentsColor = "gray"}

if (gup("auto") == "false") { SetAutostartAutoplay(false); }
else { SetAutostartAutoplay(true); }
 
if (gup("loop") == "true") { SetAutoplayNextGame(true); }
else { SetAutoplayNextGame(false); }

if (gup("delay") == "") SetAutoplayDelay(1000);
else SetAutoplayDelay(gup("delay"));

if (gup("showButtons") == "true") { showButtons = true }
else { showButtons = false }

if ((controlBackgroundColor = gup("controlBackgroundColorName")) == "") {if ((controlBackgroundColor = "#" + gup("controlBackgroundColorHex")) == "#") controlBackgroundColor = "default"}
if ((controlTextColor = gup("controlTextColorName")) == "") {if ((controlTextColor = "#" + gup("controlTextColorHex")) == "#") controlTextColor = "black"}

if (gup("showComments") == "false") { SetCommentsIntoMoveText(false); }
if (gup("showCommentsOnSeparateLines") == "true") { SetCommentsOnSeparateLines(true); }

if ((fenString = gup("fenString")) != "") {
  // remove URL escape chars such as %20 replaced by space
  fenString = decodeURIComponent(fenString);
  document.getElementById('pgnText').innerHTML = '[FEN "' + fenString + '"]';
}

if ((newPgnText = gup("pgnText")) != "") {

  // remove URL escape chars such as %20 replaced by space
  newPgnText = decodeURIComponent(newPgnText);

  // cleans the PGN text
  newPgnText = newPgnText.replace(/\[/g,"\n\n[");
  newPgnText = newPgnText.replace(/\]/g,"]\n\n");
  newPgnText = newPgnText.replace(/([012\*])([\s]*)(\[)/g,"$1\n\n$3");
  newPgnText = newPgnText.replace(/\]([\s]*)\[/g,"]\n[");
  newPgnText = newPgnText.replace(/^([\s]*)\[/g,"[");

  document.getElementById('pgnText').innerHTML = newPgnText;
} 

if ((fenString != "") && (newPgnText != "")) {
  alert("ERROR: both fenString and pgnText assigned, fenString value ignored.");
}

if (gup("showHeader") == "true") { showHeader = true }
else { showHeader = false }

if (gup("showMoves") == "true") { showMoves = true }
else { showMoves = false }

if ((textHeight = percentFixFromUrl( gup("textHeight") )) == "") { textHeight="100%" }
if ((textWidth = percentFixFromUrl( gup("textWidth") )) == "") { textWidth="100%" }
if ((textMargin = percentFixFromUrl( gup("textMargin") )) == "") { textMargin=0 }

frameHeight = percentFixFromUrl( gup("frameHeight") );
frameWidth = percentFixFromUrl( gup("frameWidth") );

if (gup("help") != "") {
  document.write("<PRE>");
  document.write("URL parameters\n");
  document.write("\n");
  document.write(" - pgnText = PGN games to display\n");
  document.write(" - fenString = FEN position to display, superceded by pgnText if set\n");
  document.write("\n");
  document.write(" - auto = if set true, autoplays game, otherwise if false (default true)\n");
  document.write(" - delay = autoplay delay in ms (default 1000)\n");
  document.write(" - loop = if set true, loop indefinitely through games (default false)\n");
  document.write("\n");
  document.write(" - pieceFont = alpha | merida | uscf (default alpha)\n");
  document.write(" - pieceSize = size of pieces (default 24)\n");
  document.write(" - squareSize = size of square (default 28)\n");
  document.write(" - lightColorName = light square color name, like red\n");
  document.write(" - darkColorName = dark square color name, like red\n");
  document.write(" - highlightColorName = highlight color name, like red, 'none' for no highligh\n");
  document.write(" - boardBorderColorName = board border color name, like red, 'none' for no highligh\n");
  document.write(" - lightColorHex = light square color hex code, like FF0000 (default EFF4EC)\n");
  document.write(" - darkColorHex = dark square color hex code, like FF0000 (default C6CEC3)\n");
  document.write(" - highlightColorHex = highlight color hex code, like FF0000, 'none' for no highligh (default DAF4D7)\n");
  document.write(" - boardBorderColorHex = board border color hex code, like FF0000, 'none' for no highligh (default 000000)\n");
  document.write("\n");
  document.write(" - showButtons = if set true, prints control buttons (default false)\n");
  document.write(" - controlBackgroundColorName = control buttons background color name, like red, or 'default' (default 'default')\n");
  document.write(" - controlBackgroundColorHex = control buttons background color hex code, like FF0000, or 'default'\n");
  document.write(" - controlTextColorName = control buttons text color name, like red (default black)\n");
  document.write(" - controlTextColorHex = control buttons text color hex code, like FF0000\n");
  document.write("\n");
  document.write(" - showHeader = if set true, displays game header text (default false)\n");
  document.write(" - showMoves = if set true, displays moves text (default false)\n");
  document.write(" - textHeight = set height of the textual section, header and/or moves text, might be ingored if frameHeight is set (default 100%)\n");
  document.write(" - textWidth = set width of the textual section, header and/or moves text, might be ignored if frameWidth is set (default 100%)\n");
  document.write(" - textMargin = set left/right margin width of the  textual section, header and/or moves text (default 0)\n");
  document.write(" - showComments = if set false, removes comments when displaying moves text (default true)\n");
  document.write(" - showCommentsOnSeparateLines = if set true, add newlines chars when displaying comments (default false)\n"); 
  document.write(" - fontHeaderColorName = header color name, like red (default black)\n");
  document.write(" - fontMovesColorName = moves color name, like red (default black)\n");
  document.write(" - fontCommentsColorName = comments color name, like red (default gray)\n");
  document.write(" - highlightMoveColorName = background color name to highlight current move, like red, 'none' for no highligh\n");
  document.write(" - fontHeaderColorHex = header color hex code, like FF0000\n");
  document.write(" - fontMovesColorHex = moves color hex code, like FF0000\n");
  document.write(" - fontCommentsColorHex = commentss color hex code, like FF0000\n");
  document.write(" - highlightMoveColorHex = background color hex code to highlight current move, like FF0000, 'none' for no highligh (default DAF4D7)\n");
  document.write(" - fontHeaderSize = header font size, like 20 or 120% (default 100pct meaning 100%)\n");
  document.write(" - fontMovesSize = header font size, like 20 or 120% (default 100pct meaning 100%)\n");
  document.write(" - fontCommentsSize = header font size, like 20 or 120% (default 100pct meaning 100%)\n");
  document.write("\n");
  document.write(" - backgroundColorName = page background color name, like red\n");
  document.write(" - backgroundColorHex = page background color hex code, like FF0000\n");
  document.write(" - frameHeight = set height of the total page, overriding textHeight (default not set)\n");
  document.write(" - frameWidth = set width of the total page, overriding textWidth (default not set)\n");
  document.write(" - framePadding = padding within the frame (default 0)\n");
  document.write("\n");
  document.write(" - showHeightWidth = if set true, calculates optimal iframe dimensions (default false)\n");
  document.write(" - help = if set true, shows help info (default false)\n");
  document.write("\n");
  document.write("URL parameters can be shortened: for example squareSize => sq, auto => a, highlightMoveColorHex => hmch\n");
  document.write("Also values true and false can be shortened: true => t, false => f\n");
  document.write("</PRE>\n<HR>\n");
}

document.write("<table cellspacing=0 cellpadding=0 width=100%><tr><td align=center>");

if (showButtons) {
  document.write("<div id='GameSelector'></div></td></tr><tr><td align=center><div id='GameBoard'></div></td></tr><tr><td align=center><div id='GameButtons'></div>") 
} else {
  document.write("<div id='GameBoard'></div>")
}

if (showHeader) {
  document.write("<div id='headerMovesPadding' class='header'>&nbsp;</div>");
} else if (showMoves) {
  document.write("<div id='headerMovesPadding' class='moves'>&nbsp;</div>");
}

if ((showHeader) || (showMoves)) {
  document.write("<div id='headerMoves' style='overflow:auto; height: " + textHeight + "; width: " + textWidth + "; scrollbar-base-color: " + backgroundColor + ";'>")
} 

if (showHeader) {

  document.write("<table width=100% cellpadding=0 cellspacing=0 border=0><tr>");
  document.write("<td width=48% align=left>");
  document.write("<div class='header' style=' margin-left:" + textMargin + "; white-space: nowrap;' id=GameWhite></div>");
  document.write("</td><td width=4%><div class='header'></div></td><td width=48% align=right>");
  document.write("<div class='header' style=' margin-right:" + textMargin + ";' id=GameDate></div>");
  document.write("</td></tr></table>");

  document.write("<table width=100% cellpadding=0 cellspacing=0 border=0><tr>");
  document.write("<td width=48% align=left>");
  document.write("<div class='header' style=' margin-left:" + textMargin + "; white-space: nowrap;' id=GameBlack></div>");
  document.write("</td><td width=4%><div class='header'></div></td><td width=48% align=right>");
  document.write("<div class='header' style=' margin-right:" + textMargin + "; white-space: nowrap;' id=GameSite></div>");
  document.write("</td></tr></table>");

  document.write("<table width=100% cellpadding=0 cellspacing=0 border=0><tr>");
  document.write("<td width=48% align=left>");
  document.write("<div class='header' style=' margin-left:" + textMargin + ";' id=GameResult></div>");
  document.write("</td><td width=4%><div class='header'></div></td><td width=48% align=right>");
  document.write("<div class='header' style=' margin-right:" + textMargin + "; white-space: nowrap;' id=GameEvent></div>");
  document.write("</td></tr></table>");

}

if ((showHeader) && (showMoves)) {
  document.write("<div class='header'>&nbsp;<br></div>");
}

if (showMoves) {
  document.write("<div style='text-align: justify; margin-right:" + textMargin + "; margin-left:" + textMargin + ";' id=GameText></div>");
}

if ((showHeader) || (showMoves)) {
  document.write("</div>")
} 

document.write("</div>");

document.write("</td></tr></table>");
		
</script>

</body>

</html>


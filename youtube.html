<html>

<!--
  pgn4web javascript chessboard
  copyright (C) 2009, 2011 Paolo Casaschi
  see README file and http://pgn4web.casaschi.net
  for credits, license and more details
-->

<head>

<link rel="shortcut icon" href="pawn.ico" />

<style type="text/css">

body {
  color: black;
  background: white;
  font-family: sans-serif;
}

.boardTable {
  border-style: solid;
  border-color: #663300;
  border-width: 3px;
  height: 318px;
  width: 318px;
  box-shadow: 0px 0px 20px #663300;
  -webkit-box-shadow: 0px 0px 20px #663300;
  -moz-box-shadow: 0px 0px 20px #663300;
}

.pieceImage {
  width: 30px;
  height: 30px;
}

.whiteSquare,
.blackSquare,
.highlightWhiteSquare,
.highlightBlackSquare {
  width: 39px;
  height: 39px;
  border-style: solid;
  border-width: 2px;
}

.whiteSquare,
.highlightWhiteSquare {
  border-color: #FFCC99;
  background: #FFCC99;
}

.blackSquare,
.highlightBlackSquare {
  border-color: #CC9966;
  background: #CC9966;
}

.highlightWhiteSquare,
.highlightBlackSquare {
  border-color: #663300;
  border-style: solid;
}

</style>

<script type="text/javascript" src="swfobject/swfobject.js"></script>

<script src="pgn4web.js" type="text/javascript"></script>

<script type="text/javascript">

var pgnFile_default = "youtube.pgn";
// accepts pgnData as alias for pgnFile for consistency with board.html
if ((pgnFile = gup("pgnData")) === "") {
  if ((pgnFile = gup("pgnFile")) === "") {
    pgnFile = pgnFile_default;
  }
}

var youtubeVideo_default = "EUEypIgynsk"; // demo video corresponding to the youtube.pgn game
if ((youtubeVideo = gup("youtubeVideo")) === "") {
  youtubeVideo = youtubeVideo_default;
}

if ((gup("help") == "true") || (gup("help") == "t")) {
  alert("pgn4web youtube.html parameters" + "\n" +
        " - pgnData = " + pgnFile + "; PGN file to load (default " + pgnFile_default + ")" + "\n" +
        " - youtubeVideo = " + youtubeVideo + "; youtube video id (default " + youtubeVideo_default + ")" + "\n" +
        " - debug = true|false; if true timing info is shown to help adjuting the PGN file (default false)" + "\n" +
        " - help = true; prints this help (default false)");
}

function gup( name ){

  name = name.replace(/[\[]/,"\\\[").replace(/[\]]/,"\\\]");
  var regexS = "[\\?&]"+name+"=([^&#]*)";
  // commented below to match first occurrence (to avoid users overruling setting)
  // regexS = regexS+"(?!.*"+regexS+")"; // matches the LAST occurrence
  var regex = new RegExp( regexS, "i" );
  var results = regex.exec( window.location.href );
  if( results !== null ) { return decodeURIComponent(results[1]); }

  // allows for short version of the URL parameters, for instance sC matches squareColor
  compact_name = name.charAt(0);
    for(i=1; i<name.length; i++){
      if (name.charAt(i).match(/[A-Z]/)) { compact_name = compact_name + name.charAt(i).toLowerCase(); }
    }
  name = compact_name;

  name = name.replace(/[\[]/,"\\\[").replace(/[\]]/,"\\\]");
  regexS = "[\\?&]"+name+"=([^&#]*)";
  // commented below to match first occurrence (to avoid users overruling setting)
  // regexS = regexS+"(?!.*"+regexS+")"; // matches the LAST occurrence
  regex = new RegExp( regexS, "i" );

  results = regex.exec( window.location.href );
  if( results !== null ) { return decodeURIComponent(results[1]); }

  return "";
}


var expressInstall = null;
var flashvars = { };
var params = { allowScriptAccess: "always", play: "true", loop: "false", menu: "false" };
var atts = { id: "myytplayer" };
swfobject.embedSWF("http://www.youtube.com/e/" + youtubeVideo + "?enablejsapi=1&playerapiid=ytplayer", "ytapiplayer", "640", "390", "8", expressInstall, flashvars, params, atts);

SetPgnUrl(pgnFile); // if set, this has precedence over the inline PGN below
SetImagePath ("alpha/30"); // use "" path if images are in the same folder as this javascript file
SetImageType("png");
SetHighlightOption(true); // true or false
SetShortcutKeysEnabled(false);

var videotimeAtPly = new Array();
function getVideotimeAtPly() {
  videotimeAtPly = new Array();
  for(thisPly=StartPly; thisPly<=StartPly+PlyNumber; thisPly++) {
    videotimeAtPly[thisPly] = customPgnCommentTag("vt", null, thisPly);
  }
}

function customFunctionOnPgnGameLoad() {
  getVideotimeAtPly();
}

var syncTimer = null;
function customFunctionOnPgnTextLoad() {
  if (syncTimer) { clearTimeout(syncTimer); }
  syncTimer = setTimeout("syncBoard();", 300);
}

function syncBoard() {
  var ytCurrentTime = 0;
  if (syncTimer) { clearTimeout(syncTimer); }
  ytplayer = document.getElementById("myytplayer");
  if (ytplayer.getCurrentTime) { ytCurrentTime = ytplayer.getCurrentTime(); }

  // if the video shows multiple games, here you can add a check on the video time 
  // and load the appropriate game if necessary with: Init(newGameNumber);

  document.getElementById("debug").innerHTML = ytCurrentTime;
  for (thisPly=StartPly; thisPly<=StartPly+PlyNumber; thisPly++) {
    if (videotimeAtPly[thisPly] && (videotimeAtPly[thisPly] > ytCurrentTime)) { break; }
    GoToMove(thisPly);
  } 
  syncTimer = setTimeout("syncBoard();", 300);
}

</script>

</head>

<body>

<!-- paste your PGN below and make sure you dont specify an external source with SetPgnUrl() -->
<form style="display: none;"><textarea style="display: none;" id="pgnText">

</textarea></form>

<table cellspacing="20"><tr valign="top"><td>

<div id="ytapiplayer">
You need Flash player 8+ and JavaScript enabled to view this video.
</div>

</td><td>

<div style="text-align:center; font-weight:bold; margin-bottom:1em;" id="GameBlackClock"></div>
<div id="GameBoard"></div>
<div style="text-align:center; font-weight:bold; margin-top:1em;" id="GameWhiteClock"></div>

</td></tr></table>

<div id="debug"></div>

<script type="text/javascript">

if ((gup("debug") == "true") || (gup("debug") == "t")) {
  document.getElementById("debug").style.display = "inline";
} else {
  document.getElementById("debug").style.display = "none";
}

</script>

</body>

</html>

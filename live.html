<html>

<head>

<title>pgn4web live boradcast</title>

<link href="live.css" type="text/css" rel="stylesheet"></link>

<script src="pgn4web.js" type="text/javascript"></script>
<script>

  if ((pgnFile = gup("pgnFile")) == "") { pgnFile = "live.pgn"; }
  if ((refreshMinutes = gup("refreshMinutes")) == "") { refreshMinutes = 1; }
  if (gup("demo") == "true") { demoFlag = true; alertFlag = true; }
  else { demoFlag = false; alertFlag = false; }
  if (gup("help") == "true") { print_help(); }

  SetPgnUrl(pgnFile); 
  SetImagePath ("uscf/24"); 
  SetImageType("png");
  SetHighlightOption(true); // true or false
  SetGameSelectorOptions("Select a live game...", true, 0, 0, 0, 15, 15, 3, 0); // (head, num, chEvent, chSite, chRound, chWhite, chBlack, chResult, chDate)
  SetCommentsIntoMoveText(false);
  SetCommentsOnSeparateLines(false);
  SetAutoplayDelay(3000); // milliseconds
  SetAutostartAutoplay(false);
  SetAutoplayNextGame(false); // if set, move to the next game at the end of the current game during autoplay
  SetInitialGame(1); // number of game to be shown at load, from 1 (default); values (keep the quotes) of "first", "last", "random" are also accepted
  SetInitialHalfmove("end",true); // halfmove number to be shown at load, 0 (default) for start position; values (keep the quotes) of "start", "end", "random" and "comment" (go to first comment) are also accepted. Second parameter if true applies the setting to every selected game instead of startup only (default)
  SetShortcutKeysEnabled(false);

  SetLiveBroadcast(refreshMinutes, alertFlag, demoFlag); // set live broadcast; parameters are delay (refresh delay in minutes, 0 means no broadcast, default 0) alertFlag (if true, displays debug error messages, default false) demoFlag (if true starts broadcast demo mode, default false)

  originalTitle = document.title;
  function customFunctionOnPgnTextLoad() {
    if ((gameEvent[0] != undefined) && (gameEvent[0] != "")) {
      document.title = originalTitle + ": " + gameEvent[0];
    }
    if ((!LiveBroadcastStarted) || (LiveBroadcastEnded)) {
      document.getElementById("liveStatusDetails").style.background = #F5B371;
    } else {
      document.getElementById("liveStatusDetails").style.background = black;
    }
    if ((gameRound[0] != undefined) && (gameRound[0] != "")) {
      document.getElementById("roundDetails").innerHTML = "round ";
    } else {
      document.getElementById("roundDetails").innerHTML = "";
    }
    if ((gameWhite[0] != undefined) && (gameWhite[0] != "")) {
      document.getElementById("whiteDetails").style.background = #F5B371;
    } else {
      document.getElementById("whiteDetails").style.background = black;
    }
    if ((gameBlack[0] != undefined) && (gameBlack[0] != "")) {
      document.getElementById("blackDetails").style.background = #F5B371;
    } else {
      document.getElementById("blackDetails").style.background = black;
    }
    document.getElementById("refreshTime").innerHTML = Date();
  }

function gup( name ){

  name = name.replace(/[\[]/,"\\\[").replace(/[\]]/,"\\\]");
  var regexS = "[\\?&]"+name+"=([^&#]*)";
  regexS = regexS+"(?!.*"+regexS+")"; // matches the LAST occurrence
  var regex = new RegExp( regexS );
  var results = regex.exec( window.location.href );
  if( results != null ) { switch (results[1]) {
    case "t": case "T": return "true";  break;
    case "f": case "F": return "false"; break;
    default: return results[1];
  } }

  // allows for short version of the URL parameters, for instance sC matches squareColor
  compact_name = name.charAt(0);
    for(i=1; i<name.length; i++){
      if (name.charAt(i).match(/[A-Z]/)) { compact_name = compact_name + name.charAt(i).toLowerCase(); }
    }
  name = compact_name;

  name = name.replace(/[\[]/,"\\\[").replace(/[\]]/,"\\\]");
  var regexS = "[\\?&]"+name+"=([^&#]*)";
  regexS = regexS+"(?!.*"+regexS+")"; // matches the LAST occurrence
  var regex = new RegExp( regexS );

  var results = regex.exec( window.location.href );
  if( results != null ) { switch (results[1]) {
    case "t": case "T": return "true";  break;
    case "f": case "F": return "false"; break;
    default: return results[1];
  } }

  return "";
}

function print_help() {
  alert("pgn4web live.html parameters" + "\n" + 
        " - pgnFile = " + pgnFile + "; PGN file to load (default live.pgn)" + "\n" + 
        " - refreshMinutes = " + refreshMinutes + "; refresh interval in minutes, decimals allowed (default 1)" + "\n" +
        " - demo = " + demoFlag + "; if set true, sets live demo mode (default false)" + "\n" +
        " - help = if set true, prints this help (default false)");
}

</script>

</head>

<body>

<!-- paste your PGN below and make sure you dont specify an external source with SetPgnUrl() -->
<span style="display:none" id="pgnText">

</span>
<!-- paste your PGN above and make sure you dont specify an external source with SetPgnUrl() -->

<center>

<table id="liveTable" width=460px cellpadding=0 cellspacing=5 border=0>

<tr>

<td align=left colspan=2 width=450px>
<div id="GameSelector"></div>
</td>

</tr>

<tr>

<td width=246px align=left>

<table id="whiteDetails" cellpadding=3 cellspacing=0 width=246px><tr><td align=left>
<span style="font-size: 75%" id="GameWhite"></span>
</td><td align=right>
<span style="font-size: 75%" id="GameWhiteClock"></span>
</td></tr></table>

<table id="blackDetails" cellpadding=3 cellspacing=0 width=246px><tr><td align=left>
<span style="font-size: 75%" id="GameBlack"></span>
</td><td align=right>
<span style="font-size: 75%" id="GameBlackClock"></span>
</td></tr></table>

</td>

<td width=199px align=left>

<table cellpadding=3 cellspacing=0 width=199px><tr><td align=left>
<span style="font-size: 75%" id="GameEvent"></span>
</td><td align=right>
<span style="font-size: 75%"><span id="roundDetails"></span><span id="GameRound"></span></span>
</td></tr></table>

<table cellpadding=3 cellspacing=0 width=199px><tr><td align=left>
<span style="font-size: 75%" id="GameSite"></span>
</td><td align=right>
<span style="font-size: 75%" id="GameDate"></span>
</td></tr></table>

</td>

</tr>

<tr valign=top>

<td width=246px align=left>
<span id="GameBoard"></span>
</td>

<td width=199px valign=top align=left>
<div style="height: 246px; overflow: auto; font-size: 75%; scrollbar-base-color: #E4E4E4;" id="GameText"></div>
</td>

<tr>

<td width=246px align=left>
<span style="margin-left: 3px; font-size: 75%" id="GameResult"></span>
</td>

<td id="liveStatusDetails" width=199px align=center>
<span style="font-size: 75%;" id="GameLiveStatus"></span>
</td>

</tr>

<tr>

<td align=left width=246px>
<span id="refreshTime" style="text-align: right; font-size: 50%; color: #CCCCCC;"></span>
</td>
<td width=199px align=center>
<a id="pgn4webLink" style="color: #CCCCCC; text-decoration: none; font-size: 50%;" target=_blank href=http://pgn4web.casaschi.net>pgn4web live</a>
</td>

</tr>

</table>

</center>

<script>
if (demoFlag) { document.getElementById("pgn4webLink").innerHTML += " demo"; }
</script>

</body>

</html>


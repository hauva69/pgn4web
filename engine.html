<html>

<!--
  pgn4web javascript chessboard
  copyright (C) 2009-2012 Paolo Casaschi
  see README file and http://pgn4web.casaschi.net
  for credits, license and more details
-->

<head>

<title>pgn4web engine analysis</title>

<link rel="shortcut icon" href="pawn.ico" />

<style type="text/css">

body {
  margin: 0;
  font-family: sans-serif;
  overflow: hidden;
}

a {
  text-decoration: none;
}

.container {
  overflow: hidden;
  position: relative;
}

.gameCustomButtons {
  width: 100%;
}

.gameEval {
  position: absolute;
  right: 0;
  bottom: 0;
  z-index: 3;
}

.gameAnalysis {
  white-space: nowrap;
  text-align: left;
}

.gameAnalysisHidden {
  visibility: hidden;
}

.gameFlagAndMoves {
  position: absolute;
  bottom: 0;
  z-index: 2;
}

.gameFlagToMove {
  border-color: black;
}

.gameMoves {
  white-space: nowrap;
}

</style>

<script src="pgn4web.js" type="text/javascript"></script>
<script src="chess-informant-NAG-symbols.js" type="text/javascript"></script>

</head>

<body>

<!-- paste your PGN below and make sure you dont specify an external source with SetPgnUrl() -->
<form style="display: none;"><textarea style="display: none;" id="pgnText">

</textarea></form>
<!-- paste your PGN above and make sure you dont specify an external source with SetPgnUrl() -->

<center>
<div class="container">
<div id="GameBoard"></div>
<table id="GameCustomButtons" class="gameCustomButtons" cellspacing="0" cellpadding="0" border="0"><tr valign="bottom">
<td id="btnStart" width="25%" align="center" onclick="GoToMove(StartPlyVar[0], 0);" title="go to start">&lt;&lt;</td>
<td id="btnBack" width="20%" align="center" onclick="GoToMove(CurrentPly - 1);" title="move backward">&lt;</td>
<td width="10%" align="center" class="gameAnalysisFlag" id="GameAnalysisFlag">&nbsp;</td>
<td id="btnForw" width="20%" align="center" onclick="GoToMove(CurrentPly + 1);" title="move forward">&gt;</td>
<td id="btnEnd" width="25%" align="center" onclick="GoToMove(StartPlyVar[0] + PlyNumberVar[0], 0);" title="go to end">&gt;&gt;</td>
</tr></table>
<div class="gameAnalysis gameAnalysisHidden" id="GameAnalysis">
<div class="gameEval" id="GameEval">&middot;</div>
<div class="gameFlagAndMoves">
<img class="gameFlagToMove" id="GameFlagToMove" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoEAYAAADcbmQuAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAAAZiS0dEAMAAwADAGp0HVAAAAAlwSFlzAAAASAAAAEgARslrPgAAAAl2cEFnAAAAKAAAACgAo3CU+AAAACNJREFUaN7twQENAAAAwqD3T20PBxQAAAAAAAAAAAAAAAAPBjIoAAFxtd2pAAAAAElFTkSuQmCC" border="1" /><span class="gameMoves" id="GameMoves"></span>&nbsp;
</div>
</div>
</center>

<script type="text/javascript">

var fenString;
var analysisSeconds;
var disableInputs;
var loadIdle;

window.onload = myOnLoad;

function myOnLoad() {

   var extendedLocationSearch = window.location.search;
   try {
      if (window.opener.pgn4web_engineWindowUrlParameters) {
         if (window.location.search) {
            extendedLocationSearch = extendedLocationSearch.replace(/^\?/, "?" + window.opener.pgn4web_engineWindowUrlParameters + "&");
         } else {
            extendedLocationSearch += "?" + window.opener.pgn4web_engineWindowUrlParameters;
         }
      }
   } catch(e) {}

   thisRegExp = /(&|\?)(fenString|fs)=([^&]*)(&|$)/i;
   if (extendedLocationSearch.match(thisRegExp) !== null) {
      fenString = unescape(extendedLocationSearch.match(thisRegExp)[3]);
   } else {
      try { fenString = window.opener.FEN4engine; }
      catch(e) { fenString = FenStringStart; }
   }
   document.getElementById("pgnText").innerHTML = '[Setup "1"]\n[FEN "' + fenString + '"]\n';

   var minAnalysisSeconds = 3;
   var maxAnalysisSeconds = 313;
   thisRegExp = /(&|\?)(analysisSeconds|as)=([1-9][0-9]*)(&|$)/i;
   if (extendedLocationSearch.match(thisRegExp) !== null) {
      analysisSeconds = parseInt(unescape(extendedLocationSearch.match(thisRegExp)[3]), 10);
      if (analysisSeconds < minAnalysisSeconds) { analysisSeconds = minAnalysisSeconds; }
      if (analysisSeconds > maxAnalysisSeconds) { analysisSeconds = maxAnalysisSeconds; }
   } else {
      analysisSeconds = 13;
   }

   thisRegExp = /(&|\?)(disableInputs|di)=([^&]*)(&|$)/i;
   if (extendedLocationSearch.match(thisRegExp) !== null) {
      disableInputs = unescape(extendedLocationSearch.match(thisRegExp)[3]);
   }
   disableInputs = ((disableInputs == "true") || (disableInputs == "t"));
   if (disableInputs) {
      document.getElementById("GameCustomButtons").style.visibility = "hidden";
   }

   thisRegExp = /(&|\?)(loadIdle|li)=([^&]*)(&|$)/i;
   if (extendedLocationSearch.match(thisRegExp) !== null) {
      loadIdle = unescape(extendedLocationSearch.match(thisRegExp)[3]);
   }
   loadIdle = ((loadIdle == "true") || (loadIdle == "t"));


   var lightColorHex = "#F4F4F4";
   thisRegExp = /(&|\?)(lightColorHex|lch)=([0-9A-F]*)(&|$)/i;
   if (extendedLocationSearch.match(thisRegExp) !== null) {
      lightColorHex = "#" + unescape(extendedLocationSearch.match(thisRegExp)[3]);
   }
   var darkColorHex = "#DDDDDD";
   thisRegExp = /(&|\?)(darkColorHex|dch)=([0-9A-F]*)(&|$)/i;
   if (extendedLocationSearch.match(thisRegExp) !== null) {
      darkColorHex = "#" + unescape(extendedLocationSearch.match(thisRegExp)[3]);
   }
   var highlightColorHex = "#BBBBBB";
   thisRegExp = /(&|\?)(highlightColorHex|hch)=([0-9A-F]*)(&|$)/i;
   if (extendedLocationSearch.match(thisRegExp) !== null) {
      highlightColorHex = "#" + unescape(extendedLocationSearch.match(thisRegExp)[3]);
   }
   var fontMovesColorHex = "#000000";
   thisRegExp = /(&|\?)(fontMovesColorHex|fmch)=([0-9A-F]*)(&|$)/i;
   if (extendedLocationSearch.match(thisRegExp) !== null) {
      fontMovesColorHex = "#" + unescape(extendedLocationSearch.match(thisRegExp)[3]);
   }
   var controlTextColorHex = "#BBBBBB";
   thisRegExp = /(&|\?)(controlTextColorHex|ctch)=([0-9A-F]*)(&|$)/i;
   if (extendedLocationSearch.match(thisRegExp) !== null) {
      controlTextColorHex = "#" + unescape(extendedLocationSearch.match(thisRegExp)[3]);
   }
   var backgroundColorHex = lightColorHex;
   thisRegExp = /(&|\?)(backgroundColorHex|bch)=([0-9A-F]*)(&|$)/i;
   if (extendedLocationSearch.match(thisRegExp) !== null) {
      backgroundColorHex = "#" + unescape(extendedLocationSearch.match(thisRegExp)[3]);
   }

   var framePadding = "auto";
   thisRegExp = /(&|\?)(framePadding|fp)=([0-9]+)(&|$)/i;
   if (extendedLocationSearch.match(thisRegExp) !== null) {
      framePadding = unescape(extendedLocationSearch.match(thisRegExp)[3]);
   }
   var squareSize = "auto";
   thisRegExp = /(&|\?)(squareSize|ss)=([1-9][0-9]*|a|auto)(&|$)/i;
   if (extendedLocationSearch.match(thisRegExp) !== null) {
      squareSize = unescape(extendedLocationSearch.match(thisRegExp)[3]);
   }
   if ((squareSize == "auto") || (squareSize == "a")) {
      if (window.innerWidth && window.innerHeight) { ww = window.innerWidth; wh = window.innerHeight; }
      else if (document.documentElement && document.documentElement.clientWidth) { ww = document.documentElement.clientWidth; wh = document.documentElement.clientHeight; }
      else if (document.body && document.body.clientWidth) { ww = document.body.clientWidth; wh = document.body.clientHeight; }
      else { ww = wh = 0; }
      if (ww && wh) {
         if (framePadding == "auto") {
            squareSize = Math.floor(Math.min(ww / 10, wh / 12));
         } else {
            squareSize = Math.floor(Math.min((ww - 2 * framePadding) / 8, (wh - 2 * framePadding) / 10));
         }
      } else {
         squareSize = 30;
      }
   }
   if (squareSize < 20) { squareSize = 20; }
   if (framePadding == "auto") { framePadding = squareSize; }

   var pieceSizeOptions = new Array(20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 52, 56, 60, 64, 72, 80, 88, 96, 112, 128, 144, 300);
   function defaultPieceSize(squareSize) {
      targetPieceSize = Math.floor(0.8 * squareSize);
      for (ii=(pieceSizeOptions.length-1); ii>=0; ii--) {
         if (pieceSizeOptions[ii] <= targetPieceSize) { return pieceSizeOptions[ii]; }
      }
      return pieceSizeOptions[0];
   }
   var pieceSize = defaultPieceSize(squareSize);
   thisRegExp = /(&|\?)(pieceSize|ps)=([1-9][0-9]*)(&|$)/i;
   if (extendedLocationSearch.match(thisRegExp) !== null) {
      pieceSize = unescape(extendedLocationSearch.match(thisRegExp)[3]);
   }
   var pieceFont = "alpha";
   thisRegExp = /(&|\?)(pieceFont|pf)=([^&]*)(&|$)/i;
   if (extendedLocationSearch.match(thisRegExp) !== null) {
      pieceFont = unescape(extendedLocationSearch.match(thisRegExp)[3]);
      if (pieceFont == "a") { pieceFont = "alpha"; }
      if (pieceFont == "m") { pieceFont = "merida"; }
      if (pieceFont == "u") { pieceFont = "uscf"; }
      if ((pieceFont != "alpha") && (pieceFont != "merida") && (pieceFont != "uscf")) { pieceFont = "alpha"; }
   }
   SetImagePath(pieceFont + "/" + pieceSize);
   SetImageType("png");
   SetHighlightOption(false);
   SetShortcutKeysEnabled(false);


   var fontMovesSize = Math.ceil(squareSize * 11 / 30);
   thisRegExp = /(&|\?)(fontMovesSize|fms)=([1-9][0-9]*)(&|$)/i;
   if (extendedLocationSearch.match(thisRegExp) !== null) {
      fontMovesSize = unescape(extendedLocationSearch.match(thisRegExp)[3]);
   }
   var fontCommentsSize = Math.ceil(squareSize * 19 / 30);
   thisRegExp = /(&|\?)(fontCommentsSize|fcs)=([1-9][0-9]*)(&|$)/i;
   if (extendedLocationSearch.match(thisRegExp) !== null) {
      fontCommentsSize = unescape(extendedLocationSearch.match(thisRegExp)[3]);
   }

   thisRegExp = /(&|\?)(help|h)=(t|true)(&|$)/i;
   if (extendedLocationSearch.match(thisRegExp) !== null) {
      document.write("<PRE>");
      document.write("URL parameters\n");
      document.write("\n");
      document.write(" - fenString = FEN position to analyze\n");
      document.write(" - analysisSeconds = analysis timeout in seconds (default 13)\n");
      document.write(" - disableInputs = true | false (default false)\n");
      document.write(" - loadIdle = true | false (default false)\n");
      document.write("\n");
      document.write(" - squareSize = size of square (default selects square size to fit the available space)\n");
      document.write(" - pieceSize = size of pieces | default (default selects piece size based on square size)\n");
      document.write(" - pieceFont = alpha | merida | uscf (default alpha)\n");
      document.write("\n");
      document.write(" - lightColorHex = light square color hex code, like FF0000 (default F4F4F4)\n");
      document.write(" - darkColorHex = dark square color hex code, like FF0000 (default DDDDDD)\n");
      document.write(" - highlightColorHex = highlight color hex code, like FF0000 (default BBBBBB)\n");
      document.write(" - backgroundColorHex = page background color hex code, like FF0000 (default as lightColorHex)\n");
      document.write(" - controlTextColorHex = control buttons text color hex code, like FF0000 (default BBBBBB)\n");
      document.write(" - fontMovesColorHex = moves color hex code, like FF0000 (default 000000)\n");
      document.write("\n");
      document.write(" - fontMovesSize = moves font size (default selects moves font size based on square size)\n");
      document.write(" - fontCommentsSize = analysis comments font size (default selects comments font size based on square size)\n");
      document.write("\n");
      document.write(" - framePadding = padding within the frame (default as squareSize)\n");
      document.write("\n");
      document.write("</PRE>");
   }


   function myRulesLength(sheet) {
      if (sheet.cssRules) { return sheet.cssRules.length; }
      if (sheet.rules) { return sheet.rules.length; }
      return null;
   }

   function myInsertRule(sheet, selector, declaration) {
      if (sheet.insertRule) { sheet.insertRule(selector + "{ " + declaration + " }", myRulesLength(sheet)); }
      else if (sheet.addRule) { sheet.addRule(selector, declaration); }
   }

   sheet = document.styleSheets[0];
   myInsertRule(sheet, "body", "color: " + fontMovesColorHex + "; background: " + backgroundColorHex + "; padding: " + framePadding + "px;");
   myInsertRule(sheet, "a", "color: " + fontMovesColorHex + ";");
   myInsertRule(sheet, ".boardTable", "width: " + (squareSize * 8) + "px; height: " + (squareSize * 8) + "px; background: " + lightColorHex + ";");
   myInsertRule(sheet, ".pieceImage", "width: " + pieceSize + "px; height: " + pieceSize + "px;");
   myInsertRule(sheet, ".whiteSquare", "width: " + squareSize + "px; height: " + squareSize + "px; background: " + lightColorHex + ";");
   myInsertRule(sheet, ".highlightWhiteSquare", "width: " + squareSize + "px; height: " + squareSize + "px; background: " + highlightColorHex + ";");
   myInsertRule(sheet, ".blackSquare", "width: " + squareSize + "px; height: " + squareSize + "px; background: " + darkColorHex + ";");
   myInsertRule(sheet, ".highlightBlackSquare", "width: " + squareSize + "px; height: " + squareSize + "px; background: " + highlightColorHex + ";");
   myInsertRule(sheet, ".container", "width: " + (squareSize * 8) + "px;");
   myInsertRule(sheet, ".gameCustomButtons", "height: " + squareSize  + "px; padding-bottom: " + Math.floor(squareSize / 6) + "px; color: " + controlTextColorHex + "; font-size: " + fontMovesSize + "px;");
   myInsertRule(sheet, ".gameAnalysis", "height: " + squareSize + "px;");
   myInsertRule(sheet, ".gameFlagToMove", "height: " + Math.floor(fontMovesSize / 2) + "px; width: " + Math.floor(fontMovesSize / 2) + "px; margin-right: " + squareSize + "px;");
   myInsertRule(sheet, ".gameMoves", "font-size: " + fontMovesSize + "px;");
   myInsertRule(sheet, ".gameEval", "padding-left: " + squareSize + "px; padding-bottom: " + Math.floor(fontCommentsSize / 6) + "px; background: " + backgroundColorHex + "; font-size: " + fontCommentsSize + "px;");

   start_pgn4web();

} // myOnLoad end


var engineWorker = "garbochess/garbochess.js";

var g_backgroundEngineValid = true;
var g_backgroundEngine;
var g_nodesPerSecond = 0;

function InitializeBackgroundEngine() {
   if (!g_backgroundEngineValid) { return false; }

   if (!g_backgroundEngine) {
      g_backgroundEngineValid = true;
      try {
          g_backgroundEngine = new Worker(engineWorker);
          g_backgroundEngine.onmessage = function (e) {
             if ((e.data.match("^pv") == "pv") && (fenString == CurrentFEN())) {
                if (matches = e.data.substr(3, e.data.length - 3).match(/Ply:(\d+) Score:(-*\d+) Nodes:(\d+) NPS:(\d+) (.*)/)) {
                   ply = parseInt(matches[1], 10);
                   if (isNaN(ev = parseInt(matches[2], 10))) {
                      ev = "";
                   } else {
                      maxEv = 99.9;
                      ev = Math.round(ev / 100) / 10;
                      if (ev < -maxEv) { ev = -maxEv; } else if (ev > maxEv) { ev = maxEv; }
                      if (fenString.indexOf(" b ") !== -1) { ev = -ev; }
                   }
                   document.getElementById("GameEval").innerHTML = ev2NAG(ev);
                   document.getElementById("GameEval").title = (ev > 0 ? " +" : " ") + ev + (ev == Math.floor(ev) ? ".0 " : " ");
                   nodes = parseInt(matches[3], 10);
                   g_nodesPerSecond = parseInt(matches[4], 10);
                   pv = matches[5].replace(/(^\s+|\s*\+|\s+$)/g, "").replace(/\s*stalemate/, "=").replace(/\s*checkmate/, "#");
                   document.getElementById("GameMoves").innerHTML = pv;
                   document.getElementById("GameMoves").title = pv;
                   if (!disableInputs) {
                      document.getElementById("GameMoves").setAttribute("onClick", "addPly(this.innerHTML.replace(/^\\s*(\\S+).*$/, '$1'));");
                   }
                   document.getElementById("GameAnalysisFlag").innerHTML = "&middot;";
                   document.getElementById("GameAnalysisFlag").title = "analysis engine running";
                }
             }
          };
      } catch(e) {
        g_backgroundEngineValid = false;
        document.getElementById("GameMoves").innerHTML = "engine analysis unavailable";
        document.getElementById("GameMoves").title = "engine analysis not supported by this web browser";
      }
   }
   return g_backgroundEngineValid;
}

function ev2NAG(ev) {
   if ((ev === null) || (ev === "") || (isNaN(ev = parseFloat(ev)))) { return ""; }
   if (ev < -3.95) { return NAG[19]; } // -+
   if (ev >  3.95) { return NAG[18]; } // +-
   if (ev < -1.35) { return NAG[17]; } // -/+
   if (ev >  1.35) { return NAG[16]; } // +/-
   if (ev < -0.35) { return NAG[15]; } // =/+
   if (ev >  0.35) { return NAG[14]; } // +/=
   return NAG[11];                     // =
}

function StopBackgroundEngine() {
   if (g_backgroundEngine) {
     g_backgroundEngine.terminate();
     g_backgroundEngine = null;
     document.getElementById("GameAnalysisFlag").innerHTML = "&nbsp;";
     document.getElementById("GameAnalysisFlag").title = "";
   }
}

var analysisTimeout;
function setAnalysisTimeout(seconds) {
   if (analysisTimeout) { clearTimeout(analysisTimeout); }
   analysisTimeout = setTimeout("analysisTimeout = null; StopBackgroundEngine();", seconds * 1000);
}

function StartEngineAnalysis() {
   StopBackgroundEngine();
   if (InitializeBackgroundEngine()) {
      fenString = CurrentFEN();
      g_backgroundEngine.postMessage("position " + fenString);
      g_backgroundEngine.postMessage("analyze");
      setAnalysisTimeout(analysisSeconds);
   }
}


function customFunctionOnPgnTextLoad() {
   if (theObject = document.getElementById("GameAnalysis")) {
      theObject.className = "gameAnalysis";
   }
}

function customFunctionOnMove() {
   if (theObject = document.getElementById("GameFlagToMove")) {
      theObject.style.backgroundColor = CurrentPly % 2 ? "black" : "white";
      // theObject.style.borderColor = CurrentPly % 2 ? "white" : "black";
      theObject.title = (CurrentPly % 2 ? "black" : "white") + " to move";
   }

   if (loadIdle) {
      loadIdle = false;
   } else {
      StartEngineAnalysis();
   }

   if (clickFromCol !== "") {
      highlightSquare("abcdefgh".indexOf(clickFromCol), "12345678".indexOf(clickFromRow), false);
   }
   clickFromCol = "";
   clickFromRow = "";
   clickFromPiece = "";
   lastPromotionMove = lastPromotionPlaceholder;
   lastPromotionPlaceholder = "";

   if (CurrentPly <= StartPly) {
      document.getElementById("btnStart").style.color = "";
      document.getElementById("btnBack").style.color = "";
   }
   if (CurrentPly >= StartPly + PlyNumber) {
      document.getElementById("btnForw").style.color = "";
      document.getElementById("btnEnd").style.color = "";
   }
}

function customDebugInfo() {
   return "engine=" + engineWorker + " analysisSeconds=" + analysisSeconds + " nodesPerSecond=" + num2string(g_nodesPerSecond);
}

function num2string(num) {
   if (num >= Math.pow(10, 9)) { num = Math.floor(num / Math.pow(10, 9)) + "G"; }
   else if (num >= Math.pow(10, 6)) { num = Math.floor(num / Math.pow(10, 6)) + "M"; }
   else if (num >= Math.pow(10, 3)) { num = Math.floor(num / Math.pow(10, 3)) + "K"; }
   else { num = num + ""; }
   return num;
}


var overwrittenPly;
var overwrittenPlyNumber;
function addPly(thisPly) {
   if (!thisPly) { return; }
   if (thisPly !== Moves[CurrentPly]) {
      overwrittenPly = Moves[CurrentPly];
      Moves[CurrentPly] = MovesVar[0][CurrentPly] = thisPly;
      overwrittenPlyNumber = PlyNumber;
      PlyNumber = PlyNumberVar[0] = CurrentPly + 1 - StartPly;
   }
   MoveForward(1);
}

function customFunctionOnAlert(msg) {
   if (msg.indexOf("error: invalid ply") !== 0) { return; }
   stopAlertPrompt();
   if (!overwrittenPly) { return; }
   Moves[CurrentPly] = MovesVar[0][CurrentPly] = overwrittenPly;
   PlyNumber = PlyNumberVar[0] = overwrittenPlyNumber;
   overwrittenPly = "";
}

for (cc=0; cc<8; cc++) { for (rr=0; rr<8; rr++) {
   boardShortcut("ABCDEFGH".charAt(cc) + "12345678".charAt(rr), "", detectClick, false);
} }

var clickFromCol = "";
var clickFromRow = "";
var clickFromPiece = "";
var lastPromotionMove = "";
var lastPromotionPlaceholder = "";
function detectClick(t,e) {
   if (! (matches = t.id.match(/img_tcol([0-7])trow([0-7])/))) { return; }
   thisCol = IsRotated ? 7 - matches[1] : matches[1];
   thisColChar = "abcdefgh".charAt(thisCol);
   thisRow = IsRotated ? matches[2] : 7 - matches[2];
   thisRowChar = "12345678".charAt(thisRow);
   if ((lastPromotionMove !== "") && (lastPromotionMove.charAt(2) == thisColChar) && (lastPromotionMove.charAt(3) == thisRowChar)) {
      thisMove = lastPromotionMove.substr(0,4) + "RBNQ".charAt("QRBN".indexOf(lastPromotionMove.charAt(4)));
      Moves[CurrentPly - 1] = MovesVar[0][CurrentPly - 1] = thisMove;
      MoveBackward(1);
      MoveForward(1);
      lastPromotionMove = thisMove;
   } else if (clickFromCol !== "") {
      setTimeout('highlightSquare("abcdefgh".indexOf("' + clickFromCol + '"), "12345678".indexOf("' + clickFromRow + '"), false);', 77);
      clickToCol = thisColChar;
      clickToRow = thisRowChar;
      if ((clickFromCol !== clickToCol) || (clickFromRow !== clickToRow)) {
         var thisMove = clickFromPiece + clickFromCol + clickFromRow + clickToCol + clickToRow;
         if (thisMove == "Ke1g1") { thisMove = "O-O"; }
         if (thisMove == "Ke1c1") { thisMove = "O-O-O"; }
         if (thisMove == "Ke8g8") { thisMove = "O-O"; }
         if (thisMove == "Ke8c8") { thisMove = "O-O-O"; }
         if (("KQRBN".indexOf(thisMove.charAt(0)) == -1) && (thisMove.charAt(3) == (CurrentPly % 2 ? "1" : "8"))) {
            thisMove += "Q";
            lastPromotionPlaceholder = thisMove;
         }
         addPly(thisMove);
      }
      clickFromCol = clickFromRow = clickFromPiece = "";
   } else {
      cc = CurrentPly % 2;
      for (ii=0; ii<16; ii++) {
         if ((PieceCol[cc][ii] == thisCol) && (PieceRow[cc][ii] == thisRow)) {
            if (PieceType[cc][ii] != -1) {
               clickFromPiece = " KQRBNP".charAt(PieceType[cc][ii]);
               if (clickFromPiece == "P") { clickFromPiece = ""; }
               clickFromCol = thisColChar;
               clickFromRow = thisRowChar;
               setTimeout('highlightSquare(' + thisCol + ', ' + thisRow + ', true);', 77);
            }
         }
      }
      lastPromotionMove = "";
   }
}


function replaceFEN(FEN) {
   document.getElementById("pgnText").innerHTML = '[Setup "1"]\n[FEN "' + FEN + '"]\n';
   firstStart = true;
   start_pgn4web();
}

</script>

</body>

</html>

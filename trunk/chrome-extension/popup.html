<html>
 
<!--
  pgn4web javascript chessboard
  copyright (C) 2009, 2011 Paolo Casaschi
  see README file and http://pgn4web.casaschi.net
  for credits, license and more details
-->
 
<!--
 
HTML, CSS and Javascript code optimized for use as extension
of Google Chrome v6 or later. Don't use with any other browser.
 
-->
 
<head>
 
<style type="text/css">
 
body {
  margin: 2em;
  margin-right: 0;
  background: white; /* fallback */
  background: -webkit-gradient(linear, left top, left bottom, from(#FFFFFF), to(#F0F0F0)); /* chrome 9- */
  background: -webkit-linear-gradient(#FFFFFF, #F0F0F0); /* chrome 10+ */
  color: black;
  font-family: sans-serif;
  white-space: nowrap;
  overflow: hidden;
}
 
.pgnHeader {
  margin-right: 2em;
  font-weight: bold;
}
 
.pgnHeaderLink, .pgnListLink {
  color: black;
  text-decoration: none;
}
 
.measureScrollbar {
  height: 0.5em;
  width: 3em;
  overflow-y: scroll;
  overflow-x: hidden;
  visibility: hidden;
}
 
.measureEm {
  height: 0.5em;
  padding-right: 1em;
}
 
.pgnLinkList {
  line-height: 2em;
  overflow-x: hidden;
  overflow-y: auto;
  scrollbar-base-color: #F0F0F0;
}
 
.pgnListLink {
  margin-right: 0.6em;
}
 
.pgnFileName {
  margin-left: 1em;
}
 
.pgnItem {
}
 
</style>
 
</head>
 
<body>
 
<div id="pgnHeader" class="pgnHeader"></div>
<div id="measureScrollbar" class="measureScrollbar">hidden text to measure scrollbar width</div>
<div id="measureEm" class="measureEm"></div>

<div id="pgnLinkList" class="pgnLinkList"></div>

<script type="text/javascript">
 
var cursorDef = "url(cursor-small.png) 1 6, auto";
 
chrome.tabs.getSelected(null, function(tab){
 
  pgnLinks = chrome.extension.getBackgroundPage().pgnHrefLinks[tab.id];
  pgnLinks = pgnLinks.concat(chrome.extension.getBackgroundPage().pgnWebRequests[tab.id]);
  pgnLinks = pgnLinks.sort();
  
  var headerObject = document.getElementById("pgnHeader");
  var listObject = document.getElementById("pgnLinkList");
  var scrollObject = document.getElementById("measureScrollbar");
  var emObject = document.getElementById("measureEm");

  var em = emObject.offsetWidth;
  var maxLinkListItems = Math.max(1, Math.ceil((0.6 * self.screen.availHeight - 6 * em) / (2 * em)));
  var imgResizeString = 'height="' + em + 'px" width="' + em + 'px" ';

  if (pgnLinks.length > maxLinkListItems) {
    listObject.style.maxHeight = (maxLinkListItems * 2) + "em";
    listObject.style.paddingRight = (2 * em + scrollObject.offsetWidth - scrollObject.clientWidth) + "px"; 
  } else { listObject.style.marginRight = "2em"; }
 
  var pgnHeaderInnerHTML = '<a class="pgnHeaderLink" title="chess games viewer from the pgn4web project" target="_blank" href="http://pgn4web.casaschi.net">Chess games viewer</a>';
  pgnHeaderInnerHTML += ': <span title="the chess games viewer extension detected on this page ' + 
    pgnLinks.length + (pgnLinks.length == 1 ? ' link' : ' links') + ' to chess games in PGN format">' + 
    pgnLinks.length + (pgnLinks.length == 1 ? ' link' : ' links') + ' on this page</span>';
 
  var pgnLinkListInnerHTML = "";
  for(l in pgnLinks) {
    var pgnFileName = pgnLinks[l].replace(/(^|^[^?#]*\/)([^?#\/]+\.pgn)($|\?.*$|#.*$)/i,'$2');
    pgnLinkListInnerHTML += '<div class="pgnItem">' +
      '<a title="view ' + pgnFileName + ' games" class="pgnListLink" href="javascript:void(0);" onmouseover=\'this.style.cursor="' + cursorDef + '";\' onclick=\'chrome.tabs.create({url: "chess-games-viewer.html?pgnData=' + escape(pgnLinks[l]) + '"}); self.close();\'><img ' + imgResizeString + 'src="alpha-16.png"></a>' +
      '<a title="view with live refresh ' + pgnFileName + ' games" class="pgnListLink" href="javascript:void(0);" onmouseover=\'this.style.cursor="' + cursorDef + '";\' onclick=\'chrome.tabs.create({url: "chess-games-viewer.html?pgnData=' + escape(pgnLinks[l]) + '&refreshMinutes=1.0' + Math.floor(Math.random()*10) + '&search=\\\\[\\\\s*Result\\\\s*\\"\\\\*\\"\\\\s*\\\\]"}); self.close();\'><img ' + imgResizeString + 'src="refresh.png"></a>' +
      '<a title="download ' + pgnFileName + ' games" class="pgnListLink" href="javascript:void(0);" onmouseover=\'this.style.cursor="' + cursorDef + '";\' onclick=\'chrome.tabs.update(' + tab.id + ', {url: "' + pgnLinks[l] + '"}); self.close();\'><img ' + imgResizeString + 'src="download.png"></a>' +
      '<span class="pgnFileName" title="' + pgnFileName + '">' + pgnLinks[l] + '</span>' +
      '</div>';
  }
 
  listObject.innerHTML = pgnLinkListInnerHTML;
  headerObject.innerHTML = pgnHeaderInnerHTML;
});
 
</script>
 
</body>
 
</html>

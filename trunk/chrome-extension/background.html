<!--
  pgn4web javascript chessboard
  copyright (C) 2009, 2010 Paolo Casaschi
  see README file and http://pgn4web.casaschi.net
  for credits, license and more details
-->

<script type="text/javascript">

function openRemoteUrl(remoteUrl, live) {
  if (!remoteUrl) { return; }
  var liveParam = live ? '&refreshMinutes=1&search=\\[\\s*Result\\s*"\\*"\\s*\\]' : "";
  url = "chess-games-viewer.html?pgnData=" + remoteUrl + liveParam;
  chrome.tabs.create({url: url});
}

function pgnLinkOnClick(info, tab, live) {
  var remoteUrl = info.linkUrl;
  if (!remoteUrl) { return; }
  if (!remoteUrl.match(/\.pgn$/i)) { return; }
  openRemoteUrl(remoteUrl, live);
}

function pgnPageOnClick(info, tab, live) {
  var promptLabel = "Enter PGN games URL for viewing" + (live ? " with live refresh:" : ":");
  var defaultRemoteUrl = info.selectionText ? info.selectionText.replace(/[\n\r]+/g," ") : "";
  var remoteUrl = prompt(promptLabel, defaultRemoteUrl);
  if (!remoteUrl) { return; }
  if (!remoteUrl.match(/\.pgn$/i)) {
    alert("You entered:\n" + remoteUrl + "\n\nError: only PGN games URL allowed.");
    retrun;
  }
  openRemoteUrl(remoteUrl, live);
}

function pgnviewLinkOnClick(info, tab) {
  pgnLinkOnClick(info, tab, false);
}

function pgnliveLinkOnClick(info, tab) {
  pgnLinkOnClick(info, tab, true);
}

function pgnviewPageOnClick(info, tab) {
  pgnPageOnClick(info, tab, false);
}

function pgnlivePageOnClick(info, tab) {
  pgnPageOnClick(info, tab, true);
}

chrome.contextMenus.create({"title": "View chess games by pgn4web", "contexts": ["link"], targetUrlPatterns:["*://*/*.pgn", "*://*/*.PGN"], "onclick": pgnviewLinkOnClick});
chrome.contextMenus.create({"title": "View chess games with live refresh", "contexts": ["link"], targetUrlPatterns:["*://*/*.pgn", "*://*/*.PGN"], "onclick": pgnliveLinkOnClick});

chrome.contextMenus.create({"title": "Enter PGN games URL for viewing by pgn4web", "contexts": ["page", "selection"], "onclick": pgnviewPageOnClick});
chrome.contextMenus.create({"title": "Enter PGN games URL for viewing with live refresh", "contexts": ["page", "selection"], "onclick": pgnlivePageOnClick});

</script>


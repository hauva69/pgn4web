<!--
  pgn4web javascript chessboard
  copyright (C) 2009, 2010 Paolo Casaschi
  see README file and http://pgn4web.casaschi.net
  for credits, license and more details
-->

<script type="text/javascript">

function pgnOnClick(info, tab, live) {
  var remoteUrl = null;
  var defaultRemoteUrl = info.selectionText ? info.selectionText : "";
  var titleLabel = live ? "live games from " : "games from ";
  var liveParam = live ? "&refreshMinutes=1" : "";

  if (info.linkUrl) {
    remoteUrl = info.linkUrl;
  } else {
    var inputUrl = prompt("Enter PGN games URL for vieweing:", defaultRemoteUrl);
    if (inputUrl) {
      if (inputUrl.match(/\.pgn$/i)) {
        remoteUrl = inputUrl;
      } else {
        alert("You entered:\n" + remoteUrl + "\n\nError: only PGN games URL allowed.");
      }
    }
  }
  if (remoteUrl) { 
    url = "collection-chrome-extension.html?pgnData=" + remoteUrl + "&title=" + titleLabel + remoteUrl + liveParam;
    chrome.tabs.create({url: url});
  }
}

function pgnviewOnClick(info, tab) {
  pgnOnClick(info, tab, false);
}

function pgnliveOnClick(info, tab) {
  pgnOnClick(info, tab, true);
}

chrome.contextMenus.create({"title": "View chess games by pgn4web", "contexts": ["link"], targetUrlPatterns:["*://*/*.pgn", "*://*/*.PGN"], "onclick": pgnviewOnClick});
chrome.contextMenus.create({"title": "View chess games with live refresh", "contexts": ["link"], targetUrlPatterns:["*://*/*.pgn", "*://*/*.PGN"], "onclick": pgnliveOnClick});

chrome.contextMenus.create({"title": "Enter PGN games URL for viewing by pgn4web", "contexts": ["page", "selection"], "onclick": pgnviewOnClick});
chrome.contextMenus.create({"title": "Enter PGN games URL for viewing with live refresh", "contexts": ["page", "selection"], "onclick": pgnliveOnClick});

</script>


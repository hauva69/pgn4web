<html>

<!--
  pgn4web javascript chessboard
  copyright (C) 2009 Paolo Casaschi
  see README file and http://pgn4web.casaschi.net
  for credits, license and more details
-->

<head>

<title>pgn4web chessboard generator</title>

<style type="text/css">

html,
body {
  font-family: sans-serif;
  color: black;
  background: white;
  padding: 10;
}

a {
  text-decoration: none;
  color: black;
}

.helptext {
  color: gray;
}

.input, .textbox {
  border-width: 2;
  border-style: inset;
  border-color: #CCCCCC;
}

.input, .checkbox, .dropdown {
/* if the margin-left value below is changed from 22 
   then the corresponding value at the end of the file needs to be changed accordingly */      
  margin-left: 22;
}

.textbox {
  width: 100%;
}

</style>

<link rel="shortcut icon" href="pawn.ico"></link>

</head>

<body>

<script src="pgn4web.js" type="text/javascript"></script>
<script type="text/javascript" src="jscolor/jscolor.js"></script>

<script type="text/javascript">

// CUSTOMIZATION INSTRUCTIONS
// if you customize the board-generator.html file for your site 
// you probably want to customize the default values

pgnText_default = templatePgnHeader + '\n';
encodePgn_default = "t";
auto_default = "t";
delay_default = 1000;
loop_default = "f";
pieceFont_default = "alpha";
pieceSize_default = 30;
squareSize_default = 40;
lightColorHex_default = "EFF4EC";
darkColorHex_default = "C6CEC3";
boardBorderColorHex_default = "000000";
highlightColorHex_default = "DAF4D7";
showButtons_default = "f";
controlBackgroundColorHex_default = "default";
controlTextColorHex_default = "000000";
textMargin_default = 0;
showHeader_default = "t";
showMoves_default = "t";
horizontalLayout_default = "f";
frameHeight_default = "";
frameWidth_default = "";
framePadding_default = 0;
showComments_default = "t"; 
showCommentsOnSeparateLines_default = "f"; 
fontHeaderColorHex_default = "000000";
fontMovesColorHex_default = "000000";
fontCommentsColorHex_default = "808080";
highlightMoveColorHex_default = "DAF4D7";
fontHeaderSize_default = "100%";
fontMovesSize_default = "100%";
fontCommentsSize_default = "100%";
backgroundColorHex_default = "FFFFFF";
previewBackgroundColorHex_default = "DDDDDD";
baseUrl_default = location.protocol + "//" + location.hostname+location.pathname.substr(0, location.pathname.lastIndexOf("/")) + "/board.html";


// max length of the iframeUrl, if this is exceeded a warning is issued 
iframeUrl_max = 2000;

function set_defaults() {
  document.getElementById('html_code').innerHTML = '';
  document.getElementById('html_code_status').innerHTML = '&nbsp;';
  
  if ((pgnTextEncoded = gup("pgnEncoded")) !== "") {
    pgnText_value = DecodePGN(pgnTextEncoded);
    previousPgnTextToEncode = pgnText_value;
  } else {
    if ((pgnText_value = decodeURIComponent(gup("pgnText"))) === "") { pgnText_value = pgnText_default; }
    previousPgnTextToEncode = "";
  }
  document.getElementById('pgnText').value = pgnText_value;
  update_pgnTextLength();

  if ((encodePgn_value = gup("encodePgn")) === "") { encodePgn_value = encodePgn_default; }
  document.board.encodePgn.checked = (encodePgn_value == "t");

  if ((auto_value = gup("auto")) === "") { auto_value = auto_default; }
  document.board.auto.checked = (auto_value == "t");

  if ((delay_value = gup("delay")) === "") { delay_value = delay_default; }
  document.board.delay.value = delay_value;

  if ((loop_value = gup("loop")) === "") { loop_value = loop_default; }
  document.board.loop.checked = (loop_value == "t");

  if ((pieceFont_value = gup("pieceFont")) === "") { pieceFont_value = pieceFont_default; }
  if (pieceFont_value == "a") { pieceFont_value = "alpha"; }
  if (pieceFont_value == "m") { pieceFont_value = "merida"; }
  if (pieceFont_value == "u") { pieceFont_value = "uscf"; }
  document.board.pieceFont.value = pieceFont_value;
  if (!((pieceFont_value == "alpha") || (pieceFont_value == "merida") || (pieceFont_value == "uscf"))) {
    alert('error: the piece font must me either \'alpha\', \'merida\', \'uscf\' or their initials');
    document.board.pieceFont.value = pieceFont_value = pieceFont_default;
  }

  if ((squareSize_value = gup("squareSize")) === "") { squareSize_value = squareSize_default; }
  document.getElementById('squareSize').value = squareSize_value;
  validate_squareSize();

  if ((pieceSize_value = gup("pieceSize")) === "") { pieceSize_value = pieceSize_default; }
  document.getElementById('pieceSize').value = pieceSize_value;
  validate_pieceSize();

  if ((lightColorHex_value = gup("lightColorHex")) === "") { lightColorHex_value = lightColorHex_default; }
  document.board.lightColorHex.value = lightColorHex_value;
  validate_color(document.board.lightColorHex, 'light squares color', lightColorHex_default);

  if ((darkColorHex_value = gup("darkColorHex")) === "") { darkColorHex_value = darkColorHex_default; }
  document.board.darkColorHex.value = darkColorHex_value;
  validate_color(document.board.darkColorHex, 'dark squares color', darkColorHex_default);

  if ((boardBorderColorHex_value = gup("boardBorderColorHex")) === "") { boardBorderColorHex_value = boardBorderColorHex_default; }
  document.board.boardBorderColorHex.value = boardBorderColorHex_value;
  validate_color(document.board.boardBorderColorHex, 'board border color', boardBorderColorHex_default);

  if ((highlightColorHex_value = gup("highlightColorHex")) === "") { highlightColorHex_value = highlightColorHex_default; }
  document.board.highlightColorHex.value = highlightColorHex_value;
  validate_color_none(document.board.highlightColorHex, 'highlight squares color', highlightColorHex_default);

  if ((showButtons_value = gup("showButtons")) === "") { showButtons_value = showButtons_default; }
  document.board.showButtons.checked = (showButtons_value == "t");

  if ((controlBackgroundColorHex_value = gup("controlBackgroundColorHex")) === "") { controlBackgroundColorHex_value = controlBackgroundColorHex_default; }
  document.board.controlBackgroundColorHex.value = controlBackgroundColorHex_value;
  validate_color_default(document.board.controlBackgroundColorHex, 'control buttons background color', 'default');

  if ((controlTextColorHex_value = gup("controlTextColorHex")) === "") { controlTextColorHex_value = controlTextColorHex_default; }
  document.board.controlTextColorHex.value = controlTextColorHex_value;
  validate_color(document.board.controlTextColorHex, 'control buttons text color', controlTextColorHex_default);

  if ((textMargin_value = gup("textMargin")) === "") { textMargin_value = textMargin_default; }
  document.getElementById('textMargin').value = textMargin_value;
  validate_number(document.getElementById('textMargin'), 'text margin', textMargin_default);

  if ((showHeader_value = gup("showHeader")) === "") { showHeader_value = showHeader_default; }
  document.board.showHeader.checked = (showHeader_value == "t");

  if ((showMoves_value = gup("showMoves")) === "") { showMoves_value = showMoves_default; }
  document.board.showMoves.checked = (showMoves_value == "t");

  if ((showComments_value = gup("showComments")) === "") { showComments_value = showComments_default; }
  document.board.showComments.checked = (showComments_value == "t");

  if ((showCommentsOnSeparateLines_value = gup("showCommentsOnSeparateLines")) === "") { showCommentsOnSeparateLines_value = showCommentsOnSeparateLines_default; }
  document.board.showCommentsOnSeparateLines.checked = (showCommentsOnSeparateLines_value == "t");

  if ((fontHeaderColorHex_value = gup("fontHeaderColorHex")) === "") { fontHeaderColorHex_value = fontHeaderColorHex_default; }
  document.board.fontHeaderColorHex.value = fontHeaderColorHex_value;
  validate_color(document.board.fontHeaderColorHex, 'header font color', fontHeaderColorHex_default);

  if ((fontMovesColorHex_value = gup("fontMovesColorHex")) === "") { fontMovesColorHex_value = fontMovesColorHex_default; }
  document.board.fontMovesColorHex.value = fontMovesColorHex_value;
  validate_color(document.board.fontMovesColorHex, 'moves font color', fontMovesColorHex_default);

  if ((fontCommentsColorHex_value = gup("fontCommentsColorHex")) === "") { fontCommentsColorHex_value = fontCommentsColorHex_default; }
  document.board.fontCommentsColorHex.value = fontCommentsColorHex_value;
  validate_color(document.board.fontCommentsColorHex, 'comments font color', fontCommentsColorHex_default);

  if ((highlightMoveColorHex_value = gup("highlightMoveColorHex")) === "") { highlightMoveColorHex_value = highlightMoveColorHex_default; }
  document.board.highlightMoveColorHex.value = highlightMoveColorHex_value;
  validate_color(document.board.highlightMoveColorHex, 'highlight move color', highlightMoveColorHex_default);

  if ((fontHeaderSize_value = percentFixFromUrl( gup("fontHeaderSize") )) === "") { fontHeaderSize_value = fontHeaderSize_default; }
  document.board.fontHeaderSize.value = fontHeaderSize_value;
  validate_number_percentage(document.board.fontHeaderSize, 'header font size', fontHeaderSize_default);

  if ((fontMovesSize_value = percentFixFromUrl( gup("fontMovesSize") )) === "") { fontMovesSize_value = fontMovesSize_default; }
  document.board.fontMovesSize.value = fontMovesSize_value;
  validate_number_percentage(document.board.fontMovesSize, 'moves font size', fontMovesSize_default);

  if ((fontCommentsSize_value = percentFixFromUrl( gup("fontCommentsSize") )) === "") { fontCommentsSize_value = fontCommentsSize_default; }
  document.board.fontCommentsSize.value = fontCommentsSize_value;
  validate_number_percentage(document.board.fontCommentsSize, 'comments font size', fontCommentsSize_default);

  if ((backgroundColorHex_value = gup("backgroundColorHex")) === "") { backgroundColorHex_value = backgroundColorHex_default; }
  document.board.backgroundColorHex.value = backgroundColorHex_value;
  validate_color(document.board.backgroundColorHex, 'background color', backgroundColorHex_default);

  if ((previewBackgroundColorHex_value = gup("previewBackgroundColorHex")) === "") { previewBackgroundColorHex_value = previewBackgroundColorHex_default; }
  document.board.previewBackgroundColorHex.value = previewBackgroundColorHex_value;
  validate_color(document.board.previewBackgroundColorHex, 'preview background color', previewBackgroundColorHex_default);

  if ((horizontalLayout_value = gup("horizontalLayout")) === "") { horizontalLayout_value = horizontalLayout_default; }
  if (horizontalLayout_value == "t") { document.board.horizontalLayout.value = "t"; }
  else { document.board.horizontalLayout.value = "f"; }

  if ((frameHeight_value = gup("frameHeight")) === "") { frameHeight_value = frameHeight_default; }
  if (frameHeight_value == "b") { frameHeight_value = "board"; }
  document.board.frameHeight.value = frameHeight_value;
  validate_frameHeight();

  if ((frameWidth_value = gup("frameWidth")) === "") { frameWidth_value = frameWidth_default; }
  if (frameWidth_value == "p") { frameWidth_value = "page"; }
  if (frameWidth_value == "b") { frameWidth_value = "board"; }
  document.board.frameWidth.value = frameWidth_value;
  validate_frameWidth();

  if ((framePadding_value = gup("framePadding")) === "") { framePadding_value = framePadding_default; }
  document.board.framePadding.value = framePadding_value;
  validate_number(document.board.framePadding, 'frame padding', framePadding_default);

  if ((baseUrl_value = gup("baseUrl")) === "") { baseUrl_value = baseUrl_default; }
  document.board.baseUrl.value = baseUrl_value;

  generate_html_code();
  update_controls();
}

function reset_form() {
  if (confirm("do you really want to reset the form to the default values?\nAll your options including the PGN text will be lost!")) { set_defaults(); }
}

function update_controls() {
  update_disabled_controls();	
  update_suggested_iframe_dimensions();
}

function update_disabled_controls() {

  document.board.controlBackgroundColorHex.disabled = (!document.board.showButtons.checked);
  document.board.controlTextColorHex.disabled = ((!document.board.showButtons.checked) || (document.board.controlBackgroundColorHex.value == "default"));
  document.board.textMargin.disabled = (!document.board.showMoves.checked && !document.board.showHeader.checked);
  document.board.showComments.disabled = !document.board.showMoves.checked;
  document.board.showCommentsOnSeparateLines.disabled = !document.board.showMoves.checked;
  document.board.fontHeaderColorHex.disabled = !document.board.showHeader.checked;
  document.board.fontMovesColorHex.disabled = !document.board.showMoves.checked;
  document.board.fontCommentsColorHex.disabled = !document.board.showMoves.checked;
  document.board.highlightMoveColorHex.disabled = !document.board.showMoves.checked;
  document.board.fontHeaderSize.disabled = !document.board.showHeader.checked;
  document.board.fontMovesSize.disabled = !document.board.showMoves.checked;
  document.board.fontCommentsSize.disabled = !document.board.showMoves.checked;
}

function update_suggested_iframe_dimensions() {

  boardWidth = 8 * document.board.squareSize.value + 6; 
  estimated_boardHeight = boardWidth; 
  
  if (document.board.showButtons.checked) {
    if (document.board.controlBackgroundColorHex.value != "default") {
      // in this case both control size and control padding grow with squareSize  
      estimated_boardHeight += (20 + 2 * parseInt(document.board.squareSize.value, 10));
    } else {
      // in this case control padding grows with squareSize 
      // while the size of the controls cant be predicted, so a safe number is set
      estimated_boardHeight += 50 + parseInt(document.board.squareSize.value, 10);
    } 
  }

  min_frameWidth = boardWidth + 2 * parseInt(document.board.framePadding.value, 10);
  min_frameHeight = estimated_boardHeight + 2 * parseInt(document.board.framePadding.value, 10);

  if (document.board.horizontalLayout.value == "t") {
    suggested_frameHeight = "board";
    suggested_frameWidth = "page";
    document.getElementById('frameHeight_helpText').innerHTML = "a number or <b>board</b>; min <b>" + min_frameHeight + "</b>; if blank, assigned to <b>" + suggested_frameHeight + "</b>";
    document.getElementById('frameWidth_helpText').innerHTML = "a number or <b>page</b>; min <b>" + min_frameWidth + "</b>; if blank, assigned to <b>" + suggested_frameWidth + "</b>; board width is <b>" + boardWidth + "</b>";
  } else {
    suggested_frameWidth = boardWidth;
    suggested_frameHeight = estimated_boardHeight;
    if (document.board.showHeader.checked) { suggested_frameHeight += Math.max(100, Math.round(0.2 * boardWidth)); }
    if (document.board.showMoves.checked) { suggested_frameHeight += Math.max(300, Math.round(0.8 * boardWidth)); }
    if (document.board.showHeader.checked || document.board.showMoves.checked) {
      suggested_frameWidth = Math.max(400, Math.round(1.5 * boardWidth));
    }
    suggested_frameWidth += 2 * parseInt(document.board.framePadding.value, 10);
    suggested_frameHeight += 2 * parseInt(document.board.framePadding.value, 10);
    document.getElementById('frameHeight_helpText').innerHTML = "a number; min <b>" + min_frameHeight + "</b>; if blank, assigned to <b>" + suggested_frameHeight + "</b>";
    document.getElementById('frameWidth_helpText').innerHTML = "a number or <b>board</b> or <b>page</b>; min <b>" + min_frameWidth + "</b>; if blank, assigned to <b>" + suggested_frameWidth + "</b>; board width is <b>" + boardWidth + "</b>";
  }

  theObject = document.getElementById('frameWidth');
  if (theObject.value !== ""){ 
    if (!theObject.value.match('/^[^0-9]$/')) { 
      if (theObject.value < min_frameWidth) { 
        alert('error: iFrame width too small');
        theObject.value = "";
      }
    } else { alert('error: invalid iFrame width value'); }
  } 
  
  theObject = document.getElementById('frameHeight');
  if (theObject.value !== "") { 
    if (!theObject.value.match('/^[^0-9]$/')) { 
      if (theObject.value < min_frameHeight) { 
        alert('error: iFrame height too small');
        theObject.value = "";
      }
    } else { alert('error: invalid iFrame height value'); }
  }

}

function update_pgnTextLength() {
 document.getElementById('pgnTextLength').innerHTML = "&nbsp;&nbsp;&nbsp;" + document.getElementById('pgnText').value.length + "p";
}

function calculate_html_code() {

  // this must be the firts item
  baseUrl_value = document.board.baseUrl.value;
  iframeUrl = baseUrl_value + "?";

  if (document.board.auto.checked) { auto_value = "t"; } else { auto_value = "f"; }
  delay_value = parseInt(document.board.delay.value, 10);
  if (document.board.loop.checked) { loop_value = "t"; } else { loop_value = "f"; }
  iframeUrl += "&a=" + auto_value + "&d=" + delay_value + "&l=" + loop_value;

  pieceFont_value = document.board.pieceFont.value;
  pieceSize_value = parseInt(document.board.pieceSize.value, 10);
  squareSize_value = parseInt(document.board.squareSize.value, 10);
  if (pieceSize_value > squareSize_value) { alert("error: the piece size (" + pieceSize_value + ") can not be bigger than the square size (" + squareSize_value + ")"); }
  iframeUrl += "&pf=" + pieceFont_value.charAt(0) + "&ps=" + pieceSize_value + "&ss=" + squareSize_value;

  lightColorHex_value = document.board.lightColorHex.value; 
  darkColorHex_value = document.board.darkColorHex.value; 
  boardBorderColorHex_value = document.board.boardBorderColorHex.value; 
  highlightColorHex_value = document.board.highlightColorHex.value; 
  iframeUrl += "&lch=" + lightColorHex_value + "&dch=" + darkColorHex_value + "&bbch=" + boardBorderColorHex_value + "&hch=" + highlightColorHex_value;

  if (document.board.showButtons.checked) { showButtons_value = "t"; } else { showButtons_value = "f"; }
  iframeUrl += "&sb=" + showButtons_value;

  if ((document.board.showButtons.checked) && (document.board.controlBackgroundColorHex.value != "default")) {
    controlBackgroundColorHex_value = document.board.controlBackgroundColorHex.value; 
    controlTextColorHex_value = document.board.controlTextColorHex.value;
    iframeUrl += "&cbch=" + controlBackgroundColorHex_value + "&ctch=" + controlTextColorHex_value;
  }

  if (document.board.showHeader.checked) { showHeader_value = "t"; } else { showHeader_value = "f"; }
  if (document.board.showMoves.checked) { showMoves_value = "t"; } else { showMoves_value = "f"; }
  iframeUrl += "&sh=" + showHeader_value + "&sm=" + showMoves_value;

  if (document.board.showHeader.checked || document.board.showMoves.checked) {
    textMargin_value = parseInt(document.board.textMargin.value, 10);
    iframeUrl += "&tm=" + textMargin_value;
  }

  if (document.board.showHeader.checked) {
		  
    fontHeaderColorHex_value =  document.board.fontHeaderColorHex.value;
    iframeUrl += "&fhch=" + fontHeaderColorHex_value;

    fontHeaderSize_value = document.board.fontHeaderSize.value;
    iframeUrl += "&fhs=" + percentFixForUrl( fontHeaderSize_value );

  }
		  
  if (document.board.showMoves.checked) {

    fontMovesColorHex_value =  document.board.fontMovesColorHex.value;
    fontCommentsColorHex_value =  document.board.fontCommentsColorHex.value;
    highlightMoveColorHex_value =  document.board.highlightMoveColorHex.value;
    iframeUrl += "&fmch=" + fontMovesColorHex_value + "&fcch=" + fontCommentsColorHex_value + "&hmch=" + highlightMoveColorHex_value;

    fontMovesSize_value = document.board.fontMovesSize.value;
    fontCommentsSize_value = document.board.fontCommentsSize.value;
    iframeUrl += "&fms=" + percentFixForUrl( fontMovesSize_value ) + "&fcs=" + percentFixForUrl( fontCommentsSize_value );

    if (document.board.showComments.checked) { showComments_value = "t"; } else { showComments_value = "f"; } 
    if (document.board.showCommentsOnSeparateLines.checked) { showCommentsOnSeparateLines_value = "t"; } else { showCommentsOnSeparateLines_value = "f"; }
    iframeUrl += "&sc=" + showComments_value + "&scosl=" + showCommentsOnSeparateLines_value;

  } 

  backgroundColorHex_value = document.board.backgroundColorHex.value;
  iframeUrl += "&bch=" + backgroundColorHex_value;

  // this does not go in the iframe
  previewBackgroundColorHex_value = document.board.previewBackgroundColorHex.value;

  framePadding_value = parseInt(document.board.framePadding.value, 10);
  iframeUrl += "&fp=" + framePadding_value;

  horizontalLayout_value = document.board.horizontalLayout.value;
  iframeUrl += "&hl=" + horizontalLayout_value;

  update_suggested_iframe_dimensions();
  if ((frameHeight_value = document.board.frameHeight.value) === "") { frameHeight_value = suggested_frameHeight; }
  if ((frameWidth_value = document.board.frameWidth.value) === "") { frameWidth_value = suggested_frameWidth; }

  if (frameHeight_value == "board") { 
    iframeUrl += "&fh=" + frameHeight_value.charAt(0); 
  } else {
    iframeUrl += "&fh=" + frameHeight_value;
  }
  if ((frameWidth_value == "page") || (frameWidth_value == "board")) { 
    iframeUrl += "&fw=" + frameWidth_value.charAt(0); 
  } else {
    iframeUrl += "&fw=" + frameWidth_value;
  }

  // better to keep this as last item
  pgnText_value = document.getElementById('pgnText').value;
  if ((document.board.encodePgn.checked) && (pgnText_value != previousPgnTextToEncode)) {
    previousPgnTextToEncode = pgnText_value;
    pgnTextEncoded = EncodePGN(pgnText_value);
  }
  if (document.board.encodePgn.checked) { iframeUrl += "&pe=" + pgnTextEncoded; }
  else { iframeUrl += "&pt=" + pgnTextFixForUrl(pgnText_value); }

  // every parameter had an &xxx= format,now we need to remove the first &
  iframeUrl = iframeUrl.replace(/\?&/,"?");
}

function pgnTextFixForUrl( text ) {

  // escaped lines starting with % are removed till end of line
  text = text.replace(/^%.*$/mg,"");
  // we need everything on a single line, please note this breaks the ";" comment detection leading to threat everything after a ";" as comment
  text = text.replace(/\s/g," ");

  // some chars dont work well in URLs
  text = text.replace(/%/g,"%25");
  text = text.replace(/#/g,"%23");
  text = text.replace(/&/g,"%26");
  text = text.replace(/\?/g,"%3F");

  // the "'" char is used in the iframe statement
  text = text.replace(/'/g,"%27");

  return text;
}

function percentFixForUrl( text ) {
  text += ''; // makes sure text is a string
  return text.replace(/%$/,'pct');
}

function percentFixFromUrl( text ) {
  text += ''; // makes sure text is a string
  return text.replace(/pct$/,'%');
}

function generate_html_code() {

  calculate_html_code();

  switch (frameWidth_value) {
    case "board":
      outerFrameWidth = min_frameWidth;
      break;
    case "page":
      outerFrameWidth = "100%";
      break;
    default:
      outerFrameWidth = frameWidth_value;
      break;
  }

  switch (frameHeight_value) {
    case "board":
      outerFrameHeight = min_frameHeight;
      break;
    default:
      outerFrameHeight = frameHeight_value;
      break;
  }

  html_code_string = "<iframe \n\theight='" + outerFrameHeight + "' width='" + outerFrameWidth + "' frameborder='0' scrolling='no' marginheight='0' marginwidth='0'\n\tsrc='" + iframeUrl + "'\n>\n\tyour web browser and/or your host do not support iframes as required to display the chessboard\n</iframe>";
  
  document.getElementById('html_code').value = html_code_string;

  document.getElementById('preview').innerHTML = "<table border='0' bgcolor='#" + previewBackgroundColorHex_value + "' width='100%' cellpadding='25'><tr><td align='center' valign='middle'> " + html_code_string + "</td></tr></table>";

  html_code_status_string = "<table width='100%' cellspacing='0' cellpadding='0'><tr><td align='left' valign='top'>";
  if (iframeUrl.length <= iframeUrl_max) {
    html_code_status_string += "<span class='helptext'>HTML code ready to cut and paste in your web page or blog</span>";
  } else {
    html_code_status_string += "<span style='color: red'>URL (" + iframeUrl.length + " chars) is longer than " + iframeUrl_max + " chars and might be rejected by some web browser/server, try shortening your PGN data</span>";
  }  
  html_code_status_string += "</td><td align=right valign=top>";
  html_code_status_string += "<span class='helptext'>&nbsp;&nbsp;&nbsp;" + document.getElementById('pgnText').value.length + "p";
  if (document.board.encodePgn.checked) { html_code_status_string += "&nbsp;" + pgnTextEncoded.length + "e"; } 
  html_code_status_string += "&nbsp;" + iframeUrl.length + "u</span>";

  html_code_status_string += "</td></tr></table>";
  document.getElementById('html_code_status').innerHTML = html_code_status_string;

  if (firstLoad) { firstLoad = false; return; }
  if (iframeUrl.length <= iframeUrl_max) { location.href='#game_preview'; return; }
  location.href='#generate'; return;
}

function validate_color(object, name, def) {
  if (object.value.match(/^[0-9A-Fa-f]{6}$/)) {
    object.value = object.value.toUpperCase();
    return true;
  } else { 
    alert('error: the ' + name + ' must be a six digits hexadecimal color code, like FF0000');
    object.value = def;
    return false;    
  }
}

function validate_color_default(object, name, def) {
  if (object.value == 'default') { return true; }
  else if (object.value.match(/^[0-9A-Fa-f]{6}$/)) {
    object.value = object.value.toUpperCase();
    return true;
  } else { 
    alert('error: the ' + name + ' must be \'default\' or a six digits hexadecimal color code, like FF0000');
    object.value = def;
    return false;    
  }
}

function validate_color_none(object, name, def) {
  if (object.value == 'none') { return true; }
  else if (object.value.match(/^[0-9A-Fa-f]{6}$/)) {
    object.value = object.value.toUpperCase();
    return true;
  } else { 
    alert('error: the ' + name + ' must be \'none\' or a six digits hexadecimal color code, like FF0000');
    object.value = def;
    return false;    
  }
}

function validate_number(object, name, def) {
  if (!(vv = object.value.match(/^([0-9]+)(px$|$)/))) {
    alert('error: the ' + name + ' must be a non negative number');
    object.value = def;
    return false;    
  } else { 
    object.value = vv[1];
    return true; 
  }
}

function validate_number_blank(object, name, def) {
  if (object.value === "") { return true; }
  if (!(vv = object.value.match(/^([0-9]+)(px$|$)/))) {
    alert('error: the ' + name + ' must be blank or a non negative number');
    object.value = def;
    return false;    
  } else { 
    object.value = vv[1];
    return true; 
  }
}

function validate_number_percentage(object, name, def) {
  if (!(vv = object.value.match(/^([0-9]+)(%$|pct$|px$|$)/))) {
    alert('error: the ' + name + ' must be a non negative number or percentage');
    object.value = def;
    return false;    
  } else {
    if (vv[2] == "px") { object.value = vv[1]; }
    return true;
  }
}

function validate_number_percentage_blank(object, name, def) {
  if (object.value === "") { return true; }
  if (!(vv = object.value.match(/^([0-9]+)(%$|pct$|px$|$)/))) {
    alert('error: the ' + name + ' must be blank or a non negative number or percentage');
    object.value = def;
    return false;    
  } else { 
    if (vv[2] == "px") { object.value = vv[1]; }
    return true; 
  }
}

function validate_frameWidth() {
  object = document.getElementById('frameWidth');
  if (object.value === '') { return true; }
  if ((object.value == 'board') && (document.getElementById('horizontalLayout').value == "f")) { return true; }
  if (object.value == 'page') { return true; }
  if (!(vv = object.value.match(/^([0-9]+)(px$|$)/))) {
    if (document.getElementById('horizontalLayout').value == "t") {
      alert('error: in the horizontal layout the iFrame width must be a non negative number or \'page\'');
    } else {
      alert('error: in the vertical layout the iFrame width must be a non negative number, \'board\' or \'page\'');
    }
    object.value = "";
    return false;    
  } else { 
    object.value = vv[1];
    return true; 
  }
}

function validate_frameHeight() {
  object = document.getElementById('frameHeight');
  if (object.value === '') { return true; }
  if ((object.value == 'board') && (document.getElementById('horizontalLayout').value == "t")){ return true; }
  if (!(vv = object.value.match(/^([0-9]+)(px$|$)/))) {
    if (document.getElementById('horizontalLayout').value == "t") { 
      alert('error: in the horizontal layout the iFrame height must be a non negative number or \'board\'');
    } else {
      alert('error: in the vertical layout the iFrame height must be a non negative number');
    }
    object.value = "";
    return false;    
  } else { 
    object.value = vv[1];
    return true; 
  }
}

function validate_pieceSize() {
  if (document.getElementById('squareSize').value < document.getElementById('pieceSize').value) {
    alert('error: piece size must be no bigger than the square size');
    document.getElementById('pieceSize').value = 20;
    return false;
  } else { return true; }
}

function validate_squareSize() {
  if (!validate_number(document.getElementById('squareSize'), 'square size', document.getElementById('pieceSize').value)) {
    return false;
  } else if (document.getElementById('squareSize').value < document.getElementById('pieceSize').value) {
    alert('error: square size must be at least as big as the piece size');
    document.getElementById('squareSize').value = document.getElementById('pieceSize').value;
    return false;
  } else { return true; }
}

var encodingCharSet = "$0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_";
var encodingVersion = 1;
// version 1 of PGN encoding:
//   encodedPGN = nnn$xxx0
//   nnn = number representing bytes length of the decoded message
//   $ = dollar char (delimiter for length info)
//   xxx = encoded text (using LetterCodes below)
//   0 = zero char (version marker)

function BitsToBytes(i) {
  o = 0;
  if (i.charAt(0) == '1') { o += 32; }
  if (i.charAt(1) == '1') { o += 16; }
  if (i.charAt(2) == '1') { o +=  8; }
  if (i.charAt(3) == '1') { o +=  4; }
  if (i.charAt(4) == '1') { o +=  2; }
  if (i.charAt(5) == '1') { o +=  1; }
  return encodingCharSet.charAt(o);
}

function EncodePGN(ov) {

  var LetterCodes = new Array(256);
  LetterCodes[0]   = '00111111111111110';
  LetterCodes[1]   = '0101101';
  LetterCodes[2]   = '00111111111111111';
  LetterCodes[3]   = '00111111111111100';
  LetterCodes[4]   = '00111111111111101';
  LetterCodes[5]   = '000011111111111010';
  LetterCodes[6]   = '000011111111111011';
  LetterCodes[7]   = '000011111111111000';
  LetterCodes[8]   = '000011111111111001';
  LetterCodes[9]   = '000011111111111110';
  LetterCodes[10]  = '0101100';
  LetterCodes[11]  = '000011111111111111';
  LetterCodes[12]  = '000011111111111100';
  LetterCodes[13]  = '0011100';
  LetterCodes[14]  = '000011111111111101';
  LetterCodes[15]  = '000011111111110010';
  LetterCodes[16]  = '000011111111110011';
  LetterCodes[17]  = '000011111111110000';
  LetterCodes[18]  = '000011111111110001';
  LetterCodes[19]  = '000011111111110110';
  LetterCodes[20]  = '000011111111110111';
  LetterCodes[21]  = '000011111111110100';
  LetterCodes[22]  = '000011111111110101';
  LetterCodes[23]  = '1111111111110101010';
  LetterCodes[24]  = '1111111111110101011';
  LetterCodes[25]  = '1111111111110101000';
  LetterCodes[26]  = '1111111111110101001';
  LetterCodes[27]  = '1111111111110101110';
  LetterCodes[28]  = '1111111111110101111';
  LetterCodes[29]  = '1111111111110101100';
  LetterCodes[30]  = '1111111111110101101';
  LetterCodes[31]  = '1111111111110100010';
  LetterCodes[32]  = '1000';
  LetterCodes[33]  = '101111111110';
  LetterCodes[34]  = '00010';
  LetterCodes[35]  = '11111111110';
  LetterCodes[36]  = '0011111111110';
  LetterCodes[37]  = '1011111111110';
  LetterCodes[38]  = '00001111111110';
  LetterCodes[39]  = '00111111110';
  LetterCodes[40]  = '0011101';
  LetterCodes[41]  = '111111110';
  LetterCodes[42]  = '11001111111110';
  LetterCodes[43]  = '1111110';
  LetterCodes[44]  = '000011110';
  LetterCodes[45]  = '0011110';
  LetterCodes[46]  = '00000';
  LetterCodes[47]  = '0110110';
  LetterCodes[48]  = '010100';
  LetterCodes[49]  = '00110';
  LetterCodes[50]  = '01000';
  LetterCodes[51]  = '01100';
  LetterCodes[52]  = '11000';
  LetterCodes[53]  = '11010';
  LetterCodes[54]  = '11100';
  LetterCodes[55]  = '001010';
  LetterCodes[56]  = '011100';
  LetterCodes[57]  = '0001110';
  LetterCodes[58]  = '001111111110';
  LetterCodes[59]  = '1111111111100';
  LetterCodes[60]  = '10111111110';
  LetterCodes[61]  = '1100110100';
  LetterCodes[62]  = '000011111110';
  LetterCodes[63]  = '00011110';
  LetterCodes[64]  = '1100111111110';
  LetterCodes[65]  = '110011100';
  LetterCodes[66]  = '000010';
  LetterCodes[67]  = '10111110';
  LetterCodes[68]  = '00111110';
  LetterCodes[69]  = '0010110';
  LetterCodes[70]  = '110011101';
  LetterCodes[71]  = '110011110';
  LetterCodes[72]  = '1100110101';
  LetterCodes[73]  = '0010111110';
  LetterCodes[74]  = '11001111110';
  LetterCodes[75]  = '101110';
  LetterCodes[76]  = '1100111110';
  LetterCodes[77]  = '101111110';
  LetterCodes[78]  = '000110';
  LetterCodes[79]  = '0101110';
  LetterCodes[80]  = '1011110';
  LetterCodes[81]  = '011101';
  LetterCodes[82]  = '11101';
  LetterCodes[83]  = '11001100';
  LetterCodes[84]  = '001111110';
  LetterCodes[85]  = '0000111110';
  LetterCodes[86]  = '1111111110';
  LetterCodes[87]  = '11111110';
  LetterCodes[88]  = '110011111110';
  LetterCodes[89]  = '0000111111110';
  LetterCodes[90]  = '1011111110';
  LetterCodes[91]  = '10010';
  LetterCodes[92]  = '00111111111110';
  LetterCodes[93]  = '10011';
  LetterCodes[94]  = '11001111111111';
  LetterCodes[95]  = '11111111111010';
  LetterCodes[96]  = '10111111111110';
  LetterCodes[97]  = '11110';
  LetterCodes[98]  = '011010';
  LetterCodes[99]  = '10100';
  LetterCodes[100] = '11011';
  LetterCodes[101] = '00100';
  LetterCodes[102] = '010010';
  LetterCodes[103] = '010011';
  LetterCodes[104] = '011110';
  LetterCodes[105] = '0000110';
  LetterCodes[106] = '00001111110';
  LetterCodes[107] = '00001110';
  LetterCodes[108] = '110010';
  LetterCodes[109] = '000111110';
  LetterCodes[110] = '010101';
  LetterCodes[111] = '111110';
  LetterCodes[112] = '0110111';
  LetterCodes[113] = '1100110110';
  LetterCodes[114] = '0111110';
  LetterCodes[115] = '0111111';
  LetterCodes[116] = '10110';
  LetterCodes[117] = '0101111';
  LetterCodes[118] = '00101110';
  LetterCodes[119] = '000111111';
  LetterCodes[120] = '10101';
  LetterCodes[121] = '001011110';
  LetterCodes[122] = '1100110111';
  LetterCodes[123] = '0010111111';
  LetterCodes[124] = '001111111111110';
  LetterCodes[125] = '0011111110';
  LetterCodes[126] = '111111111110110';
  LetterCodes[127] = '1111111111110100011';
  LetterCodes[128] = '1111111111110100000';
  LetterCodes[129] = '1111111111110100001';
  LetterCodes[130] = '1111111111110100110';
  LetterCodes[131] = '1111111111110100111';
  LetterCodes[132] = '1111111111110100100';
  LetterCodes[133] = '1111111111110100101';
  LetterCodes[134] = '1111111111110111010';
  LetterCodes[135] = '1111111111110111011';
  LetterCodes[136] = '1111111111110111000';
  LetterCodes[137] = '1111111111110111001';
  LetterCodes[138] = '1111111111110111110';
  LetterCodes[139] = '1111111111110111111';
  LetterCodes[140] = '1111111111110111100';
  LetterCodes[141] = '1111111111110111101';
  LetterCodes[142] = '1111111111110110010';
  LetterCodes[143] = '1111111111110110011';
  LetterCodes[144] = '1111111111110110000';
  LetterCodes[145] = '1111111111110110001';
  LetterCodes[146] = '1111111111110110110';
  LetterCodes[147] = '1111111111110110111';
  LetterCodes[148] = '1111111111110110100';
  LetterCodes[149] = '1111111111110110101';
  LetterCodes[150] = '1111111111110001010';
  LetterCodes[151] = '1111111111110001011';
  LetterCodes[152] = '1111111111110001000';
  LetterCodes[153] = '1111111111110001001';
  LetterCodes[154] = '1111111111110001110';
  LetterCodes[155] = '1111111111110001111';
  LetterCodes[156] = '1111111111110001100';
  LetterCodes[157] = '1111111111110001101';
  LetterCodes[158] = '1111111111110000010';
  LetterCodes[159] = '1111111111110000011';
  LetterCodes[160] = '1111111111110000000';
  LetterCodes[161] = '1111111111110000001';
  LetterCodes[162] = '1111111111110000110';
  LetterCodes[163] = '1111111111110000111';
  LetterCodes[164] = '1111111111110000100';
  LetterCodes[165] = '1111111111110000101';
  LetterCodes[166] = '1111111111110011010';
  LetterCodes[167] = '1111111111110011011';
  LetterCodes[168] = '1111111111110011000';
  LetterCodes[169] = '1111111111110011001';
  LetterCodes[170] = '1111111111110011110';
  LetterCodes[171] = '1111111111110011111';
  LetterCodes[172] = '1111111111110011100';
  LetterCodes[173] = '1111111111110011101';
  LetterCodes[174] = '1111111111110010010';
  LetterCodes[175] = '1111111111110010011';
  LetterCodes[176] = '1111111111110010000';
  LetterCodes[177] = '1111111111110010001';
  LetterCodes[178] = '1111111111110010110';
  LetterCodes[179] = '1111111111110010111';
  LetterCodes[180] = '1111111111110010100';
  LetterCodes[181] = '1111111111110010101';
  LetterCodes[182] = '1111111111111101010';
  LetterCodes[183] = '1111111111111101011';
  LetterCodes[184] = '1111111111111101000';
  LetterCodes[185] = '1111111111111101001';
  LetterCodes[186] = '1111111111111101110';
  LetterCodes[187] = '1111111111111101111';
  LetterCodes[188] = '1111111111111101100';
  LetterCodes[189] = '1111111111111101101';
  LetterCodes[190] = '1111111111111100010';
  LetterCodes[191] = '1111111111111100011';
  LetterCodes[192] = '1111111111111100000';
  LetterCodes[193] = '1111111111111100001';
  LetterCodes[194] = '1111111111111100110';
  LetterCodes[195] = '1111111111111100111';
  LetterCodes[196] = '1111111111111100100';
  LetterCodes[197] = '1111111111111100101';
  LetterCodes[198] = '1111111111111111010';
  LetterCodes[199] = '1111111111111111011';
  LetterCodes[200] = '1111111111111111000';
  LetterCodes[201] = '1111111111111111001';
  LetterCodes[202] = '1111111111111111110';
  LetterCodes[203] = '1111111111111111111';
  LetterCodes[204] = '1111111111111111100';
  LetterCodes[205] = '1111111111111111101';
  LetterCodes[206] = '1111111111111110010';
  LetterCodes[207] = '1111111111111110011';
  LetterCodes[208] = '1111111111111110000';
  LetterCodes[209] = '1111111111111110001';
  LetterCodes[210] = '1111111111111110110';
  LetterCodes[211] = '1111111111111110111';
  LetterCodes[212] = '1111111111111110100';
  LetterCodes[213] = '1111111111111110101';
  LetterCodes[214] = '1111111111111001010';
  LetterCodes[215] = '1111111111111001011';
  LetterCodes[216] = '1111111111111001000';
  LetterCodes[217] = '1111111111111001001';
  LetterCodes[218] = '1111111111111001110';
  LetterCodes[219] = '1111111111111001111';
  LetterCodes[220] = '1111111111111001100';
  LetterCodes[221] = '1111111111111001101';
  LetterCodes[222] = '1111111111111000010';
  LetterCodes[223] = '1111111111111000011';
  LetterCodes[224] = '1111111111111000000';
  LetterCodes[225] = '1111111111111000001';
  LetterCodes[226] = '1111111111111000110';
  LetterCodes[227] = '1111111111111000111';
  LetterCodes[228] = '1111111111111000100';
  LetterCodes[229] = '1111111111111000101';
  LetterCodes[230] = '1111111111111011010';
  LetterCodes[231] = '1111111111111011011';
  LetterCodes[232] = '1111111111111011000';
  LetterCodes[233] = '1111111111111011001';
  LetterCodes[234] = '1111111111111011110';
  LetterCodes[235] = '1111111111111011111';
  LetterCodes[236] = '1111111111111011100';
  LetterCodes[237] = '1111111111111011101';
  LetterCodes[238] = '1111111111111010010';
  LetterCodes[239] = '1111111111111010011';
  LetterCodes[240] = '1111111111111010000';
  LetterCodes[241] = '1111111111111010001';
  LetterCodes[242] = '1111111111111010110';
  LetterCodes[243] = '1111111111111010111';
  LetterCodes[244] = '1111111111111010100';
  LetterCodes[245] = '1111111111111010101';
  LetterCodes[246] = '10111111111111010';
  LetterCodes[247] = '10111111111111011';
  LetterCodes[248] = '10111111111111000';
  LetterCodes[249] = '10111111111111001';
  LetterCodes[250] = '10111111111111110';
  LetterCodes[251] = '10111111111111111';
  LetterCodes[252] = '10111111111111100';
  LetterCodes[253] = '10111111111111101';
  LetterCodes[254] = '1111111111101110';
  LetterCodes[255] = '1111111111101111'; 

  // Build resulting data stream
  // The bits string could get very large
  bits = "";
  bytes = ov.length + "$";
  for (i = 0; i < ov.length; i ++) {
    bits += LetterCodes[ov.charCodeAt(i)];
    while (bits.length > 5) {
      bytes += BitsToBytes(bits);
      bits = bits.slice(6, bits.length);
    }
  }
  bytes += BitsToBytes(bits);

  bytes += encodingCharSet.charAt(encodingVersion);

  return bytes;
}

function DecodePGN(bytes) {

  if (bytes.charAt(bytes.length - 1) != encodingCharSet.charAt(encodingVersion)) {
    alert("ERROR: PGN encoding version mismatch (e:" + 
           bytes.charAt(bytes.length - 1) + " d:" + encodingCharSet.charAt(encodingVersion) + ")");
  } else {
    bytes.length--;
  }

  originalLength = parseInt(bytes.match(/^[0-9]*/), 10);
  bytes = bytes.replace(/^[0-9]*\$/,"");

  l = new Array();
  l[0] = -146;
  l[1] = -111;
  l[2] = -66;
  l[3] = -55;
  l[4] = -6;
  l[5] = 46;
  l[6] = -8;
  l[7] = 66;
  l[8] = -10;
  l[9] = 105;
  l[10] = -12;
  l[11] = 107;
  l[12] = -14;
  l[13] = 44;
  l[14] = -16;
  l[15] = 85;
  l[16] = -18;
  l[17] = 106;
  l[18] = -20;
  l[19] = 62;
  l[20] = -22;
  l[21] = 89;
  l[22] = -24;
  l[23] = 38;
  l[24] = -40;
  l[25] = -33;
  l[26] = -30;
  l[27] = -29;
  l[28] = 17;
  l[29] = 18;
  l[30] = -32;
  l[31] = 15;
  l[32] = 16;
  l[33] = -37;
  l[34] = -36;
  l[35] = 21;
  l[36] = 22;
  l[37] = -39;
  l[38] = 19;
  l[39] = 20;
  l[40] = -48;
  l[41] = -45;
  l[42] = -44;
  l[43] = 7;
  l[44] = 8;
  l[45] = -47;
  l[46] = 5;
  l[47] = 6;
  l[48] = -52;
  l[49] = -51;
  l[50] = 12;
  l[51] = 14;
  l[52] = -54;
  l[53] = 9;
  l[54] = 11;
  l[55] = -57;
  l[56] = 34;
  l[57] = -59;
  l[58] = 78;
  l[59] = -61;
  l[60] = 57;
  l[61] = -63;
  l[62] = 63;
  l[63] = -65;
  l[64] = 109;
  l[65] = 119;
  l[66] = -80;
  l[67] = -69;
  l[68] = 101;
  l[69] = -71;
  l[70] = 55;
  l[71] = -73;
  l[72] = 69;
  l[73] = -75;
  l[74] = 118;
  l[75] = -77;
  l[76] = 121;
  l[77] = -79;
  l[78] = 73;
  l[79] = 123;
  l[80] = -82;
  l[81] = 49;
  l[82] = -86;
  l[83] = -85;
  l[84] = 13;
  l[85] = 40;
  l[86] = -88;
  l[87] = 45;
  l[88] = -90;
  l[89] = 68;
  l[90] = -92;
  l[91] = 84;
  l[92] = -94;
  l[93] = 125;
  l[94] = -96;
  l[95] = 39;
  l[96] = -98;
  l[97] = 58;
  l[98] = -100;
  l[99] = 36;
  l[100] = -102;
  l[101] = 92;
  l[102] = -104;
  l[103] = 124;
  l[104] = -108;
  l[105] = -107;
  l[106] = 3;
  l[107] = 4;
  l[108] = -110;
  l[109] = 0;
  l[110] = 2;
  l[111] = -129;
  l[112] = -118;
  l[113] = -115;
  l[114] = 50;
  l[115] = -117;
  l[116] = 102;
  l[117] = 103;
  l[118] = -122;
  l[119] = -121;
  l[120] = 48;
  l[121] = 110;
  l[122] = -126;
  l[123] = -125;
  l[124] = 10;
  l[125] = 1;
  l[126] = -128;
  l[127] = 79;
  l[128] = 117;
  l[129] = -137;
  l[130] = -132;
  l[131] = 51;
  l[132] = -134;
  l[133] = 98;
  l[134] = -136;
  l[135] = 47;
  l[136] = 112;
  l[137] = -141;
  l[138] = -140;
  l[139] = 56;
  l[140] = 81;
  l[141] = -143;
  l[142] = 104;
  l[143] = -145;
  l[144] = 114;
  l[145] = 115;
  l[146] = -192;
  l[147] = -153;
  l[148] = -150;
  l[149] = 32;
  l[150] = -152;
  l[151] = 91;
  l[152] = 93;
  l[153] = -157;
  l[154] = -156;
  l[155] = 99;
  l[156] = 120;
  l[157] = -159;
  l[158] = 116;
  l[159] = -161;
  l[160] = 75;
  l[161] = -163;
  l[162] = 80;
  l[163] = -165;
  l[164] = 67;
  l[165] = -167;
  l[166] = 77;
  l[167] = -169;
  l[168] = 90;
  l[169] = -171;
  l[170] = 60;
  l[171] = -173;
  l[172] = 33;
  l[173] = -175;
  l[174] = 37;
  l[175] = -177;
  l[176] = 96;
  l[177] = -185;
  l[178] = -182;
  l[179] = -181;
  l[180] = 248;
  l[181] = 249;
  l[182] = -184;
  l[183] = 246;
  l[184] = 247;
  l[185] = -189;
  l[186] = -188;
  l[187] = 252;
  l[188] = 253;
  l[189] = -191;
  l[190] = 250;
  l[191] = 251;
  l[192] = -228;
  l[193] = -225;
  l[194] = -196;
  l[195] = 52;
  l[196] = -198;
  l[197] = 108;
  l[198] = -208;
  l[199] = -201;
  l[200] = 83;
  l[201] = -205;
  l[202] = -204;
  l[203] = 61;
  l[204] = 72;
  l[205] = -207;
  l[206] = 113;
  l[207] = 122;
  l[208] = -212;
  l[209] = -211;
  l[210] = 65;
  l[211] = 70;
  l[212] = -214;
  l[213] = 71;
  l[214] = -216;
  l[215] = 76;
  l[216] = -218;
  l[217] = 74;
  l[218] = -220;
  l[219] = 88;
  l[220] = -222;
  l[221] = 64;
  l[222] = -224;
  l[223] = 42;
  l[224] = 94;
  l[225] = -227;
  l[226] = 53;
  l[227] = 100;
  l[228] = -232;
  l[229] = -231;
  l[230] = 54;
  l[231] = 82;
  l[232] = -234;
  l[233] = 97;
  l[234] = -236;
  l[235] = 111;
  l[236] = -238;
  l[237] = 43;
  l[238] = -240;
  l[239] = 87;
  l[240] = -242;
  l[241] = 41;
  l[242] = -244;
  l[243] = 86;
  l[244] = -246;
  l[245] = 35;
  l[246] = -256;
  l[247] = -249;
  l[248] = 59;
  l[249] = -251;
  l[250] = 95;
  l[251] = -253;
  l[252] = 126;
  l[253] = -255;
  l[254] = 254;
  l[255] = 255;
  l[256] = -384;
  l[257] = -321;
  l[258] = -290;
  l[259] = -275;
  l[260] = -268;
  l[261] = -265;
  l[262] = -264;
  l[263] = 160;
  l[264] = 161;
  l[265] = -267;
  l[266] = 158;
  l[267] = 159;
  l[268] = -272;
  l[269] = -271;
  l[270] = 164;
  l[271] = 165;
  l[272] = -274;
  l[273] = 162;
  l[274] = 163;
  l[275] = -283;
  l[276] = -280;
  l[277] = -279;
  l[278] = 152;
  l[279] = 153;
  l[280] = -282;
  l[281] = 150;
  l[282] = 151;
  l[283] = -287;
  l[284] = -286;
  l[285] = 156;
  l[286] = 157;
  l[287] = -289;
  l[288] = 154;
  l[289] = 155;
  l[290] = -306;
  l[291] = -299;
  l[292] = -296;
  l[293] = -295;
  l[294] = 176;
  l[295] = 177;
  l[296] = -298;
  l[297] = 174;
  l[298] = 175;
  l[299] = -303;
  l[300] = -302;
  l[301] = 180;
  l[302] = 181;
  l[303] = -305;
  l[304] = 178;
  l[305] = 179;
  l[306] = -314;
  l[307] = -311;
  l[308] = -310;
  l[309] = 168;
  l[310] = 169;
  l[311] = -313;
  l[312] = 166;
  l[313] = 167;
  l[314] = -318;
  l[315] = -317;
  l[316] = 172;
  l[317] = 173;
  l[318] = -320;
  l[319] = 170;
  l[320] = 171;
  l[321] = -353;
  l[322] = -338;
  l[323] = -331;
  l[324] = -328;
  l[325] = -327;
  l[326] = 128;
  l[327] = 129;
  l[328] = -330;
  l[329] = 31;
  l[330] = 127;
  l[331] = -335;
  l[332] = -334;
  l[333] = 132;
  l[334] = 133;
  l[335] = -337;
  l[336] = 130;
  l[337] = 131;
  l[338] = -346;
  l[339] = -343;
  l[340] = -342;
  l[341] = 25;
  l[342] = 26;
  l[343] = -345;
  l[344] = 23;
  l[345] = 24;
  l[346] = -350;
  l[347] = -349;
  l[348] = 29;
  l[349] = 30;
  l[350] = -352;
  l[351] = 27;
  l[352] = 28;
  l[353] = -369;
  l[354] = -362;
  l[355] = -359;
  l[356] = -358;
  l[357] = 144;
  l[358] = 145;
  l[359] = -361;
  l[360] = 142;
  l[361] = 143;
  l[362] = -366;
  l[363] = -365;
  l[364] = 148;
  l[365] = 149;
  l[366] = -368;
  l[367] = 146;
  l[368] = 147;
  l[369] = -377;
  l[370] = -374;
  l[371] = -373;
  l[372] = 136;
  l[373] = 137;
  l[374] = -376;
  l[375] = 134;
  l[376] = 135;
  l[377] = -381;
  l[378] = -380;
  l[379] = 140;
  l[380] = 141;
  l[381] = -383;
  l[382] = 138;
  l[383] = 139;
  l[384] = -448;
  l[385] = -417;
  l[386] = -402;
  l[387] = -395;
  l[388] = -392;
  l[389] = -391;
  l[390] = 224;
  l[391] = 225;
  l[392] = -394;
  l[393] = 222;
  l[394] = 223;
  l[395] = -399;
  l[396] = -398;
  l[397] = 228;
  l[398] = 229;
  l[399] = -401;
  l[400] = 226;
  l[401] = 227;
  l[402] = -410;
  l[403] = -407;
  l[404] = -406;
  l[405] = 216;
  l[406] = 217;
  l[407] = -409;
  l[408] = 214;
  l[409] = 215;
  l[410] = -414;
  l[411] = -413;
  l[412] = 220;
  l[413] = 221;
  l[414] = -416;
  l[415] = 218;
  l[416] = 219;
  l[417] = -433;
  l[418] = -426;
  l[419] = -423;
  l[420] = -422;
  l[421] = 240;
  l[422] = 241;
  l[423] = -425;
  l[424] = 238;
  l[425] = 239;
  l[426] = -430;
  l[427] = -429;
  l[428] = 244;
  l[429] = 245;
  l[430] = -432;
  l[431] = 242;
  l[432] = 243;
  l[433] = -441;
  l[434] = -438;
  l[435] = -437;
  l[436] = 232;
  l[437] = 233;
  l[438] = -440;
  l[439] = 230;
  l[440] = 231;
  l[441] = -445;
  l[442] = -444;
  l[443] = 236;
  l[444] = 237;
  l[445] = -447;
  l[446] = 234;
  l[447] = 235;
  l[448] = -480;
  l[449] = -465;
  l[450] = -458;
  l[451] = -455;
  l[452] = -454;
  l[453] = 192;
  l[454] = 193;
  l[455] = -457;
  l[456] = 190;
  l[457] = 191;
  l[458] = -462;
  l[459] = -461;
  l[460] = 196;
  l[461] = 197;
  l[462] = -464;
  l[463] = 194;
  l[464] = 195;
  l[465] = -473;
  l[466] = -470;
  l[467] = -469;
  l[468] = 184;
  l[469] = 185;
  l[470] = -472;
  l[471] = 182;
  l[472] = 183;
  l[473] = -477;
  l[474] = -476;
  l[475] = 188;
  l[476] = 189;
  l[477] = -479;
  l[478] = 186;
  l[479] = 187;
  l[480] = -496;
  l[481] = -489;
  l[482] = -486;
  l[483] = -485;
  l[484] = 208;
  l[485] = 209;
  l[486] = -488;
  l[487] = 206;
  l[488] = 207;
  l[489] = -493;
  l[490] = -492;
  l[491] = 212;
  l[492] = 213;
  l[493] = -495;
  l[494] = 210;
  l[495] = 211;
  l[496] = -504;
  l[497] = -501;
  l[498] = -500;
  l[499] = 200;
  l[500] = 201;
  l[501] = -503;
  l[502] = 198;
  l[503] = 199;
  l[504] = -508;
  l[505] = -507;
  l[506] = 204;
  l[507] = 205;
  l[508] = -510;
  l[509] = 202;
  l[510] = 203;

  e=b=a=0;
  o="";

  function B() { if(a===0) { b=encodingCharSet.indexOf(bytes.charAt(e++)); a=6; } return ((b>>--a)&0x01); }
  
  while(originalLength>0) { i=0; 
    while(l[i]<0) { 
      if(B()) { i=-l[i]; }
      else { i++; }
    }
    o+=String.fromCharCode(l[i]);
    originalLength--;
  }

  return o;
}


function gup( name ){

  name = name.replace(/[\[]/,"\\\[").replace(/[\]]/,"\\\]");
  var regexS = "[\\?&]"+name+"=([^&#]*)";  
  regexS = regexS+"(?!.*"+regexS+")"; // matches the LAST occurrence
  var regex = new RegExp( regexS );
  var results = regex.exec( window.location.href );
  if( results !== null ) { switch (results[1]) {
    case "true": case "T": return "t";  break;
    case "false": case "F": return "f"; break;
    default: return results[1];
  } }

  // allows for short version of the URL parameters, for instance sC matches squareColor
  compact_name = name.charAt(0);
  for(i=1; i<name.length; i++){
    if (name.charAt(i).match(/[A-Z]/)) { compact_name = compact_name + name.charAt(i).toLowerCase(); }
  }
  name = compact_name;

  name = name.replace(/[\[]/,"\\\[").replace(/[\]]/,"\\\]");
  regexS = "[\\?&]"+name+"=([^&#]*)";  
  regexS = regexS+"(?!.*"+regexS+")"; // matches the LAST occurrence
  regex = new RegExp( regexS );
  results = regex.exec( window.location.href );
  if( results !== null ) { switch (results[1]) {
    case "true": case "T": return "t";  break;
    case "false": case "F": return "f"; break;
    default: return results[1];
  } }

  return "";
}

function bug_report() {
  var email = project_email;
  var subject = "pgn4web board generator bug report";
  var bug_info = "pgn4web board generator bug report\n\n-------- automatically generated debug info: start --------\n\nURL: " + window.location + "\n\nuser agent: " + window.navigator.userAgent+ "\n\npgn4web version: " + pgn4web_version + "\n\niFrame HTML code:\n\n" + html_code_string + "\n\n-------- automatically generated debug info: end   --------\n\nPlease add below a description of the bug and attach a screenshot if possible.\n\n\n\n\n";
  mailto_link = 'mailto:' + email + '?subject=' + subject + '&body=' + escape(bug_info);

  win = window.open("", "bug_report", "resizable=yes,scrollbars=yes,toolbar=no,location=no,menubar=no,status=no"); 
  if (win !== null) {
    win.document.open("text/html", "replace");
    win.document.write("<html>");
    win.document.write("<head><title>pgn4web bug report</title><link rel='shortcut icon' href='pawn.ico'></link><style type='text/css'> html, body { font-family: sans-serif;  color: black; background: white } a {text-decoration: none; color: black; } </style></head>");
    win.document.write("<body>");
    win.document.write("<table width=100% cellspacing=0 cellpadding=0><tr><td align=left valign=middle><h1><a " + project_url + " target=_blank>pgn4web</a> bug report</h1></td><td align=right valign=middle><a " + project_url + " target=_blank><img src=pawns.png border=0></a></td></tr></table><p></p>please make sure that:<ul type='square'><li>you are using the same web browser where you noticed the bug in the pgn4web board generator</li><li>you opened this bug report window from the pgn4web board generator page configured with all the parameter that result in the bug condition</li></ul>Then please email ALL the the debug information below and possibly a screenshot to <i><a href=mailto:" + project_email + ">" + project_email + "</a></i><p></p>");
    win.document.write("<hr>");
    win.document.write("<pre><code>" + bug_info.replace(/</g,"&lt;").replace(/>/g,"&gt;") + "</code></pre>");
    win.document.write("<hr>");
    win.document.write("<p></p>If your email client is properly configured, you can try to <i><a href='" + mailto_link + "'>click here and automatically compose the email in your default client</a></i>; this might not work, in case you have to manually copy the above information into an <i><a href=mailto:" + project_email + ">email to " + project_email + "</a></i>.<p></p>");
    win.document.write("</body>");
    win.document.write("<html>");
    win.document.close();
    if (window.focus) { win.window.focus(); }
  }
}

function print_menu( item, level, title ) {

  menu =  '<table width=100% cellspacing=0 cellpadding=0><tr><td td valign=middle align=left>';
  menu += '<h' + level + '><a name=' + item + '>' + title + '</a></h' + level + '>';
  menu += '</td><td valign=top align=right>';
  menu += '<div style="font-size: 66%;">';
  menu += '<a href=#top>instructions</a>';
  menu += '<br>';
  menu += '&nbsp; &nbsp;<span style="color:gray">actions:</span>';
  menu += '&nbsp; &nbsp;<a href=#generate>copy iFrame</a>';
  menu += '&nbsp; &nbsp;<a href=#game_preview>preview</a>';
  menu += '&nbsp; &nbsp;<a href="javascript:generate_html_code()">generate</a>';
  menu += '<br>';
  menu += '&nbsp; &nbsp;<span style="color:gray">config:</span>';
  menu += '&nbsp; &nbsp;<a href=#pgn_form>PGN</a>';
  menu += '&nbsp; &nbsp;<a href=#replay_options>replay</a>';
  menu += '&nbsp; &nbsp;<a href=#board_options>board</a>';
  menu += '&nbsp; &nbsp;<a href=#header_moves_options>header and moves</a>';
  menu += '&nbsp; &nbsp;<a href=#page_options>page</a>';
  menu += '</div>';
  menu += '</td></tr></table>';
  document.write(menu); 
}

firstLoad = true;
window.onload = set_defaults;

</script>

<table width=100% cellspacing=0 cellpadding=0><tr>
<td align=left valign=middle>
<h1 style="color: red;"> 
<script type="text/javascript">document.write('<a style="color: red;" href=' + project_url + ' target=_blank>pgn4web</a>');</script> 
chessboard generator</h1>
</td><td align=right valign=middle>

<script type="text/javascript">document.write('<a href=' + project_url + ' target=_blank><img src=pawns.png border=0></a>');</script>
</td></tr></table>

<div style="height: 1em">&nbsp</div>
<script type="text/javascript">print_menu("instructions", 2, "instructions");</script>

<ul type="square">
<li><a href=#pgn_form><b>enter your PGN text</b> in the green textbox below</a>
  <ul type="square">
  <li>keep PGN data short: due to a limitation of web browsers and web servers with the URL length, only short PGN texts are allowed and a warning is issued if the max URL length is exceeded; also beware of possible hidden URL redirections extending your URL length further</li>
  <li>beware of "[" and "]" characters in the game text/comments: if square brackets are present in the comments (or the game text) in a pattern similar to the PGN header pattern <i>[tag "value"]</i> then the game parsing might break. If your PGN file is not displayed properly, please check for characters "[" and "]" in the comments and try removing them.</li>
  <li>keep "encode PGN text" checkbox checked: within the board generator, if the "encode PGN text" checkbox is unchecked, the comment tag ";" will flag as a comment the remaining of the PGN data rather than up to the end of line only; please either check the "encode PGN text" checkbox or replace the ";" comment tag with the "{" comment tag and close the comment with "}" at the end of the line</li>
  </ul>
  </li>
<li><b><a href=#replay_options>modify any of the configuration options</a></b>, layout, colors and fonts</li>
<li><b><a href=#generate>generate the HTML code</a></b> and <b><a href=#game_preview>preview your chessboard</a></b></li>

<li><b><a href=#replay_options>fine tune configuration options</a></b> to your liking
  <ul type="square">
  <li><a href=#page_options>check carefully the frame height/width values</a>: different browsers might render some items slightly bigger or smaller, so <a href=#page_options>leave some empty space at the bottom of the frame by increasing the height</a></li>
  </ul>
  </li>
  <li>once happy with <a href=#game_preview>the preview chessboard</a>, just <a href=#generate><b>cut and paste the HTML code</b> from the yellow box</a> into your web page or your blog; when entering the code in your website or blog, please make sure you are using the HTML editing option, otherwise the enhanced editor might alter the code you enter</li>

<li>email to <i>
<script type="text/javascript">document.write('<a href=mailto:' + project_email + '>' + project_email + '</a>');</script>
</i> the address of your website or your blog</li>
<li>if something goes wrong, you might want to <i><a href="javascript:bug_report()">click here and file a bug report</a></i></li>
<li><b>service note</b>: the pgn4web board generator on this site is intended for chess enthusiasts to easily add chess games with a dynamic chessboard to their personal blogs and websites. If you publish chess games as part of a professional site and need full server availability and high network performance, you are strongly recommended to evaluate the code from 
<script type="text/javascript">document.write('<a href=' + project_url + '>the pgn4web site</a>');</script>
and install the tool on your own servers
</ul>

<form id="board" name="board" style="display:inline;" action="javascript:generate_html_code()">

<div style="height: 3em">&nbsp</div>
<script type="text/javascript">print_menu("generate", 2, "generate and copy iFrame");</script>

<div style="height: 1em">&nbsp;</div>

<div style="font-style: italic; font-weight: bold; text-align: center; margin-bottom:6;">automatically generated HTML code for your web page or blog</div>
<textarea readonly id="html_code" name="html_code" rows=15 class="textbox" style="background-color: #FFFFCC; scrollbar-base-color: #FFFFCC;"></textarea>
<div id="html_code_status">&nbsp;</div>
<p></p>
<br>

<table width=100% cellspacing=0 cellpadding=0><tr>
<td align=left valign=middle width="50%">
<input type="button" id="generate_html_code_button" name="generate_html_code_button" value="generate HTML code and update preview" onClick="generate_html_code()" style="width: 100%;"/>
</td><td width="25%">
</td><td align=right valign=middle width="25%">
<input type="button" id="reset_defaults_button" name="reset_defaults_button" value="reset form to default values" onClick="reset_form()" style="width: 100%;"/>
</td></tr></table>

<div style="height: 3em">&nbsp</div>
<script type="text/javascript">print_menu("game_preview", 2, "preview");</script>
<div style="height: 1em">&nbsp;</div>

<center>
<div class="textbox" id=preview>&nbsp;</div>
</center>

<div style="height: 2em">&nbsp</div>
<h2>configuration options</h2>

<div style="height: 2em">&nbsp</div>
<script type="text/javascript">print_menu("pgn_form", 3, "chess games notation in PGN format");</script>

<div style="height: 1em">&nbsp;</div>

<textarea id=pgnText class="textbox" style="background-color: #DDFFDD; scrollbar-base-color: #DDFFDD;" rows=15 onChange="update_pgnTextLength()"></textarea>
<table cellspacing="0" cellpadding="0" width="100%"><tr>
<td align="left"><div class='helptext'>enter PGN data</div></td>
<td align="right"><div class="helptext" id="pgnTextLength"></div></td>
</tr></table>
<p></p>

<input class="checkbox" type="checkbox" id="encodePgn" name="checkbox" value="encodePgn" />
&nbsp;&nbsp; encode PGN text &nbsp;&nbsp;
<span class="helptext"">encode the PGN text to a URL friendly format (this should be normally enabled)</span>

<p></p>

<div style="height: 3em">&nbsp</div>
<script type="text/javascript">print_menu("replay_options", 3, "game replay options");</script>
<div style="height: 1em">&nbsp;</div>

<input class="checkbox" type="checkbox" id="auto" name="checkbox" value="auto" />
&nbsp;&nbsp; autoplay game on page load &nbsp;&nbsp;
<p></p>

<select class="dropdown" id="delay" name="dropdown">
<option value="1000">1</option>
<option value="2000">2</option>

<option value="3000">3</option>
<option value="5000">5</option>
<option value="10000">10</option>
<option value="300000">30</option>
</select>
&nbsp;&nbsp; autoplay delay (sec) &nbsp;&nbsp;
<p></p>

<input class="checkbox" type="checkbox" id="loop" name="checkbox" value="loop" />
&nbsp;&nbsp; loop through games at game end &nbsp;&nbsp;

<div style="height: 3em">&nbsp</div>
<script type="text/javascript">print_menu("board_options", 3, "chessboard options");</script>
<div style="height: 1em">&nbsp;</div>

<select class="dropdown" id="pieceFont" name="dropdown">
<option value="alpha">alpha</option>
<option value="merida">merida</option>
<option value="uscf">uscf</option>
</select>
&nbsp;&nbsp; piece font &nbsp;&nbsp;

<p></p>

<select class="dropdown" id="pieceSize" name="dropdown" onChange="validate_pieceSize();">
<option value="20">20</option>
<option value="21">21</option>
<option value="22">22</option>
<option value="23">23</option>
<option value="24">24</option>
<option value="25">25</option>
<option value="26">26</option>

<option value="27">27</option>
<option value="28">28</option>
<option value="29">29</option>
<option value="30">30</option>
<option value="31">31</option>
<option value="32">32</option>
<option value="33">33</option>
<option value="34">34</option>
<option value="35">35</option>

<option value="36">36</option>
<option value="37">37</option>
<option value="38">38</option>
<option value="39">39</option>
<option value="40">40</option>
<option value="41">41</option>
<option value="42">42</option>
<option value="43">43</option>
<option value="44">44</option>

<option value="45">45</option>
<option value="46">46</option>
<option value="47">47</option>
<option value="48">48</option>
<option value="52">52</option>
<option value="56">56</option>
<option value="60">60</option>
<option value="64">64</option>
<option value="72">72</option>

<option value="80">80</option>
<option value="88">88</option>
<option value="96">96</option>
<option value="112">112</option>
<option value="128">128</option>
<option value="144">144</option>
<option value="300">300</option>
</select>
&nbsp;&nbsp; piece size &nbsp;&nbsp;

<p></p>

<input class="input" type="text" id="squareSize" name="input" value="" size="9" onChange="validate_squareSize(); update_suggested_iframe_dimensions()">
&nbsp;&nbsp; square size &nbsp;&nbsp;
<span class="helptext"">a number; must be larger than the piece size</span>
<p></p>
<br>

<input class="color input" type="text" id="lightColorHex" name="input" value="" size="9" onChange="validate_color(this, 'light squares color', lightColorHex_default)">
&nbsp;&nbsp; light squares color &nbsp;&nbsp;
<p></p>

<input class="color input" type="text" id="darkColorHex" name="input" value="" size="9" onChange="validate_color(this, 'dark squares color', darkColorHex_default)">
&nbsp;&nbsp; dark squares color &nbsp;&nbsp;
<p></p>

<input class="color input" type="text" id="boardBorderColorHex" name="input" value="" size="9" onChange="validate_color(this, 'board border color', boardBorderColorHex_default)">
&nbsp;&nbsp; board border color &nbsp;&nbsp;
<p></p>

<input class="color {adjust:false} input" type="text" id="highlightColorHex" name="input" value="" size="9" onChange="validate_color_none(this, 'highlight squares color', highlightColorHex_default)">
&nbsp;&nbsp; highlight squares color &nbsp;&nbsp;
<span class="helptext">set to <b>none</b> in order to disable square highlighting</span>

<p></p>
<br>

<input class"checkbox" type="checkbox" id="showButtons" name="checkbox" value="showButtons" onChange="update_controls()">
&nbsp;&nbsp; show control buttons &nbsp;&nbsp;
<span class="helptext">control buttons might not be necessary, just try clicking the G8 square</span>
<p></p>

<input class="color {adjust:false} input" type="text" id="controlBackgroundColorHex" name="input" value="" size="9" onChange="validate_color_default(this, 'control buttons background color', 'default'); update_controls()">
&nbsp;&nbsp; control buttons background color &nbsp;&nbsp;
<span class="helptext">set to <b>default</b> in order to use standard buttons from the browser</span>

<p></p>

<input class="color input" type="text" id="controlTextColorHex" name="input" value="" size="9" onChange="validate_color(this, 'control buttons text color', controlTextColorHex_default)">
&nbsp;&nbsp; control buttons text color &nbsp;&nbsp;

<div style="height: 3em">&nbsp</div>
<script type="text/javascript">print_menu("header_moves_options", 3, "header and moves options");</script>
<div style="height: 1em">&nbsp;</div>

<input class="input" type="text" id="textMargin" name="input" value="" size="9" onChange="validate_number(this, 'text margin', textMargin_default);">
&nbsp;&nbsp; text margin &nbsp;&nbsp;
<span class="helptext"">a number; header/moves margin, nice to have if text overflows with scrollbars</span>

<p></p>
<br>

<input class="checkbox" type="checkbox" id="showHeader" name="checkbox" value="showHeader" onChange="update_controls()">
&nbsp;&nbsp; <b>show game header</b> &nbsp;&nbsp;
<p></p>

<input class="input" type="text" id="fontHeaderSize" name="input" value="" size="9" onChange="validate_number_percentage(this, 'header font size', fontHeaderSize_default);">
&nbsp;&nbsp; header font size &nbsp;&nbsp;
<span class="helptext"">a number or a percentage; make sure left/right columns dont touch in the middle</span>
<p></p>

<input class="color input" type="text" id="fontHeaderColorHex" name="input" value="" size="9" onChange="validate_color(this, 'header font color', fontHeaderColorHex_default)">
&nbsp;&nbsp; header font color &nbsp;&nbsp;
<p></p>
<br>

<input class="checkbox" type="checkbox" id="showMoves" name="checkbox" value="showMoves" onChange="update_controls()">
&nbsp;&nbsp; <b>show game moves</b> &nbsp;&nbsp;
<p></p>

<input class="checkbox" type="checkbox" id="showComments" name="checkbox" value="showComments">
&nbsp;&nbsp; show game comments &nbsp;&nbsp;

<p></p>

<input class="checkbox" type="checkbox" id="showCommentsOnSeparateLines" name="checkbox" value="showCommentsOnSeparateLines">
&nbsp;&nbsp; show comments on separate lines &nbsp;&nbsp;
<p></p>

<input class="input" type="text" id="fontMovesSize" name="input" value="" size="9" onChange="validate_number_percentage(this, 'moves font size', fontMovesSize_default);">
&nbsp;&nbsp; moves font size &nbsp;&nbsp;
<span class="helptext"">a number or a percentage</span>
<p></p>

<input class="color input" type="text" id="fontMovesColorHex" name="input" value="" size="9" onChange="validate_color(this, 'moves font color', fontMovesColorHex_default)">

&nbsp;&nbsp; moves font color &nbsp;&nbsp;
<p></p>

<input class="color input" type="text" id="highlightMoveColorHex" name="input" value="" size="9" onChange="validate_color(this, 'highlight move color', highlightMoveColorHex_default)">
&nbsp;&nbsp; highlight move color &nbsp;&nbsp;
<p></p>

<input class="input" type="text" id="fontCommentsSize" name="input" value="" size="9" onChange="validate_number_percentage(this, 'comments font size', fontCommentsSize_default);">
&nbsp;&nbsp; comments font size &nbsp;&nbsp;
<span class="helptext"">a number or a percentage</span>

<p></p>

<input class="color input" type="text" id="fontCommentsColorHex" name="input" value="" size="9" onChange="validate_color(this, 'comments font color', fontCommentsColorHex_default)">
&nbsp;&nbsp; comments font color &nbsp;&nbsp;

<div style="height: 3em">&nbsp</div>
<script type="text/javascript">print_menu("page_options", 3, "web page options");</script>
<div style="height: 1em">&nbsp;</div>

<select class="dropdown" id="horizontalLayout" name="dropdown" onChange="validate_frameHeight(); validate_frameWidth(); update_suggested_iframe_dimensions();">
<option value="f">vertical</option>
<option value="t">horizontal</option>
</select>
&nbsp;&nbsp; chessboard and header/moves layout &nbsp;&nbsp;

<p></p>

<input class="input" type="text" id="frameHeight" name="input" value="" size="9" onChange="validate_frameHeight(); update_suggested_iframe_dimensions();">
&nbsp;&nbsp; iFrame height &nbsp;&nbsp;
<span id="frameHeight_helpText" class="helptext"></span>
<p></p>

<input class="input" type="text" id="frameWidth" name="input" value="" size="9" onChange="validate_frameWidth(); update_suggested_iframe_dimensions();"> 
&nbsp;&nbsp; iFrame width &nbsp;&nbsp;
<span id="frameWidth_helpText" class="helptext"></span>
<p></p>

<input class="input" type="text" id="framePadding" name="input" value="" size="9" onChange="validate_number(this, 'frame padding', framePadding_default); update_suggested_iframe_dimensions();">

&nbsp;&nbsp; iFrame padding &nbsp;&nbsp;
<span class="helptext">a number; border padding around the iframe, included within the iFrame width value</span>
<p></p>
<br>

<input class="color input" type="text" id="backgroundColorHex" name="input" value="" size="9" onChange="validate_color(this, 'background color', backgroundColorHex_default)">
&nbsp;&nbsp; background color &nbsp;&nbsp;
<p></p>

<input class="color input" type="text" id="previewBackgroundColorHex" name="input" value="" size="9" onChange="validate_color(this, 'preview background color', previewBackgroundColorHex_default)"> 
&nbsp;&nbsp; preview background color &nbsp;&nbsp;
<span class="helptext"">not actually used in the HTML code, just for the preview</span>
<p></p>
<br>

<!--

<h3><a name=url_options>URL options</a></h3>

base URL: &nbsp;&nbsp;
<input type="text" id="baseUrl" name="baseUrl" value="" style="width: 100%" />
<p></p>
<br>

-->

<input type="hidden" id="baseUrl" name="baseUrl" value="" style="width: 100%" />

<script type="text/javascript">

inputWidth = document.getElementById('framePadding').offsetWidth;
theObject = document.getElementsByName('dropdown');
for (ii = 0; ii < theObject.length; ii++) {
  theObject[ii].style.width = inputWidth;
}

checkboxWidth = document.getElementById('showCommentsOnSeparateLines').offsetWidth;
// the last number added to marginLeft should be equal to the value of the .checkbox style at the top
theObject = document.getElementsByName('checkbox');
for (ii = 0; ii < theObject.length; ii++) {
  theObject[ii].style.marginLeft +=  inputWidth - checkboxWidth + 22;
}

document.write("<table width=100% cellspacing=0 cellpadding=0><tr><td align=left valign=bottom>");
document.write("<a " + project_url + " target=_blank><div class='helptext'>pgn4web v" + pgn4web_version + "</div></a>");
document.write("</td><td align=right valign=middle>");
document.write("<a " + project_url + " target=_blank><img src=pawns.png border=0></a>");
document.write("</td></tr></table>");

</script>

</form>

</body>

</html>


<html>

<head>

<title>pgn4web chessboard generator</title>

<style type="text/css">

html,
body {
  font-family: sans-serif;
  color: black;
  background: white;
}

</style>

</head>

<body>

<script type="text/javascript" src="jscolor/jscolor.js"></script>

<script  type="text/javascript">

// CUSTOMIZATION INSTRUCTIONS
// if you customize the board-generator.html file for your site 
// you probably want to customize the default values

pgnText_default = '[White " "]\n[Black " "]\n[Result " "]\n[Date " "]\n[Event " "]\n[Site " "]\n[Round " "]\n\n';
auto_default = "t";
delay_default = 1000;
loop_default = "f";
pieceFont_default = "alpha";
pieceSize_default = 24;
squareSize_default = 28;
lightColorHex_default = "EFF4EC";
darkColorHex_default = "C6CEC3";
highlightColorHex_default = "DAF4D7";
showButtons_default = "f";
showHeader_default = "t";
showMoves_default = "t";
frameHeight_default = "";
frameWidth_default = "";
showComments_default = "t"; 
showCommentsOnSeparateLines_default = "f"; 
fontHeaderColorHex_default = "000000";
fontMovesColorHex_default = "000000";
fontCommentsColorHex_default = "808080";
highlightMoveColorHex_default = "DAF4D7";
headerFontSize_default = "100%";
movesFontSize_default = "100%";
commentsFontSize_default = "100%";
backgroundColorHex_default = "FFFFFF";
previewBackgroundColorHex_default = "CCCCCC";
baseUrl_default = location.protocol + "//" + location.hostname+location.pathname.substr(0, location.pathname.lastIndexOf("/")) + "/board.html";

function set_defaults() {
  document.getElementById('iframe_tag').value = '';
  document.getElementById('iframe_tag_status').innerHTML = 'Enter the PGN text, customize options, then press the "Preview iFrame" button and take note of the BOARD HEIGHT value';

  if ((pgnText_value = gup("pgnText")) == "") { pgnText_value = pgnText_default }
  document.getElementById('pgnText').value = pgnText_value;

  if ((auto_value = gup("auto")) == "") { auto_value = auto_default }
  document.board.auto.checked = (auto_value == "t");

  if ((delay_value = gup("delay")) == "") { delay_value = delay_default }
  document.board.delay.value = delay_value;

  if ((loop_value = gup("loop")) == "") { loop_value = loop_default }
  document.board.loop.checked = (loop_value == "t");

  if ((pieceFont_value = gup("pieceFont")) == "") { pieceFont_value = pieceFont_default }
  document.board.pieceFont.value = pieceFont_value;

  if ((pieceSize_value = gup("pieceSize")) == "") { pieceSize_value = pieceSize_default }
  document.getElementById('pieceSize').value = pieceSize_value;

  if ((squareSize_value = gup("squareSize")) == "") { squareSize_value = squareSize_default }
  document.getElementById('squareSize').value = squareSize_value;

  if ((lightColorHex_value = gup("lightColorHex")) == "") { lightColorHex_value = lightColorHex_default }
  document.board.lightColorHex.value = lightColorHex_value;

  if ((darkColorHex_value = gup("darkColorHex")) == "") { darkColorHex_value = darkColorHex_default }
  document.board.darkColorHex.value = darkColorHex_value;

  if ((highlightColorHex_value = gup("highlightColorHex")) == "") { highlightColorHex_value = highlightColorHex_default }
  document.board.highlightColorHex.value = highlightColorHex_value;

  if ((showButtons_value = gup("showButtons")) == "") { showButtons_value = showButtons_default }
  document.board.showButtons.checked = (showButtons_value == "t");

  if ((showHeader_value = gup("showHeader")) == "") { showHeader_value = showHeader_default }
  document.board.showHeader.checked = (showHeader_value == "t");

  if ((showMoves_value = gup("showMoves")) == "") { showMoves_value = showMoves_default }
  document.board.showMoves.checked = (showMoves_value == "t");

  if ((showComments_value = gup("showComments")) == "") { showComments_value = showComments_default }
  document.board.showComments.checked = (showComments_value == "t");

  if ((showCommentsOnSeparateLines_value = gup("showCommentsOnSeparateLines")) == "") { showCommentsOnSeparateLines_value = showCommentsOnSeparateLines_default }
  document.board.showCommentsOnSeparateLines.checked = (showCommentsOnSeparateLines_value == "t");

  if ((fontHeaderColorHex_value = gup("fontHeaderColorHex")) == "") { fontHeaderColorHex_value = fontHeaderColorHex_default }
  document.board.fontHeaderColorHex.value = fontHeaderColorHex_value;

  if ((fontMovesColorHex_value = gup("fontMovesColorHex")) == "") { fontMovesColorHex_value = fontMovesColorHex_default }
  document.board.fontMovesColorHex.value = fontMovesColorHex_value;

  if ((fontCommentsColorHex_value = gup("fontCommentsColorHex")) == "") { fontCommentsColorHex_value = fontCommentsColorHex_default }
  document.board.fontCommentsColorHex.value = fontCommentsColorHex_value;

  if ((highlightMoveColorHex_value = gup("highlightMoveColorHex")) == "") { highlightMoveColorHex_value = highlightMoveColorHex_default }
  document.board.highlightMoveColorHex.value = highlightMoveColorHex_value;

  if ((headerFontSize_value = gup("headerFontSize")) == "") { headerFontSize_value = headerFontSize_default }
  document.board.headerFontSize.value = headerFontSize_value;

  if ((movesFontSize_value = gup("movesFontSize")) == "") { movesFontSize_value = movesFontSize_default }
  document.board.movesFontSize.value = movesFontSize_value;

  if ((commentsFontSize_value = gup("commentsFontSize")) == "") { commentsFontSize_value = commentsFontSize_default }
  document.board.commentsFontSize.value = commentsFontSize_value;

  if ((backgroundColorHex_value = gup("backgroundColorHex")) == "") { backgroundColorHex_value = backgroundColorHex_default }
  document.board.backgroundColorHex.value = backgroundColorHex_value;

  if ((previewBackgroundColorHex_value = gup("previewBackgroundColorHex")) == "") { previewBackgroundColorHex_value = previewBackgroundColorHex_default }
  document.board.previewBackgroundColorHex.value = previewBackgroundColorHex_value;

  if ((frameHeight_value = gup("frameHeight")) == "") { frameHeight_value = frameHeight_default }
  document.board.frameHeight.value = frameHeight_value;

  if ((frameWidth_value = gup("frameWidth")) == "") { frameWidth_value = frameWidth_default }
  document.board.frameWidth.value = frameWidth_value;

  if ((baseUrl_value = gup("baseUrl")) == "") { baseUrl_value = baseUrl_default }
  document.board.baseUrl.value = baseUrl_value;

  generate_iframe();
}

function reset_form() {
  if (confirm("do you really want to reset the form to the default values?\nAll your options including the PGN text will be lost!")) { set_defaults(); }
}

function update_header_text_controls() {
  update_disabled_controls();	
  update_suggested_iframe_dimensions();
}


function update_disabled_controls() {
}

function update_suggested_iframe_dimensions() {

  boardWidth = 8 * document.board.squareSize.value + 6; 
  suggested_frameWidth = boardWidth;
  suggested_frameHeight = boardWidth;
  
  if (document.board.showButtons.checked) { suggested_frameHeight += 50; }

  if (document.board.showHeader.checked) { suggested_frameHeight += 100; }
  if (document.board.showMoves.checked) { suggested_frameHeight += 200; }
  if (document.board.showHeader.checked || document.board.showMoves.checked) {
    suggested_frameHeight = Math.max(suggested_frameHeight, 2 * boardWidth);
  }

  if (document.board.showHeader.checked || document.board.showMoves.checked) {
    suggested_frameWidth = Math.max (suggested_frameWidth, 400);
  }

  document.getElementById('frameHeight_helpText').innerHTML = "if blank the frame height will be set at the automatically calculated value of " + suggested_frameHeight;
  document.getElementById('frameWidth_helpText').innerHTML = "if blank the frame width will be set at the automatically calculated value of " + suggested_frameWidth;

}

function calculate_iframe() {

  // this must be the firts item
  baseUrl_value = document.board.baseUrl.value;
  iframeUrl = baseUrl_value + "?";

  if (document.board.auto.checked) { auto_value = "t" } else { auto_value = "f" }
  delay_value = parseInt(document.board.delay.value);
  if (document.board.loop.checked) { loop_value = "t" } else { loop_value = "f" }
  iframeUrl += "&a=" + auto_value + "&d=" + delay_value + "&l=" + loop_value;

  pieceFont_value = document.board.pieceFont.value;
  pieceSize_value = parseInt(document.board.pieceSize.value);
  squareSize_value = parseInt(document.board.squareSize.value);
  if (pieceSize_value > squareSize_value) { alert("Error: the piece size (" + pieceSize_value + ") can not be bigger than the square size (" + squareSize_value + ")"); }
  iframeUrl += "&pf=" + pieceFont_value + "&ps=" + pieceSize_value + "&ss=" + squareSize_value;

  lightColorHex_value = document.board.lightColorHex.value; 
  darkColorHex_value = document.board.darkColorHex.value; 
  highlightColorHex_value = document.board.highlightColorHex.value; 
  iframeUrl += "&lch=" + lightColorHex_value + "&dch=" + darkColorHex_value + "&hch=" + highlightColorHex_value;

  if (document.board.showButtons.checked) { showButtons_value = "t" } else { showButtons_value = "f" }
  iframeUrl += "&sb=" + showButtons_value;

  if (document.board.showHeader.checked) { showHeader_value = "t" } else { showHeader_value = "f" }
  if (document.board.showMoves.checked) { showMoves_value = "t" } else { showMoves_value = "f" }
  iframeUrl += "&sh=" + showHeader_value + "&sm=" + showMoves_value;

  if (document.board.showHeader.checked || document.board.showMoves.checked) {

    if (document.board.showComments.checked) { showComments_value = "t" } else { showComments_value = "f" } 
    if (document.board.showCommentsOnSeparateLines.checked) { showCommentsOnSeparateLines_value = "t" } else { showCommentsOnSeparateLines_value = "f" }
    iframeUrl += "&sc=" + showComments_value + "&scosl=" + showCommentsOnSeparateLines_value;

    fontHeaderColorHex_value =  document.board.fontHeaderColorHex.value
    fontMovesColorHex_value =  document.board.fontMovesColorHex.value
    fontCommentsColorHex_value =  document.board.fontCommentsColorHex.value
    highlightMoveColorHex_value =  document.board.highlightMoveColorHex.value
    iframeUrl += "&fhch=" + fontHeaderColorHex_value + "&fmch=" + fontMovesColorHex_value + "&fcch=" + fontCommentsColorHex_value + "&hmch=" + highlightMoveColorHex_value;

    headerFontSize_value =  document.board.headerFontSize.value
    movesFontSize_value =  document.board.movesFontSize.value
    commentsFontSize_value =  document.board.commentsFontSize.value
    iframeUrl += "&hfs=" + headerFontSize_value + "&mfs=" + movesFontSize_value + "&cfs" + commentsFontSize_value;

  } 

  backgroundColorHex_value = document.board.backgroundColorHex.value;
  iframeUrl += "&bch=" + backgroundColorHex_value;

  // this does not go in the iframee
  previewBackgroundColorHex_value = document.board.previewBackgroundColorHex.value;

  update_suggested_iframe_dimensions();
  if ((frameHeight_value = document.board.frameHeight.value) == "") { frameHeight_value = suggested_frameHeight }
  if ((frameWidth_value = document.board.frameWidth.value) == "") { frameWidth_value = suggested_frameWidth }
  iframeUrl += "&fh=" + frameHeight_value + "&fw=" + frameWidth_value;

  // better to keep this as last
  pgnText_value = document.getElementById('pgnText').value;
  iframeUrl += "&pt=" + pgnText_value.replace(/\n/g," ");

}

function generate_iframe() {

  calculate_iframe();

  iframe_tag_string = "<iframe frameborder=0 height=" + frameHeight_value +" width=" + frameWidth_value +" scrolling=auto src='" + iframeUrl + "'>your web browser does not support iframes as required to display the chessboard</iframe>";

  document.getElementById('iframe_tag').value = iframe_tag_string;
  document.getElementById('preview').innerHTML = "<table bgcolor=#" + previewBackgroundColorHex_value + " width=100% cellpadding=20><tr><td align=center valign=middle> " + iframe_tag_string + "</td></tr></table>";

  if (iframeUrl.length < 2000) {
    document.getElementById('iframe_tag_status').innerHTML = "iFrame URL looks fine";
    document.getElementById('iframe_tag_status').style.color = "gray";
    document.getElementById('iframe_tag_status').style.fontWeight = "normal";
  } else {
    document.getElementById('iframe_tag_status').innerHTML = "WARNING: iframe URL lenght is " + iframeUrl.length + " thus larger than 2000 and as such might not be accepted by browser (note that some redirection might make your URL even longer)";
    document.getElementById('iframe_tag_status').style.color = "red";
    document.getElementById('iframe_tag_status').style.fontWeight = "bold";
  }  

}

function gup( name ){

  name = name.replace(/[\[]/,"\\\[").replace(/[\]]/,"\\\]");
  var regexS = "[\\?&]"+name+"=([^&#]*)";  
  regexS = regexS+"(?!.*"+regexS+")"; // matches the LAST occurrence
  var regex = new RegExp( regexS );
  var results = regex.exec( window.location.href );
  if( results != null ) { switch (results[1]) {
    case "t": case "T": return "true";  break;
    case "f": case "F": return "false"; break;
    default: return results[1];
  } }

  // allows for short version of the URL parameters, for instance sC matches squareColor
  compact_name = name.charAt(0);
  for(i=1; i<name.length; i++){
    if (name.charAt(i).match(/[A-Z]/)) { compact_name = compact_name + name.charAt(i).toLowerCase(); }
  }
  name = compact_name;

  name = name.replace(/[\[]/,"\\\[").replace(/[\]]/,"\\\]");
  var regexS = "[\\?&]"+name+"=([^&#]*)";  
  regexS = regexS+"(?!.*"+regexS+")"; // matches the LAST occurrence
  var regex = new RegExp( regexS );
  var results = regex.exec( window.location.href );
  if( results != null ) { switch (results[1]) {
    case "t": case "T": return "true";  break;
    case "f": case "F": return "false"; break;
    default: return results[1];
  } }

  return "";
}


window.onload = set_defaults;

</script>


<h1>pgn4web chessboard generator</h1>

<h2>instructions</h2>
<ol type="1">
<li>enter your PGN text</li>
<li>modify any of the options</li>
<li>generate the HTML code and preview the iFrame</li>
<li>tune options, especially the frame height/width (remember some browser might render some items slightly bigger or smaller)</li>
<li>cut & paste the iFrame HTML code in your web page or your blog</li>
</ol>

<form id="board" name="board" action="javascript:generate_iframe()">

<h2>actions</h2>

<input type="button" id="reset_defaults_button" name="reset_defaults_button" value="Reset form to default value" onClick="reset_form()" />
<br>
<br>
<input type="button" id="generate_iframe_button" name="generate_iframe_button" value="Generate iFrame HTML code for my web page or blog and update preview" onClick="generate_iframe()" />
<br>
<br>
<b>iFrame HTML code:</b><input type=text id="iframe_tag" name="iframe_tag" size=80 />
<br>
<br>
<div id="iframe_tag_status">&nbsp;</div>
<br>

<h2>preview</h2>
<center>
<div id='preview'></div>
</center>

<h2>options</h2>

<h3>chess game notation in PGN format</h3>

<textarea id=pgnText cols=80 rows=15></textarea>

<h3>game replay options</h3>
autoplay game on page load:
<input type="checkbox" id="auto" name="auto" value="auto" />
<br>

autoplay delay (sec): 
<select id="delay" name="delay">
<option value="1000">1</option>
<option value="2000">2</option>
<option value="3000">3</option>
<option value="5000">5</option>
<option value="10000">10</option>
<option value="300000">30</option>
</select>
<br>
loop through games at game end: 
<input type="checkbox" id="loop" name="loop" value="loop" />

<h3>chessboard options</h3>

piece font:
<select id="pieceFont" name="pieceFont">
<option value="alpha">alpha</option>
<option value="merida">merida</option>
<option value="uscf">uscf</option>
</select>
<br>

piece size:
<select id="pieceSize" name="pieceSize">
<option value="20">20</option>
<option value="21">21</option>
<option value="22">22</option>
<option value="23">23</option>
<option value="24">24</option>
<option value="25">25</option>
<option value="26">26</option>
<option value="27">27</option>
<option value="28">28</option>
<option value="29">29</option>
<option value="30">30</option>
<option value="31">31</option>
<option value="32">32</option>
<option value="33">33</option>
<option value="34">34</option>
<option value="35">35</option>
<option value="36">36</option>
<option value="37">37</option>
<option value="38">38</option>
<option value="39">39</option>
<option value="40">40</option>
<option value="41">41</option>
<option value="42">42</option>
<option value="43">43</option>
<option value="44">44</option>
<option value="45">45</option>
<option value="46">46</option>
<option value="47">47</option>
<option value="48">48</option>
<option value="52">52</option>
<option value="56">56</option>
<option value="60">60</option>
<option value="64">64</option>
<option value="72">72</option>
<option value="80">80</option>
<option value="88">88</option>
<option value="96">96</option>
<option value="112">112</option>
<option value="128">128</option>
<option value="144">144</option>
<option value="300">300</option>
</select>
<br>

square size:
<input type="text" id="squareSize" name="squareSize" value="" size="4" onChange="update_suggested_iframe_dimensions()" />
<br>
<br>

light squares color:
<input type="text" class="color" id="lightColorHex" name="lightColorHex" value="" size="7">
<br>

dark squares color:
<input type="text" class="color" id="darkColorHex" name="darkColorHex" value="" size="7">
<br>

highlight squares color:
<input type="text" class="color" id="highlightColorHex" name="highlightColorHex" value="" size="7">
<br>
<br>

show control buttons:
<input type="checkbox" id="showButtons" name="showButtons" value="showButtons" onChange="update_suggested_iframe_dimensions()" />
<br>

<h3>header and moves options</h3>

show game header:
<input type="checkbox" id="showHeader" name="showHeader" value="showHeader" onChange="update_header_text_controls()" />
<br>

show game moves:
<input type="checkbox" id="showMoves" name="showMoves" value="showMoves" onChange="update_header_text_controls()" />
<br>
<br>

show game comments:
<input type="checkbox" id="showComments" name="showComments" value="showComments" />
<br>

show game comments on separate lines:
<input type="checkbox" id="showCommentsOnSeparateLines" name="showCommentsOnSeparateLines" value="showCommentsOnSeparateLines" />
<br>
<br>

header font color:
<input type="text" class="color" id="fontHeaderColorHex" name="fontHeaderColorHex" value="" size="7" />
<br>

moves font color:
<input type="text" class="color" id="fontMovesColorHex" name="fontMovesColorHex" value="" size="7" />
<br>

comments font color:
<input type="text" class="color" id="fontCommentsColorHex" name="fontCommentsColorHex" value="" size="7" />
<br>

highlight move color:
<input type="text" class="color" id="highlightMoveColorHex" name="highlightMoveColorHex" value="" size="7" />
<br>
<br>

header font size:
<input type="text" id="headerFontSize" name="headerFontSize" value="" size="4" />
<br>

moves font size:
<input type="text" id="movesFontSize" name="movesFontSize" value="" size="4" />
<br>

comments font size:
<input type="text" id="commentsFontSize" name="commentsFontSize" value="" size="4" />
<br>

<h3>page options</h3>
background color:
<input type="text" class="color" id="backgroundColorHex" name="backgroundColorHex" value="" size="7" />
<br>
preview background color:
<input type="text" class="color" id="previewBackgroundColorHex" name="previewBackgroundColorHex" value="" size="7" /> (not actually used in the iframe, just for the preview)
<br>

iFrame height:
<input type="text" id="frameHeight" name="frameHeight" value="" size="5" /> <span id="frameHeight_helpText"></span>
<br>

iFrame width:
<input type="text" id="frameWidth" name="frameWidth" value="" size="5" /> <span id="frameWidth_helpText"></span>
<br>
<br>

<h3>URL options</h3>

base URL:
<input type="text" id="baseUrl" name="baseUrl" value="" size="80" />
<br>
<br>

</form>

</body>

</html>

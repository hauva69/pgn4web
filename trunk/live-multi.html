<html>

<!--
  pgn4web javascript chessboard
  copyright (C) 2009, 2011 Paolo Casaschi
  see README file and http://pgn4web.casaschi.net
  for credits, license and more details
-->

<head>

<title>pgn4web chess live broadcast</title>

<link rel="shortcut icon" href="pawn.ico" />

<script src="pgn4web-server-config.js" type="text/javascript"></script>
<script  type="text/javascript">
// this should have been defined in pgn4web-server-config.js
// setting default value here just in case
var pgn4web_live_pointer_url;
if (pgn4web_live_pointer_url == undefined) { pgn4web_live_pointer_url = "."; }
</script>

<script type="text/javascript">

  pgnFile_default = "";
  // accepts pgnData as alias for pgnFile for consistency with board.html
  if ((pgnFile = gup("pgnData")) === "") { 
    if ((pgnFile = gup("pgnFile")) === "") {
      pgnFile = pgnFile_default; 
    }
  }

  refreshMinutes_default = 1;
  if ((refreshMinutes = gup("refreshMinutes")) === "") { 
    refreshMinutes = refreshMinutes_default;
  } else {
    testMinutes = refreshMinutes + "";
    if (testMinutes.match(/[^0-9\.]/)) {
      alert("ERROR: refreshMinutes parameter must be a positive number.\n" +
            "Supplied " + testMinutes + "; defaulting to 1."); 
      refreshMinutes = 1;
    }
  }

  if ((gup("demo") == "true") || (gup("demo") == "t") ||
      (gup("refreshDemo") == "true") || (gup("refreshDemo") == "t")) {
    demoFlag = true; alertFlag = true;
  } else { demoFlag = false; alertFlag = false; }

  var searchArray = new Array();
  if ((search = gup("search")) !== "") {
    searchArray = search.split(",");
  }
  if (searchArray.length > 32) {
    alert("ERROR: search parameters must not contain more that 32 items.\n" +
          "Supplied " + searchArray.length + " items, truncating to 32.");
    searchArray.length = 32;
  }

  boards_default = searchArray.length ? searchArray.length : 3;
  show_board_selector = false;
  if ((boards = gup("boards")) === "") {
    boards = boards_default;
    if (!searchArray.length) { show_board_selector = true; }
  } else {
    testBoards = boards + "";
    if ((testBoards.match(/[^0-9]/)) || (boards == 0) || (boards > 32)) {
      alert("ERROR: boards parameter must be a positive integer, max 32.\n" +
            "Supplied " + testBoards + "; defaulting to " + boards_default + "."); 
      boards = boards_default;
    }
  }
  boards = parseInt(boards, 10);

var colums_default_used = false;
function columns_default(b) {
  colums_default_used = true;
  if (b == 1) { return 1; }
  else if (b == 2) { return 2; }
  else if ((b == 3) || (b == 5) || (b == 6) || (b == 9)) { return 3; }
  else { return 4; }
}

  if ((columns = gup("columns")) === "") {
    columns = columns_default(boards);
  } else {
    testColumns = columns + "";
    if ((testColumns.match(/[^0-9]/)) || (columns == 0) || (columns > 8)) {
      alert("ERROR: columns parameter must be a positive integer, max 8.\n" +
            "Supplied " + testColumns + "; defaulting to " + columns_default(boards) + "."); 
      columns = columns_default(boards);
    }
  }
  columns = parseInt(columns, 10);

  displayOrder_default = "sequential";
  if ((displayOrder = gup("displayOrder")) === "") {
    displayOrder = displayOrder_default;
  } else {
    if ( (displayOrder != "reverse")    && (displayOrder != "r") &&
         (displayOrder != "sequential") && (displayOrder != "s")    ) {
      alert("ERROR: displayOrder must be either 'sequential' or 'reverse'.\n" +
            "Supplied '" + displayOrder + "'; defaulting to 'sequential'."); 
      displayOrder = "sequential";
    }
  }

  if ((gup("help") == "true") || (gup("help") == "t")) { developer_help(); }

function gup( name ){

  name = name.replace(/[\[]/,"\\\[").replace(/[\]]/,"\\\]");
  var regexS = "[\\?&]"+name+"=([^&#]*)";
  // commented below to match first occurrence (to avoid users overruling setting)
  // regexS = regexS+"(?!.*"+regexS+")"; // matches the LAST occurrence
  var regex = new RegExp( regexS, "i" );
  var results = regex.exec( window.location.href );
  if( results !== null ) { return decodeURIComponent(results[1]); }

  // allows for short version of the URL parameters, for instance sC matches squareColor
  compact_name = name.charAt(0);
    for(i=1; i<name.length; i++){
      if (name.charAt(i).match(/[A-Z]/)) { compact_name = compact_name + name.charAt(i).toLowerCase(); }
    }
  name = compact_name;

  name = name.replace(/[\[]/,"\\\[").replace(/[\]]/,"\\\]");
  regexS = "[\\?&]"+name+"=([^&#]*)";
  // commented below to match first occurrence (to avoid users overruling setting)
  // regexS = regexS+"(?!.*"+regexS+")"; // matches the LAST occurrence
  regex = new RegExp( regexS, "i" );

  results = regex.exec( window.location.href );
  if( results !== null ) { return decodeURIComponent(results[1]); }

  return "";
}

function developer_help() {
  alert("pgn4web live-multi.html parameters" + "\n" + 
    " - pgnData = " + pgnFile + "; PGN file to load (default blank)" + "\n" +
    " - refreshMinutes = " + refreshMinutes + "; refresh interval in minutes, decimals allowed (default 1)" + "\n" +
    " - refreshDemo = " + demoFlag + "; sets live demo mode (default false)" + "\n" +
    " - boards = " + boards + "; number of boards (default " + boards_default + ")" + "\n" +
    " - columns = " + columns + "; number of columns (default empty for automatic selection)" + "\n" +
    " - displayOrder = " + displayOrder + "; order of game display, 'sequential' or 'reverse' (default 'sequential')" + "\n" +
    " - search = comma separated list of game search items for each board" + "\n" +
    " - help = true; prints this help (default false)");
}

buildUrl_one = location.protocol + "//" + location.host + location.pathname + "?";
buildUrl_two = "";
if (displayOrder.charAt(0) !== displayOrder_default.charAt(0)) { buildUrl_two += "&do=" + displayOrder.charAt(0); }
if (refreshMinutes !== refreshMinutes_default) { buildUrl_two += "&rm=" + refreshMinutes; }
if (demoFlag) { buildUrl_two += "&rd=t"; }
if (search) { buildUrl_two += "&s=" + search; }
if (pgnFile !== pgnFile_default) { buildUrl_two += "&pd=" + pgnFile; }
columns_switch = colums_default_used ? "" : "&c=" + columns;
oneMoreBoardUrl = buildUrl_one + "b=" + (boards + 1) + columns_switch + buildUrl_two;
oneLessBoardUrl = buildUrl_one + "b=" + (boards - 1) + columns_switch + buildUrl_two;
oneMoreColumnUrl = buildUrl_one + "b=" + boards + "&c=" + (columns + 1) + buildUrl_two;
oneLessColumnUrl = buildUrl_one + "b=" + boards + "&c=" + (columns - 1) + buildUrl_two;

</script>

<style type="text/css">

body
{ color: #DDDDDD; background: white; font-family: sans-serif; padding: 20px 20px 10px 20px; }

.header, .header:link, .header:visited, .header:hover, .header:active
{ color: red; text-decoration: none; padding-bottom: 0.5em; }

a:link, a:visited, a:hover, a:active
{ color: #DDDDDD; text-decoration: none; }

.menuLink, .menuHead 
{ font-size:small; font-weight:bold; }

.menuLink
{ margin-left: 13px; }

.menuLink:hover, .footerLink:hover
{ color: red; }

</style>

</head>

<body>

<table border="0" cellpadding="0" cellspacing="0" width="100%"><tbody><tr>
<td align="left" valign="middle">
<h1 class="header" name="top"><a class="header" href="#row1">pgn4web</a> <a class="header" href="#row2">chess</a> <a class="header" href="#row3">live</a> <a class="header" href="#row4">broadcast</a></h1>
</td>
<td align="right" valign="middle">
<a href=.><img src="pawns.png" border="0"></a>
</td>
</tr></tbody></table>

<script type="text/javascript">

// if (show_board_selector) {
//   document.write("<div style='margin-bottom: 9px;'>");
//   document.write("<span class='menuHead'>number of chessboards</span>");
//   for(ii=1; ii<=8; ii++) {
//     document.write("<a class='menuLink' href='" + buildUrl_one + "b=" + ii + buildUrl_two + "'>" + ii + "</a>");
//   }
//   document.write("</div>");
// }

rows = Math.ceil(boards / columns);

document.write("<center><table cellspacing='5' cellpadding='0'>");
for (r = 0; r < rows; r++) {
  document.write("<tr>");
  for (c = 0; c < columns; c++) {
    document.write("<td align='center' width='260'>");
      if ((r * columns + c) < boards) {
        rm = Math.floor(1000 * (refreshMinutes * (1 + 0.1 * Math.random()))) / 1000;
        sid = r * columns + c;
        sal = searchArray.length;
        if (displayOrder.charAt(0) == "r") {
          initialGame = searchArray[sal-sid-1] ? searchArray[sal-sid-1] : -sid-1;
        } else {
          initialGame = searchArray[sid] ? searchArray[sid] : sid+1;
        }
        document.write("<a style='color:white; color:transparent; font-size:x-small;' name='row" + (r+1) + "' href='#row" + (r+1) + "'>chessboard row:" + (r+1) + " col:" + (c+1) + "</a><br>");
          document.write("<iframe width='240' height='290' frameborder='0' scrolling='no' marginheight='0' marginwidth='0' src='" + pgn4web_live_pointer_url + "/live-multi-frame.html?pd=" + pgnFile + "&ig=" + initialGame + "&rm=" + rm + (demoFlag ? "&rd=t" : "") + "'>your web browser and/or your host do not support iframes as required to display the chessboard</iframe>");
      }
    document.write("</td>");
  }
  document.write("</tr>");
}
document.write("</table></center>");

document.write("<table width='100%' cellspacing='5' cellpadding='0'><tr><td>");
document.write("<p style='text-align:left; font-size:small; color:white; color:transparent;'>refreshMinutes: " + refreshMinutes + "</p>");
document.write("</td><td>");
document.write("<p style='text-align:right; font-size:small; color:white; color:transparent;'><a style='color:white; color:transparent;' href='" + pgnFile + "'>" + pgnFile + "</a></p>");
document.write("</td></tr><tr><td>");
document.write("<p style='text-align: left; font-size:small; font-weight:bold;'>");
if (columns > 1) {
  document.write("<a class='footerLink' href='" + oneLessColumnUrl + "'>less</a>");
} else {
  document.write("less");
}
document.write(" / ");
if (columns < 8) {
  document.write("<a class='footerLink' href='" + oneMoreColumnUrl + "'>more</a>");
} else {
  document.write("more");
}
document.write(" columns<br/>");
if (boards > 1) {
  document.write("<a class='footerLink' href='" + oneLessBoardUrl + "'>less</a>");
} else {
  document.write("less");
}
document.write(" / ");
if (boards < 32) {
  document.write("<a class='footerLink' href='" + oneMoreBoardUrl + "'>more</a>");
} else {
  document.write("more");
}
document.write(" chessboards</p>");
document.write("</td><td>");
document.write("<p style='text-align: right; font-size:small; font-weight:bold;'>click on square H8 for help<br><a class='footerLink' href='live/live.html'>try the single chessboard live view</a></p>");
document.write("</td></tr></table>");

</script>

</body>

</html>


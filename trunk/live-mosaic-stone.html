<!DOCTYPE HTML>
<html>

<!--
  pgn4web javascript chessboard
  copyright (C) 2009-2014 Paolo Casaschi
  see README file and http://pgn4web.casaschi.net
  for credits, license and more details
-->

<head>

<title>chess games viewer: live chessboard</title>

<link rel="icon" sizes="16x16" href="pawn.ico" />

<script src="pgn4web.js" type="text/javascript"></script>
<script src="engine.js" type="text/javascript"></script>

<script src="fide-lookup.js" type="text/javascript"></script>

<script type="text/javascript">
  "use strict";

  var thisRegExp;

  var readyToReceivePgn = false;

  var useTextarea = false;
  thisRegExp = /(&|\?)(useTextarea|ut)=([^&]*)(&|$)/i;
  if (window.location.search.match(thisRegExp) !== null) {
    var useTextareaValue = unescape(window.location.search.match(thisRegExp)[3]);
    if ((useTextareaValue == "true") || (useTextareaValue == "t")) { useTextarea = true; }
  }

  var pgnFile_default = location.protocol + "//" + location.hostname +
    location.pathname.replace(/\/[^\/]*$/, "/live/live.pgn");
  var pgnFile = pgnFile_default;
  thisRegExp = /(&|\?)(pgnData|pd)=([^&]*)(&|$)/i;
  if (window.location.search.match(thisRegExp) !== null) {
    pgnFile = unescape(window.location.search.match(thisRegExp)[3]);
  } else {
    // accepts pgnData as alias for pgnFile for consistency with board.html
    thisRegExp = /(&|\?)(pgnFile|pf)=([^&]*)(&|$)/i;
    if (window.location.search.match(thisRegExp) !== null) {
      pgnFile = unescape(window.location.search.match(thisRegExp)[3]);
    }
  }

  var alertFlag = false;
  var demoFlag = false;
  thisRegExp = /(&|\?)(refreshDemo|rd|demo|d)=([^&]*)(&|$)/i;
  if (window.location.search.match(thisRegExp) !== null) {
    var refreshDemo = unescape(window.location.search.match(thisRegExp)[3]);
    if ((refreshDemo == "true") || (refreshDemo == "t")) { alertFlag = demoFlag = true; }
  }

  var refreshMinutes_default = 1;
  var refreshMinutes = refreshMinutes_default;
  var stepFlag = true;
  thisRegExp = /(&|\?)(refreshMinutes|rm)=([^&]*)(&|$)/i;
  if (window.location.search.match(thisRegExp) !== null) {
    refreshMinutes = parseFloat(unescape(window.location.search.match(thisRegExp)[3]));
    if (isNaN(refreshMinutes)) { refreshMinutes = refreshMinutes_default; }
    if (refreshMinutes <= 0) { refreshMinutes = refreshMinutes_default; }
  }

  var iniGame_default = 1;
  var iniGame = iniGame_default;
  thisRegExp = /(&|\?)(initialGame|ig)=([^&]*)(&|$)/i;
  if (window.location.search.match(thisRegExp) !== null) {
    iniGame = unescape(window.location.search.match(thisRegExp)[3]);
  }

  thisRegExp = /(&|\?)(flipBoard|fb)=([^&]*)(&|$)/i;
  if (window.location.search.match(thisRegExp) !== null) {
    var flipBoardValue = unescape(window.location.search.match(thisRegExp)[3]);
    if ((flipBoardValue == "true") || (flipBoardValue == "t")) { IsRotated = true; }
  }

  thisRegExp = /(&|\?)(help|h)=(true|t)(&|$)/i;
  if (window.location.search.match(thisRegExp) !== null) {
    alert("pgn4web live-mosaic-stone.html parameters" + "\n" +
      " - useTextarea = " + useTextarea + "; if set true uses textarea as PGN input (default false = use pgnData)" + "\n" +
      " - pgnData = " + pgnFile + "; PGN file to load (default " + pgnFile_default + ")" + "\n" +
      " - refreshMinutes = " + refreshMinutes + "; refresh interval in minutes, decimals allowed (default " + refreshMinutes_default + ")" + "\n" +
      " - refreshDemo = " + demoFlag + "; sets live demo mode (default false)" + "\n" +
      " - initialGame = " + iniGame + "; initial game number or search string" + "\n" +
      " - flipBoard = " + IsRotated + "; if true the chessboard is flipped" + "\n" +
      " - help = true");
  }

  if (!useTextarea) { SetPgnUrl(pgnFile); }
  SetImagePath("images/alpha/24");
  SetImageType("png");
  SetHighlightOption(true); // true or false
  SetCommentsIntoMoveText(false);
  SetCommentsOnSeparateLines(false);
  SetAutoplayDelay(1000); // milliseconds
  SetAutostartAutoplay(false);
  SetAutoplayNextGame(false);
  SetInitialGame(iniGame);
  SetInitialVariation(0);
  SetInitialHalfmove("end", true);
  SetShortcutKeysEnabled(false);
  SetLiveBroadcast(refreshMinutes, demoFlag, alertFlag, stepFlag);

  clearShortcutSquares("G", "8");
  clearShortcutSquares("BCEFG", "7");
  clearShortcutSquares("CDEF", "6");
  clearShortcutSquares("ABCDEFGH", "345");

  // disable FlipBoard functionality, extending the warning to the parent container
  var warnedFlipBoard = false;
  function FlipBoard() {
    if (!warnedFlipBoard) {
      myAlert("warning: flip board functionality disabled", false, true);
      warnedFlipBoard = true;
      if (parent && (parent !== window) && parent.FlipBoard) { parent.FlipBoard(); }
    }
  }

  try {
    var pcscsfcf, cscs;
    if (parent && (parent !== window) && (pcscsfcf = parent.pgn4webClearShortCutSquaresForChildFrames)) {
      for (cscs in pcscsfcf) { clearShortcutSquares(pcscsfcf[cscs][0], pcscsfcf[cscs][1]); }
    }
    if (parent && (parent !== window) && parent.displayPgnData && parent.savePgnData) {
      boardShortcut("D8", "show full PGN source data", function(t,e){ if (e.shiftKey) { parent.savePgnData(); } else { parent.displayPgnData(); } });
    }
  } catch(e) { myAlert("warning: failed accessing frame's parent for shortcut squares to clear", false); }

  function addTagToTitle(tagLabel, tagValue, object) {
    if (!tagValue || tagValue[1] == "?" || !object) { return; }
    object.title += (object.title ? "\n " : " ") + simpleHtmlentitiesDecode(tagLabel + tagValue) + "  ";
  }

  function hideThisGame() {
    try {
      if (parent && (parent !== window) && parent.pgn4webHideChildFrameGame) {
        parent.pgn4webHideChildFrameGame(gameEvent[currentGame], gameSite[currentGame], gameDate[currentGame], gameRound[currentGame], gameWhite[currentGame], gameBlack[currentGame]);
      }
    } catch(e) { myAlert("error: failed accessing frame's parent for hiding game", true); }
  }

  function customFunctionOnPgnTextLoad() {

    var thisCurrentGame = currentGame;

    // force reloading iniGame each time
    SetInitialGame(iniGame);
    setCurrentGameFromInitialGame();
    if (currentGame != thisCurrentGame) {
      SetInitialVariation(0);
      SetInitialHalfmove("end",true);
      Init();
      GoToInitialHalfmove();
    }

  }

  function customFunctionOnPgnGameLoad() {
    var theObj;

    if (theObj = document.getElementById("GameWhiteClock")) { theObj.style.display = (gameResult[currentGame] == "*") ? "" : "none"; }
    if (theObj = document.getElementById("GameWhiteResult")) {
      if (gameResult[currentGame] == "1/2-1/2") { theObj.innerHTML = "&frac12;"; }
      else if (gameResult[currentGame] == "1-0") { theObj.innerHTML = "1"; }
      else if (gameResult[currentGame] == "0-1") { theObj.innerHTML = "0"; }
    }
    if (theObj = document.getElementById("GameBlackClock")) { theObj.style.display = (gameResult[currentGame] == "*") ? "" : "none"; }
    if (theObj = document.getElementById("GameBlackResult")) {
      if (gameResult[currentGame] == "1/2-1/2") { theObj.innerHTML = "&frac12;"; }
      else if (gameResult[currentGame] == "1-0") { theObj.innerHTML = "0"; }
      else if (gameResult[currentGame] == "0-1") { theObj.innerHTML = "1"; }
    }

    theObj = document.getElementById("topContainer");
    if (theObj) {
      theObj.title = numberOfGames > 1 ? " game " + (currentGame+1) + " of " + numberOfGames + "  " : "";
      addTagToTitle("event: ", gameEvent[currentGame], theObj);
      addTagToTitle("site: ", gameSite[currentGame], theObj);
      addTagToTitle("date: ", gameDate[currentGame], theObj);
      addTagToTitle("round: ", gameRound[currentGame], theObj);
      addTagToTitle("white: ", gameWhite[currentGame], theObj);
      addTagToTitle("white team: ", customPgnHeaderTag("WhiteTeam"), theObj);
      addTagToTitle("black: ", gameBlack[currentGame], theObj);
      addTagToTitle("black team: ", customPgnHeaderTag("BlackTeam"), theObj);
      addTagToTitle("result: ", gameResult[currentGame], theObj);
      addTagToTitle("termination: ", customPgnHeaderTag("Termination"), theObj);
      addTagToTitle("timecontrol: ", customPgnHeaderTag("TimeControl"), theObj);
      var theOther = document.getElementById("bottomContainer");
      if (theOther) { theOther.title = theObj.title; }
    }

    try {
      if (parent && (parent !== window) && parent.pgn4webHideChildFrameGame) {
        if (parent.barePadding === "") {
          if (parent.pgn4webHideChildFrameGame(gameEvent[currentGame], gameSite[currentGame], gameDate[currentGame], gameRound[currentGame], gameWhite[currentGame], gameBlack[currentGame], true)) {
            boardShortcut("A6", "hide this game", function(t,e){ hideThisGame(); });
          } else {
            boardShortcut("A6", "hiding option unavailable for this game", function(t,e){} );
          }
        }
      }
    } catch(e) { myAlert("warning: failed accessing frame's parent for hiding game option", false); }
  }

  function customFunctionOnMove() {
    var theObj;
    if (theObj = document.getElementById("GameWhiteFlag")) { theObj.style.display = (CurrentPly % 2) ? "none" : ""; }
    if (theObj = document.getElementById("GameWhiteMoreMoves")) { theObj.style.display = ((CurrentPly % 2) && (CurrentPly < StartPly + PlyNumber)) ? "inline" : "none"; }
    if (theObj = document.getElementById("GameBlackFlag")) { theObj.style.display = (CurrentPly % 2 === 0) ? "none" : ""; }
    if (theObj = document.getElementById("GameBlackMoreMoves")) { theObj.style.display = ((CurrentPly % 2 === 0)  && (CurrentPly < StartPly + PlyNumber)) ? "inline" : "none"; }
  }

  function customShortcutKey_Shift_0() { try { if (parent && (parent !== window) && parent.customShortcutKey_Shift_0) { parent.customShortcutKey_Shift_0(); } } catch(e) { myAlert("error: failed accessing frame's parent custom shortcut key function"); } }

  // customShortcutKey_Shift_1 defined by fide-lookup.js
  // customShortcutKey_Shift_2 defined by fide-lookup.js

  function customShortcutKey_Shift_3() { try { if (parent && (parent !== window) && parent.customShortcutKey_Shift_3) { parent.customShortcutKey_Shift_3(); } } catch(e) { myAlert("error: failed accessing frame's parent custom shortcut key function"); } }
  function customShortcutKey_Shift_4() { try { if (parent && (parent !== window) && parent.customShortcutKey_Shift_4) { parent.customShortcutKey_Shift_4(); } } catch(e) { myAlert("error: failed accessing frame's parent custom shortcut key function"); } }
  function customShortcutKey_Shift_5() { try { if (parent && (parent !== window) && parent.customShortcutKey_Shift_5) { parent.customShortcutKey_Shift_5(); } } catch(e) { myAlert("error: failed accessing frame's parent custom shortcut key function"); } }
  function customShortcutKey_Shift_6() { try { if (parent && (parent !== window) && parent.customShortcutKey_Shift_6) { parent.customShortcutKey_Shift_6(); } } catch(e) { myAlert("error: failed accessing frame's parent custom shortcut key function"); } }
  function customShortcutKey_Shift_7() { try { if (parent && (parent !== window) && parent.customShortcutKey_Shift_7) { parent.customShortcutKey_Shift_7(); } } catch(e) { myAlert("error: failed accessing frame's parent custom shortcut key function"); } }

  // overwriting engine.js definitions of customShortcutKey_Shift_8 9 0
  function customShortcutKey_Shift_8() { try { if (parent && (parent !== window) && parent.customShortcutKey_Shift_8) { parent.customShortcutKey_Shift_8(); } } catch(e) { myAlert("error: failed accessing frame's parent custom shortcut key function"); } }
  function customShortcutKey_Shift_9() { try { if (parent && (parent !== window) && parent.customShortcutKey_Shift_9) { parent.customShortcutKey_Shift_9(); } } catch(e) { myAlert("error: failed accessing frame's parent custom shortcut key function"); } }

  function pgn4web_onload(e) {
    var theObj;
    if (theObj = document.getElementById("topPlayer")) { theObj.id = IsRotated ? "GameWhite" : "GameBlack"; }
    if (theObj = document.getElementById("bottomPlayer")) { theObj.id = IsRotated ? "GameBlack" : "GameWhite"; }
    if (theObj = document.getElementById("topClock")) { theObj.id = IsRotated ? "GameWhiteClock" : "GameBlackClock"; }
    if (theObj = document.getElementById("bottomClock")) { theObj.id = IsRotated ? "GameBlackClock" : "GameWhiteClock"; }
    if (theObj = document.getElementById("topResult")) { theObj.id = IsRotated ? "GameWhiteResult" : "GameBlackResult"; }
    if (theObj = document.getElementById("bottomResult")) { theObj.id = IsRotated ? "GameBlackResult" : "GameWhiteResult"; }
    if (theObj = document.getElementById("topFlag")) {
      theObj.className = IsRotated ? "whiteFlag" : "blackFlag";
      theObj.id = IsRotated ? "GameWhiteFlag" : "GameBlackFlag";
    }
    if (theObj = document.getElementById("bottomFlag")) {
      theObj.className = IsRotated ? "blackFlag" : "whiteFlag";
      theObj.id = IsRotated ? "GameBlackFlag" : "GameWhiteFlag";
    }
    if (theObj = document.getElementById("topMoreMoves")) { theObj.id = IsRotated ? "GameWhiteMoreMoves" : "GameBlackMoreMoves"; }
    if (theObj = document.getElementById("bottomMoreMoves")) { theObj.id = IsRotated ? "GameBlackMoreMoves" : "GameWhiteMoreMoves"; }

    start_pgn4web();
    readyToReceivePgn = true;
    try {
      if (parent && (parent !== window) && parent.updateBoard) {
        var boardId = parseInt(window.name.substr(5), 10);
        if (!isNaN(boardId)) { parent.updateBoard(boardId); }
        else { myAlert("warning: failed detecting board id", false); }
      }
    } catch(e) { myAlert("warning: failed forcing board update from frame's parent", false); }
    try {
      if (parent && (parent !== window) && parent.document.body.style.backgroundColor) {
        var RGB;
        if (RGB = parent.document.body.style.backgroundColor.match(/^rgb\((\d+), (\d+), (\d+)\)$/)) {
          // RGB to Luma conversion: Photometric/digital ITU-R
          if ((0.2126 * parseInt(RGB[1],10) + 0.7152 * parseInt(RGB[2],10) + 0.0722 * parseInt(RGB[3],10)) < (256 * 0.45)) {
            document.body.style.color = "white";
          }
        }
      }
    } catch(e) { myAlert("warning: error setting text color from parent background", false); }
  }

</script>

<style type="text/css">

@import url("fonts/pgn4web-font-LiberationSans.css");

html,
body {
  margin: 0px;
  padding: 0px;
}

body {
  background: transparent;
  color: black;
  font-family: 'pgn4web Liberation Sans', sans-serif;
  font-weight: bold;
  font-size: 14px;
  line-height: 19px;
  padding: 13px;
}

a {
  color: inherit;
  text-decoration: none;
}

.boardTable {
  border-style: solid;
  border-color: #663300;
  border-width: 3px;
  background: #CC9966;
  box-shadow: 0px 0px 13px #663300;
  width: 230px;
  height: 230px;
}

.pieceImage {
  width: 24px;
  height: 24px;
}

.whiteSquare,
.blackSquare,
.highlightWhiteSquare,
.highlightBlackSquare {
  width: 26px;
  height: 26px;
  border-style: solid;
  border-width: 1px;
}

.whiteSquare,
.highlightWhiteSquare {
  border-color: #FFCC99;
  background: #FFCC99;
}

.blackSquare,
.highlightBlackSquare {
  border-color: #CC9966;
  background: #CC9966;
}

.highlightWhiteSquare,
.highlightBlackSquare {
  border-style: inset;
  border-color: #CC9966;
}

.move,
.variation,
.comment {
}

.topContainer {
  display: inline-block;
  width: 224px;
  margin-bottom: 11px;
}

.bottomContainer {
  display: inline-block;
  width: 224px;
  margin-top: 13px;
}

.leftHeaderItem,
.rightHeaderItem {
  white-space: nowrap;
  overflow: hidden;
}

.leftHeaderItem {
  clear: both;
  float: left;
  width: 154px;
  text-align: left;
}

.rightHeaderItem {
  float: right;
  width: 64px;
  text-align: right;
}

.flagMoves {
  display: inline-block;
  width: 28px;
}

.whiteFlag,
.blackFlag {
  display: inline-block;
  width: 8px;
  height: 8px;
  border: solid 1px black;
}

.whiteFlag {
  background: white;
}

.blackFlag {
  background: black;
}

</style>

</head>

<body>

<!-- paste your PGN below and make sure you dont specify an external source with SetPgnUrl() -->
<form style="display: none;"><textarea style="display: none;" id="pgnText">

[Event "loading PGN data, please wait..."]
[Result "*"]

</textarea></form>
<!-- paste your PGN above and make sure you dont specify an external source with SetPgnUrl() -->

<center>

<div id="topContainer" class="topContainer">
<div class="leftHeaderItem"><a class="flagMoves" href="javascript:void(0);" onclick="if (isAutoPlayOn) { GoToMove(StartPly + PlyNumber); } else { GoToMove(CurrentPly + 1); SetAutoPlay(true); }"><span id="topFlag"></span><span style="display:none;" id="topMoreMoves" title="click here for more available moves">...</span></a><a href="javascript:void(0);" onclick="if (typeof(openFidePlayerUrl) == 'function') { openFidePlayerUrl(IsRotated ? gameWhite[currentGame] : gameBlack[currentGame], customPgnHeaderTag(IsRotated ? 'WhiteFideId' : 'BlackFideId')); } this.blur();" id="topPlayer" class="notranslate"></a>&nbsp;</div><div class="rightHeaderItem">&nbsp;<a href="javascript:void(0);" onclick="replayPreviousMoves(1);"><span id="topClock"></span><span id="topResult"></span></a></div>
</div>

<div id="GameBoard"></div>

<div id="bottomContainer" class="bottomContainer">
<div class="leftHeaderItem"><a class="flagMoves" href="javascript:void(0);" onclick="if (isAutoPlayOn) { GoToMove(StartPly + PlyNumber); } else { GoToMove(CurrentPly + 1); SetAutoPlay(true); }"><span id="bottomFlag"></span><span style="display:none;" id="bottomMoreMoves" title="click here for more available moves">...</span></a><a href="javascript:void(0);" onclick="if (typeof(openFidePlayerUrl) == 'function') { openFidePlayerUrl(IsRotated ? gameBlack[currentGame] : gameWhite[currentGame], customPgnHeaderTag(IsRotated ? 'BlackFideId' : 'WhiteFideId')); } this.blur();" id="bottomPlayer" class="notranslate"></a>&nbsp;</div><div class="rightHeaderItem">&nbsp;<a href="javascript:void(0);" onclick="replayPreviousMoves(1);"><span id="bottomClock"></span><span id="bottomResult"></span></a></div>
</div>

</center>

</body>

</html>
